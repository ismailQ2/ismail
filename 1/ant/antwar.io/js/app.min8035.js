var game={};"/play/"===window.location.pathname&&(game.isPlayScreen=!0),function(){var e=window.innerWidth,t=window.innerHeight,a=64,n=6e3/a,i=3,r=2,o=!1,s=0,l=0,u=0,d=0,h=!1,c=new PIXI.Application(e,t,{backgroundColor:0});c.stop(),PIXI.SCALE_MODES.DEFAULT=PIXI.SCALE_MODES.NEAREST,c.view.id="gameCanvas",document.body.appendChild(c.view);var p=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),f=null,g=0,m=0,y=0,b=0,v=!1,w=[],x=[],I=null,T=null,M=null,k=null,D=null,S=null,A=null,E=[],_=null,P=!1,C=!1,L=-1,O=new PIXI.filters.GlowFilter(10,1,0,16777215,.5),q={x:0,y:120-t,z:0,zoom:1};window.document.addEventListener("contextmenu",function(e){game.isPlayScreen&&e.preventDefault()});var z=null,j=null,B=null,N={white:"white.png",tiles:"tiles2.png",edge_tiles:"edge_tiles.png",tiles_surface:"tiles_surface.png",arrow_pointer:"arrow_pointer.png",spider:"spider.png",spider2:"spider2.png",tutorial_avatar:"tutorial_avatar.png",gui:"gui.png",anthill:"anthill.png",anthill_small:"anthill_small.png",anthill_below:"anthill_below.png",food:"food.png",super_food:"super_food.png",brood:"brood.png",dirt:"dirt.png",aphid:"aphid.png",plant:"plant.png",tags:"tags.png",rock1:"rock1.png",rock2:"rock2.png",rock3:"rock3.png",rock4:"rock4.png",sticks:"sticks.png",pheromone:"pheromone.png",outside:"outside.png",antenna:"antenna.png",ant_worker:"worker.png",ant_soldier:"soldier.png",ant_queen:"queen.png",ant_queen_wings:"queen_wings.png",bug:"anate.png",goliath_beetle:"goliath_beetle.png",centipede:"centipede.png",head_32x32_1:"head_32x32_1.png",head_64x64_1:"head_64x64_1.png",thorax_64x64_1:"thorax_64x64_1.png",abdomen_64x64_1:"abdomen_64x64_1.png",abdomen_64x32_1:"abdomen_64x32_1.png"},R=!1;function Z(){if(!R){R=!0,B={collect:new Howl({urls:["assets/collect.wav"],loop:!1,volume:.05}),rank_up:new Howl({urls:["assets/rank_up.wav"],loop:!1,volume:.2}),beep:new Howl({urls:["assets/beep.wav"],loop:!1,volume:.1}),round_end:new Howl({urls:["assets/round_end.wav"],loop:!1,volume:.2}),aboveground:new Howl({urls:["assets/ambient_aboveground.ogg"],loop:!0,volume:.1}),aboveground_night:new Howl({urls:["assets/ambient_aboveground_night.ogg"],loop:!0,volume:.004}),underground:new Howl({urls:["assets/ambient_underground.ogg"],loop:!0,volume:.25}),walk:new Howl({urls:["assets/walk_sound.ogg"],loop:!0,volume:.25})};for(var e=0;e<4;e++)B["wood_hit"+(e+1)]=new Howl({urls:["assets/wood_hit"+(e+1)+".mp3"],loop:!1,volume:.1})}}game.loadSounds=Z;var F=null,W=null,U=null,G=null,X=null,H=null,Y=null,Q=null,J=null,V=null,K=null,ee=new VignetteFilter({size:.2,amount:5,focalPointX:.5,focalPointY:.5}),te=[{command:"+5 Follow"},{command:"+1 Follow"},{command:"Dismiss"},{command:"Switch"},{command:"Select Follow"},{command:"Defend"},{command:"Stop Defend"}];function ae(){if(p)e=window.innerWidth,t=window.innerHeight,c.renderer.resize(e,t);else{var i=window.devicePixelRatio,r=window.innerWidth,o=window.innerHeight;c.renderer.view.style.width=r+"px",c.renderer.view.style.height=o+"px",e=Math.round(r*i),t=Math.round(o*i),c.renderer.resize(e,t)}game.isPlayScreen||(q.x=0,q.y=0,n=Math.round(e/a)+5),G.x=e/2,U.x=e/2,K.x=e/2,J.x=e/2}function ne(){var t=game.queryData.address;"127.0.0.1"!==t&&"localhost"!==t||(t=window.location.hostname);for(var l=0;l<w.length;l++){w[l].remove()}game.isMapEditor?(o=!0,S={connected:!0,on:function(){}}):game.isSingleplayer?(o=!0,S={connected:!0,on:function(e,t){game.fakeSockets.clientSocket.socketEvents[e]=t},emit:function(e,t){game.fakeSockets.serverSocket.socketEvents[e](t)},socketEvents:{}},game.fakeSockets.clientSocket=S):S=io("//"+t+":"+game.queryData.port,{query:{userToken:game.queryData.token},extraHeaders:{GameSocketType:"main"},reconnection:!1,transports:["websocket"],upgrade:!1}),function(){if(!o)var e=setInterval(function(){(f&&"lobby"!==f||I&&I.canControl)&&((s+=1)===r?(G.text="You will be kicked for inactivity in one minute.",G.visible=!0):s>=i&&(S.forcedDisconnect=!0,S.disconnect(),clearInterval(e),G.text="You have been kicked for inactivity.",G.visible=!0))},6e4);game.doSpawn=function(e,t){e.preventDefault(),S.emit("spawn",{type:t})};var t=$("#lobby-menu-chat");S.on("chat",function(e){if("lobby"===f)e.name?t.append("<div><b>"+Je(e.name)+": </b>"+Je(e.message)+"</div>"):t.append("<div><b>"+Je(e.message)+"</b></div>"),t.scrollTop(t[0].scrollHeight);else for(var a=0;a<w.length;a++){var n=w[a];if(e.id===n.serverId){n.chat&&(n.chat.text=e.message,n.chat.visible=!0,n.chat.removeChat=Date.now()+5e3);break}}}),S.on("tutorialData",function(e){e?(V.tutorialData=e,V.text.text=e.text,B.beep.volume(.08),B.beep.play()):V.tutorialData=null}),S.on("updateNight",function(e){d=e.night?1:0,e.force&&(u=d)}),S.on("roundEnd",function(e){!function(e){$("#roundEnd").slideDown(500),$("#roundEndXp").hide(),$("#roundEndCoins").hide(),$("#roundEndMessage").text(e.message),$("#roundEndSignin").hide(),$("#roundEndShop").hide(),$("#xpGain").text("0"),$("#coinsGain").text("0"),$("#roundEndNextRank").hide(),$("#roundEndRankBar").width(0),$("#roundEndNewRank").hide(),e.roundActuallyEnded?$("#roundEndTitle").show():$("#roundEndTitle").hide();var t=0,a=0;e.awards&&(t=e.awards.xp,a=e.awards.coins);setTimeout(function(){if($("#roundEndXp").show(),t){for(var n=0,i=function(e,t,a){setTimeout(function(){$(e).text(""+t),--n<=0&&(B.collect.play(),n=2)},75*a)},r=0,o=0;o<=t+50;o+=50){var s=o;s>t&&(s=t),i("#xpGain",s,r),r++}setTimeout(function(){$("#roundEndCoins").show(),r=0;for(var n=0;n<=a+5;n+=5){var o=n;o>a&&(o=a),i("#coinsGain",o,r),r++}setTimeout(function(){if(e.isUser){$("#roundEndNextRank").show();var a=Math.floor(RANK_CONSTANT*Math.sqrt(e.lastXp)),n=RANK_CONSTANT*Math.sqrt(e.lastXp+t),i=Math.floor(n),r=n-i;$("#roundEndNextRankValue").text(i+1);var o=Math.round(100*r);$("#roundEndRankBar").width(o+"%"),$("#roundEndRankPercentage").text(o+"%"),i>a?setTimeout(function(){$("#roundEndNewRank").show(),B.rank_up.play(),$("#roundEndShop").show()},500):$("#roundEndShop").show()}else $("#roundEndSignin").show(),$("#roundEndShop").show()},75*r+100)},75*r+100)}else e.isUser||$("#roundEndSignin").show()},600)}(e)}),S.on("showMenu",function(e){if($("#roundEnd").hide(),e&&"lobby"===e.menu){if(function(e){$("#lobbyMenuModal").show(),Be=e.startTimer;for(var t="",a=null,n=0;n<e.players.length;n++){var i=e.players[n],r='<i class="fa fa-close" style="color:red;"></i>&nbsp;';i.ready&&(r='<i class="fa fa-check" style="color:green;"></i>'),i.xp&&(r+=' <img class="icon-xs" src="assets/rank_icon.png"> <b>'+game.calculateRank(i.xp)+"</b>"),t+='<div style="width:500px;">'+r+" "+Je(i.name)+"</div>",i.clientId===e.clientId&&(a=i)}$("#lobby-menu-players").html(t),$("#lobby-menu-player-count").text(e.players.length),e.privateGame?$("#lobby-menu-message").html("<h4>Private Game</h4><small>Game is only able to be joined with the invite link below.</small>"):$("#lobby-menu-message").text("");for(var o="",n=0;n<e.teams.length;n++){var s=e.teams[n],l='<button onclick="game.lobbyJoinTeam('+s.id+');" class="pull-right btn btn-sm btn-success">Join</button>';a&&a.team===s.id&&a.canLock?l=s.locked?'<button onclick="game.lobbyLockTeam();" class="pull-right btn btn-sm btn-primary"><i class="fa fa-unlock"></i> Unlock</button>':'<button onclick="game.lobbyLockTeam();" class="pull-right btn btn-sm btn-primary"><i class="fa fa-lock"></i> Lock</button>':s.locked?l='<span class="pull-right"><i class="fa fa-lock"></i> Locked</span>':a.team===s.id&&(l=""),o+='<div class="text-left"><span style="display:inline-block;">'+s.name+" ("+s.players+"/"+s.maxPlayers+")</span>&nbsp;&nbsp;"+l+"</div><hr>"}e.teams.length<8&&(o+='<br><button onclick="game.lobbyNewTeam();" class="btn btn-success"><i class="fa fa-plus"></i> New Team</button>');$("#lobby-menu-teams").html(o),$("#lobby-menu-share-link").val(window.location.protocol+"//"+window.location.host+"?invite="+e.shareLinkToken)}(e),x.length){for(var t=0;t<x.length;t++){var a=x[t];a.remove()}x=[]}}else $("#lobbyMenuModal").hide();f=e&&e.menu?e.menu:e}),S.on("setAnnouncement",function(e){e?(G.text=e,G.visible=!0):(G.text="",G.visible=!1)}),S.on("tileUpdate",function(e){k[e.y][e.x][0]=e.val,null!==e.m&&void 0!==e.m&&(k[e.y][e.x][1]=e.m);for(var t=-1;t<=1;t++)for(var a=-1;a<=1;a++)ue(e.x+t,e.y+a)}),S.on("tileData",function(e){k=e;for(var t=0;t<E.length;t++){var i=E[t];c.cstage.removeChild(i)}E=[],se=Oe(j.tiles.texture,64,64),le=Oe(j.edge_tiles.texture,64,64),_=Oe(j.tiles_surface.texture,64,64);for(var t=0;t<w.length;t++){var r=w[t];r.clientsideOnly&&r.remove()}for(var o=0;o<2;o++){var i=new PIXI.Container;i.getZIndex=function(){return 1e4},n=e.length,D=[];for(var s=0;s<n;s++){D.push([]);for(var l=0;l<n;l++){var u=new PIXI.Container;if(u.visible=!1,u.position.x=l*a,u.position.y=s*a,i.addChild(u),D[s][l]=u,0===o){if(!u.tileBase){var d=new PIXI.Sprite;d.width=a,d.height=a,u.addChild(d),u.tileBase=d,u.textureType=parseInt(4*Math.random()),u.moistureType=parseInt(3*Math.random())}var h=ie(l,s)[1];u.visible=0===h||1===h,u.visible&&(0===h?u.tileBase.texture=_[u.moistureType][1]:1===h&&(u.tileBase.texture=_[u.moistureType][0]))}else ue(l,s)}}c.cstage.addChild(i),E[o]=i}for(var t=0;t<40;t++){var p={x:Math.random()*n*a,y:Math.random()*n*a},f=400+Math.round(200*Math.random()),r=Ce(-1,"stick",p.x,p.y,0,f,.25*f,-1,{stickType:Math.floor(4*Math.random())});r.rotation=Math.random()*Math.PI*2}}),S.on("createEntity",function(e){var t=null;"insect"===e.type?t=Pe(e.id,e.subtype,e.x,e.y,e.z,e.width,e.height,e.team,e.netData):"object"===e.type?t=Ce(e.id,e.subtype,e.x,e.y,e.z,e.width,e.height,e.team,e.netData):console.error("Invalid entity type."),t&&(t.rotation=e.rotation)}),S.on("entityrpc",function(e){for(var t=0;t<w.length;t++){var a=w[t];if(e.id===a.serverId){a[e.name]?a[e.name](e.data):console.error("Invalid RPC for entity:",e.name,a.type);break}}}),S.on("removeEntity",function(e){for(var t=0;t<w.length;t++){var a=w[t];e===a.serverId&&a.remove()}}),S.on("setPlayer",function(e){L=-1;for(var t=0;t<w.length;t++){var i=w[t];if(e.id===i.serverId){(I=i).canControl=e.canControl;break}}if(I){for(var t=0;t<w.length;t++){var i=w[t];"anthill"===i.subtype&&i.team===I.team&&(T=i)}for(var t=0;t<w.length;t++){var i=w[t];"ant_queen"===i.subtype&&i.team===I.team&&(M=i)}f&&"lobby"===f&&($("#lobbyMenuModal").hide(),f=null)}e.spectator?(h=!0,I=null,q.x||(q.x=n*a/2),q.y||(q.y=n*a/2),q.z||(q.z=0)):h=!1,game.onPlayerAlive()})}(),!0;var p=parseInt(game.queryData.port?game.queryData.port:"80")+363;"game.dev.antwar.io"===t&&(t="game2.dev.antwar.io",p=80),S.on("growl",function(e){$.bootstrapGrowl(e,{type:"danger"})}),S.on("connect_error",function(e){console.error(e),e?$.bootstrapGrowl(e.message?e.message:e,{type:"danger"}):$.bootstrapGrowl("Failed to connect to server.",{type:"danger"})}),S.on("error",function(e){console.error(e),e?$.bootstrapGrowl(e.message?e.message:e,{type:"danger"}):$.bootstrapGrowl("Failed to connect to server.",{type:"danger"})}),S.on("socketTokenReceive",function(e){(A=io("//"+t+":"+p,{query:{token:e},extraHeaders:{GameSocketType:"snapshot"},reconnection:!1,transports:["websocket"],upgrade:!1})).on("connect",function(){var e;console.log("Websockets connected."),e=A.io.decoder.add,A.io.decoder.add=function(t){try{e.call(A.io.decoder,t)}catch(e){}},A.io.decoder.reconstructor={takeBinaryData:game.onSnapshot,finishedReconstruction:function(){}}}),A.on("disconnect",function(){S.disconnect()})}),S.on("disconnect",function(){console.log("Websockets disconnected.");var t=new PIXI.Text("Disconnected from Game");if(t.style.fill=16777215,t.style.fontSize=30,t.anchor.x=.5,t.x=e/2,t.y=200,c.stage.addChild(t),!S.forcedDisconnect)try{navigator.userAgent.indexOf("Firefox")>0?window.location="/":setTimeout(function(){window.location="/"},1500)}catch(e){window.location="/"}})}function ie(e,t){return e>=0&&t>=0&&e<n&&t<n?k[t][e]:[1,0]}window.addEventListener("resize",ae),PIXI.loader.once("complete",function(t,a){j=a,console.log("Asset loading completed."),c.cstage=new PIXI.Container,c.stage.addChild(c.cstage),(W=new PIXI.extras.TilingSprite(j.outside.texture)).getZIndex=function(){return 1e5},W.width=4e3,W.height=4e3,W.scale.x=2,W.scale.y=2,W.anchor.x=0,W.anchor.y=0,W.position.x=0,W.position.y=0,c.cstage.addChild(W),X=Oe(j.gui.texture,128,128),H=Oe(j.tags.texture,64,16),c.cstage.updateLayersOrder=function(){c.cstage.children.sort(function(e,t){return t.getZIndex()-e.getZIndex()})},(z=new PIXI.Text).anchor.x=0,z.x=10,z.y=30,z.getZIndex=function(){return-1e4},c.stage.addChild(z),(U=new PIXI.Text).anchor.x=.5,U.style.fill=16777215,U.text="Waiting to be born...\nTap to Spectate",U.x=e/2,U.style.align="center",U.y=100,U.visible=!1,U.getZIndex=function(){return-1e4},c.stage.addChild(U),J=new PIXI.Container;var n=new PIXI.Text;n.anchor.x=.5,n.style.fill=16777215,n.text="Queen is Hungry",J.addChild(n);var i=new PIXI.Sprite(X[0][0]);i.x=-118,i.y=-8,i.scale.set(.4),i.anchor.x=.5,J.addChild(i),J.x=e/2,J.y=25,J.visible=!1,J.getZIndex=function(){return-1e4},c.stage.addChild(J),(K=new PIXI.Text).anchor.x=.5,K.style.fill=16777215,K.text="These are tips.",K.style.align="center",K.style.fontSize=20,K.x=e/2,K.y=50,K.visible=!1,K.getZIndex=function(){return-1e4},c.stage.addChild(K),(Q=new PIXI.Sprite(j.arrow_pointer.texture)).visible=!1,Q.anchor.set(.5),Q.getZIndex=function(){return-1e4},c.cstage.addChild(Q),(G=new PIXI.Text).anchor.x=.5,G.style.align="center",G.style.fontSize=80,G.style.fill=16777215,G.x=e/2,G.y=400,G.visible=!1,G.getZIndex=function(){return-1e4},c.stage.addChild(G),Y=Oe(j.tutorial_avatar.texture,256,256),(V=new PIXI.Container).square=new PIXI.Sprite(j.white.texture),V.square.alpha=.5,V.square.tint=0,V.square.width=1,V.square.height=1,V.addChild(V.square),V.avatar=new PIXI.Sprite(Y[0][0]),V.avatar.width=200,V.avatar.height=200,V.addChild(V.avatar),V.text=new PIXI.Text("",{fontFamily:"Arial",fontSize:22,fill:16777215,align:"left",wordWrap:!0,wordWrapWidth:200}),V.addChild(V.text),V.visible=!1,c.stage.addChild(V),F=new PIXI.Container;var r=new PIXI.Graphics;r.alpha=.5,r.lineStyle(139.5,0),r.drawCircle(0,0,155),r.endFill(),F.addChild(r);for(var o=0;o<te.length;o++){var s=te[o],l=new PIXI.Text(s.command);s.text=l;var u=o*(2*Math.PI/te.length)-Math.PI/2;l.anchor.x=.5,l.anchor.y=.5,l.style.fontSize=22,l.style.fill=16777215,l.x=155*Math.cos(u),l.y=155*Math.sin(u),F.addChild(l),s.x=l.x,s.y=l.y;var d=new PIXI.Text("Numpad "+(o+1));d.anchor.x=.5,d.anchor.y=.5,d.style.fontSize=14,d.style.fill=13421772,d.x=155*Math.cos(u),d.y=155*Math.sin(u)+25,F.addChild(d);var h=new PIXI.Graphics;u+=Math.PI/te.length,h.lineStyle(2,"0xFFFFFF"),h.moveTo(77.5*Math.cos(u),77.5*Math.sin(u)),h.lineTo(232.5*Math.cos(u),232.5*Math.sin(u)),F.addChild(h)}F.getZIndex=function(){return-8e3},c.cstage.addChild(F),$("#loading").hide(),$("#login").show(),c.start(),game.queryData&&game.queryData.token&&game.queryData.address?ne():game.queryData&&game.queryData.invite&&(ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"joinInvite"}),setTimeout(function(){game.play(null)},100)),ae()}),game.init=ne;var re={SOUTH_WEST:0,SOUTH:1,SOUTH_EAST:2,WEST:3,EAST:4,NORTH_WEST:5,NORTH:6,NORTH_EAST:7},oe=[{x:-1,y:1},{x:0,y:1},{x:1,y:1},{x:-1,y:0},{x:1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1}],se=null,le=null;function ue(e,t){try{if(!(e>=0&&t>=0&&e<n&&t<n))return;var i=ie(e,t)[0],r=D[t][e];if(!r.tileBase){var o=new PIXI.Sprite;o.width=a,o.height=a,r.addChild(o),r.tileBase=o;var s=new PIXI.Sprite;s.width=a,s.height=a,r.addChild(s),r.tileCorner=s;var l=new PIXI.Sprite;l.width=a,l.height=a,r.addChild(l),r.tileEdge=l,r.textureType=parseInt(4*Math.random()),r.moistureType=parseInt(3*Math.random())}r.tileBase.texture=2===i?se[r.textureType][4]:1===i?se[r.textureType][1]:se[r.textureType][0],r.edges=0,r.corners=0;for(var u=0;u<oe.length;u++){var d=oe[u];ie(e+d.x,t+d.y)[0]&&(u===re.WEST?r.edges+=1:u===re.NORTH?r.edges+=2:u===re.EAST?r.edges+=4:u===re.SOUTH?r.edges+=8:u===re.NORTH_WEST?r.corners+=1:u===re.NORTH_EAST?r.corners+=2:u===re.SOUTH_EAST?r.corners+=4:u===re.SOUTH_WEST&&(r.corners+=8))}if(r.visible=!(15===r.corners&&15===r.edges),i?(r.tileCorner.visible=!1,r.tileEdge.visible=!1):(r.tileCorner.visible=0!==r.corners,r.tileEdge.visible=0!==r.edges,r.tileCorner.texture=le[0][0],r.tileEdge.texture=le[0][0],0!=r.corners&&le[r.corners-1][1]&&(r.tileCorner.texture=le[r.corners-1][1]),0!=r.edges&&le[r.edges-1][0]&&(r.tileEdge.texture=le[r.edges-1][0])),!i){var h=ie(e,t)[1];0===h?r.tileBase.texture=se[0][3]:1===h?r.tileBase.texture=se[0][2]:h>=.76?r.tileBase.texture=se[r.moistureType+1][2]:h<=.24&&(r.tileBase.texture=se[r.moistureType+1][3])}}catch(e){}}game.onSnapshot=function(e){var t=new DataView(e),a=0,n=t.getFloat64(a);for(l=Date.now()-n,a+=8;a<t.byteLength;){for(var i=!1,r=0;r<w.length;r++){var o=w[r];if(t.getUint32(a)===o.serverId){var s={time:n,serverTimeDiff:l,x:t.getFloat32(a+4),y:t.getFloat32(a+8),rotation:t.getFloat32(a+12)};a+=16,o.addState(s),i=!0;break}}i||(a+=16)}return null},game.chat=function(e){S.emit("chat",e)};var de=!1,he="",ce={},pe=0;function fe(e,t,a,n,i){null!=ge({id:-1,entity:t,volume:a})&&e.play(null,function(r){var o={id:r,sound:e,volume:a,entity:t,started:Date.now()};i&&(o.fadein=600),o=ge(o),n&&o&&n(o)})}function ge(a){var n={x:q.x+e/2,y:q.y+t/2,z:q.z};I&&I.valid&&(n={x:I.x,y:I.y,z:I.z});var i=Math.distanceBetween(a.entity,n);if(i>=1e3||a.entity.z!==n.z)return me(a),null;var r=0;if(i<=100)r=a.volume;else{var o=a.volume-i/2e3;if(o<=0)return me(a),null;r=o}if(a.fadein){var s=(Date.now()-a.started)/a.fadein;s<=.05?r=0:s<1&&(r*=s)}return-1!==a.id&&a.sound.volume(r,a.id),a}function me(e){-1!==e.id&&e.sound.stop(e.id)}function ye(e){"Switch"===e.command?P=!0:"Select Follow"===e.command?C=!0:S.emit("command",e.command)}document.onkeydown=function(e){var t=!1,a=(e=e||window.event).keyCode;if(ce[a]||(ce[a]=!0),pe=0,null!=S&&S.connected&&s>=r&&(G.visible=!1,G.text=""),"lobby"===f)return!0;var n=I&&I.canControl?I.chat:null;if(n){if(8===a){t=!0,de&&he.length>=1&&(he=he.substring(0,he.length-1));var i=$(e.srcElement||e.target);if(!(i.prop("readonly")||i.prop("disabled")))if(i[0].isContentEditable)t=!1;else if(i.is("input")){var o=i.attr("type");o&&(o=o.toLowerCase()),["text","password","file","search","email","number","date","color","datetime","datetime-local","month","range","search","tel","time","url","week"].indexOf(o)>-1&&(t=!1)}else i.is("textarea")&&(t=!1)}n.text=he+"_",n.visible=de}if(!de&&(S&&I))if(32===a?V.tutorialData&&V.tutorialData.pause?Se():S.emit("move",{x:I.x+20*Math.cos(I.rotation-Math.PI/2),y:I.y+20*Math.sin(I.rotation-Math.PI/2),action:!0}):17===a&&(Me=!(!I||!I.canControl)&&!Me),a>=49&&a<=te.length-1+49)(l=te[a-49])&&ye(l),Me=!1;else if(a>=97&&a<=te.length-1+97){var l;(l=te[a-97])&&ye(l),Me=!1}return s=0,t?(e.preventDefault(),!1):void 0},document.onkeypress=function(e){var t=e.keyCode,a=String.fromCharCode(e.which);if("lobby"===f)return!0;var n=I&&I.canControl?I.chat:null;n&&(13===t?de?(de=!1,he.trim().length>0&&S.emit("chat",he.trim()),he=""):de=!0:de&&he.length<64&&"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 !@#$%^&*()_+-=`~<>,.?/'\\\";:[]{}|".includes(a)&&(he+=a),n.text=he+"_",n.visible=de)},document.onkeyup=function(e){var t=(e=e||window.event).keyCode;ce[t]&&(ce[t]=!1),null!=S&&S.connected&&s>=r&&(G.visible=!1,G.text=""),s=0};var be=0,ve=0,we=0,xe=0,Ie=Date.now(),Te=!1,Me=!1,ke="mouse",De=0;function Se(){V.tutorialData&&V.tutorialData.pause&&S.emit("tutorialContinue")}function Ae(e){var t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;if(t)t.call(e);else if(void 0!==window.ActiveXObject){var a=new ActiveXObject("WScript.Shell");null!==a&&a.SendKeys("{F11}")}}p&&(ke="pointer"),window.document.addEventListener(ke+"down",function(e){if(g=e.clientX,m=e.clientY,V.tutorialData&&V.tutorialData.pause)++De>=2&&(De=0,Se());else{if(De=0,xe++,p?1===xe?we=0:2===xe&&(we=2):2===(we=e.button)&&C&&(C=!1),null!=S&&S.connected&&c.renderer.plugins.interaction.eventData.data){var t=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage);if(0===we){if(U&&U.visible&&I){for(var a=!1,n=0;n<w.length;n++){if((l=w[n]).valid&&l.netData&&l.netData.alive&&l.team===I.team&&("ant_queen"===l.subtype||"ant_worker"===l.subtype)&&I.name&&l!==I&&n>L){a=!0,L=n,(I=l).canControl=!1;break}}if(!a){var i=!1;for(n=0;n<w.length;n++){if((l=w[n]).valid&&l.netData&&l.netData.alive&&l.team===I.team&&("ant_queen"===l.subtype||"ant_worker"===l.subtype)&&l!==I&&n>L){L=n,(I=l).canControl=!1,i=!0;break}}i||(L=-1)}}else if((P||C)&&I&&I.valid&&I.netData.alive){var r=1e4,o=null;for(n=0;n<w.length;n++){var s,l=w[n],u=Math.distanceBetween(t,l);s=("ant_worker"===l.subtype||P&&"ant_queen"===l.subtype)&&!l.netData.name&&l.netData.alive&&l.team===I.team&&u<=35,l.valid&&l.z===I.z&&l!==I&&s&&u<r&&(o=l,r=u),l.filters=null}if(o&&o.valid){var d="switchPlayer";C&&(d="followPlayer"),S.emit(d,o.serverId),Te=!0}P=!1,p&&(C=!1)}else if(Me)for(n=0;n<te.length;n++){var h=te[n],f={x:F.x+h.x,y:F.y+h.y};if(Math.distanceBetween(t,f)<=75){ye(h),Te=!0,Me=!1;break}}else v=!0,pe=10,Date.now()-Ie<250&&(t.action=!0,S.emit("move",t),Te=!0);Ie=Date.now()}}null!=S&&!S.connected&&S.forcedDisconnect&&(window.location="/")}}),window.document.addEventListener(ke+"move",function(e){g=e.clientX,m=e.clientY,be-g,ve-m,be=g,ve=m,null!=S&&S.connected&&s>=r&&(G.visible=!1,G.text=""),s=0}),window.document.addEventListener(ke+"up",function(e){if(g=e.clientX,m=e.clientY,!(V.tutorialData&&m>t-256)){if(v=!1,xe--,p)try{document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||Ae(document.body)}catch(e){}if(null!=S&&S.connected&&c.renderer.plugins.interaction.eventData.data)if((2===we||p&&Date.now()-Ie>400)&&I)(a=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage)).action=!0,S.emit("move",a);else if(2===we&&h)0===q.z?q.z=1:q.z=0;else if(0===we&&I){var a=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage);if(Math.distanceBetween(a,I)<=25?C?C=!1:Me=!!I.canControl&&!Me:Me=!1,!Te&&!Me){a=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage);S.emit("move",a)}}Te=!1,null}}),game.tryFullscreen=function(){try{document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||Ae(document.body)}catch(e){}},function(){for(var e in N)PIXI.loader.add(e,"assets/"+N[e]);game.isPlayScreen?Z():B={},PIXI.loader.load()}();var Ee=[0,-1,-2.5,-1,0,1,2.5,1],_e=[0,1,2.5,1,0,-1,-2.5,-1];function Pe(e,t,a,n,i,r,o,s,l){var u=qe(e,"insect",t,a,n,i,s,l);u.frame=0,u.animation=0;var d=new PIXI.Sprite;d.width=r,d.height=o,d.anchor.set(.5),u.sprite=d,u.addChild(d);var h=0;l&&l.zOffset&&(h=l.zOffset);var p=0,f=!1,g=!1,m=!1,v=null;if("ant_worker"===t?(v=u.netData.soldier?Oe(j.ant_soldier.texture,128,128):Oe(j.ant_worker.texture,128,128),g=!0,f=!0,m=!0):"ant_queen"===t?(v=Oe(j.ant_queen.texture,128,128),g=!0,f=!0,m=!0):"spider"===t?Math.random()>.6?(p=1,v=Oe(j.spider.texture,191,188)):(p=0,v=Oe(j.spider2.texture,64,64)):"bug"===t?"centipede"===u.netData.bugType?(v=Oe(j.centipede.texture,128,128),u.frame=h%6):v=Oe(j.bug.texture,32,32):"beetle"===t?v=Oe(j.goliath_beetle.texture,100,100):console.error("Invalid insect subtype:",t),d.texture=v[parseInt(u.frame)][u.animation],g){var w=new PIXI.Sprite;w.position.y=-.48*o,w.width=45,w.height=45,w.rotation=Math.random()*Math.PI*2,w.anchor.set(.5),u.carriedObjectSprite=w,u.addChild(w),u.carriedObjectSprite.visible=!1}var T=13421772,M=null;if(f){M=Oe(j.antenna.texture,128,64);var k=new PIXI.Sprite(M[0][0]);"ant_worker"===t?(k.position.y=.45*-o,k.width=.75*r,k.height=.4*o):(k.position.y=.56*-o,k.width=r,k.height=.5*o),k.anchor.set(.5),u.antennaSprite=k,u.addChild(k);T=8947848;var D=u.team;null!==u.netData.fakeTeam&&void 0!==u.netData.fakeTeam&&(D=u.netData.fakeTeam),1===D?T=16720418:2===D?T=2293538:3===D?T=2237183:4===D?T=16772096:5===D?T=16745984:6===D?T=16725198:7===D&&(T=65532),d.tint=T,k.tint=T}if(m){u.cosmeticsContanier=new PIXI.Container,u.cosmeticsContanier.visible=!1,u.addChild(u.cosmeticsContanier);var S=new PIXI.Sprite;if(S.rotation=0,S.anchor.set(.5),S.visible=!1,u.cosmeticsHeadSprite=S,u.cosmeticsContanier.addChild(S),"ant_queen"===t){var A=new PIXI.Sprite(j.ant_queen_wings.texture);A.position.y=0,A.width=r,A.height=o,A.anchor.set(.5),u.wingsSprite=A,u.addChild(A),u.wingsSprite.visible=u.netData.newQueen}var E=new PIXI.Sprite;E.rotation=0,E.anchor.set(.5),E.visible=!1,u.cosmeticsAbdomenSprite=E,u.cosmeticsContanier.addChild(E);var _=new PIXI.Sprite;_.rotation=0,_.anchor.set(.5),_.visible=!1,u.cosmeticsThoraxSprite=_,u.cosmeticsContanier.addChild(_)}var P=new PIXI.Container;P.getZIndex=function(){return u.getZIndex()-P.y-100},u.guiSpriteContainer=P,c.cstage.addChild(P);var C=new PIXI.Sprite(X[0][0]);if(C.width=40,C.height=40,C.anchor.set(.5),u.guiSprite=C,P.addChild(C),"ant_worker"===t||"ant_queen"===t||"spider"===t||"bug"===t&&u.netData&&"centipede"===u.netData.bugType&&"head"===u.netData.centipedeType){var L=new PIXI.Text;L.position.y=-40,L.anchor.x=.5,L.visible=!1,L.style.fill=16777215,L.style.fontSize=20,u.chat=L,P.addChild(L)}if(f){var O=new PIXI.Text;O.position.y=1,O.anchor.x=.5,O.visible=!1,O.style.fill=16777215,O.style.fontSize=15,u.name=O,P.addChild(O);var z=new PIXI.Sprite(H[0][0]);z.position.y=-5,z.scale.set(.75),z.visible=!1,z.anchor.set(.5),u.devtag=z,P.addChild(z)}u.updateFilters=function(){u.netData&&u.netData.name?u.filters=[new PIXI.filters.GlowFilter(8,.5,0,T,.1)]:u.filters=null},u.updateFilters(),u.setNewQueen=function(e){u.netData.newQueen=e,u.wingsSprite.visible=u.netData.newQueen},u.changeName=function(e){u.netData.name=e.name,u.netData.isDev=e.isDev,u.netData.settings=e.settings,u.updateFilters();try{if(u.netData.settings){if(u.cosmeticsContanier.visible=!0,u.netData.settings.head){u.cosmeticsHeadSprite.visible=!0;var a=u.netData.settings.head.width?u.netData.settings.head.width:32,n=u.netData.settings.head.height?u.netData.settings.head.height:32,i=Oe(j[u.netData.settings.head.texture].texture,a,n);u.cosmeticsHeadSprite.texture=i[u.netData.settings.head.frame][u.netData.settings.head.animation];var r=u.netData.settings.head.scale?u.netData.settings.head.scale:1,s=.22;"ant_queen"===t&&(s=.35),"ant_worker"!==t||u.netData.soldier||(r*=.85),"ant_worker"===t&&u.netData.soldier&&u.width>80&&(s=.26,r*=1.3),s*=u.netData.settings.head.offsety?u.netData.settings.head.offsety:1,u.cosmeticsHeadSprite.position.y=-o*s,u.cosmeticsHeadSprite.width=a*r,u.cosmeticsHeadSprite.height=n*r}else u.cosmeticsHeadSprite.visible=!1;if(u.netData.settings.thorax){u.cosmeticsThoraxSprite.visible=!0;a=u.netData.settings.thorax.width?u.netData.settings.thorax.width:32,n=u.netData.settings.thorax.height?u.netData.settings.thorax.height:32,i=Oe(j[u.netData.settings.thorax.texture].texture,a,n);u.cosmeticsThoraxSprite.texture=i[u.netData.settings.thorax.frame][u.netData.settings.thorax.animation];r=u.netData.settings.thorax.scale?u.netData.settings.thorax.scale:1,s=1;"ant_worker"!==t||u.netData.soldier||(r*=.8),"ant_worker"===t&&u.netData.soldier&&u.width>80&&(r*=1.25),s*=u.netData.settings.thorax.offsety?u.netData.settings.thorax.offsety:.02,u.cosmeticsThoraxSprite.position.y=-o*s,u.cosmeticsThoraxSprite.width=a*r,u.cosmeticsThoraxSprite.height=n*r}else u.cosmeticsThoraxSprite.visible=!1;if(u.netData.settings.abdomen){u.cosmeticsAbdomenSprite.visible=!0;a=u.netData.settings.abdomen.width?u.netData.settings.abdomen.width:32,n=u.netData.settings.abdomen.height?u.netData.settings.abdomen.height:32,i=Oe(j[u.netData.settings.abdomen.texture].texture,a,n);u.cosmeticsAbdomenSprite.texture=i[u.netData.settings.abdomen.frame][u.netData.settings.abdomen.animation];r=u.netData.settings.abdomen.scale?u.netData.settings.abdomen.scale:1,s=.22;"ant_worker"!==t||u.netData.soldier||(s=.16,r*=.75),"ant_worker"===t&&u.netData.soldier&&u.width<=80&&(r*=.7,s=.16),"ant_worker"===t&&u.netData.soldier&&u.width>80&&(s=.16,r*=1.15),s*=u.netData.settings.abdomen.offsety?u.netData.settings.abdomen.offsety:1,u.cosmeticsAbdomenSprite.position.y=o*s,u.cosmeticsAbdomenSprite.width=a*r,u.cosmeticsAbdomenSprite.height=n*r}else u.cosmeticsAbdomenSprite.visible=!1}else u.cosmeticsContanier.visible=!1}catch(e){u.cosmeticsContanier.visible=!1,console.error("Failed to load cosmetics:",e)}};var N=null,R=parseInt(8*Math.random()),Z=.2,F=u.tick,W=!1,$=Math.round(30*Math.random()),U=0;return u.tick=function(){u.name&&(u.netData&&u.netData.name&&u.netData.alive&&(u!==I||!I.canControl)?(u.name.text=u.netData.name,u.name.visible=Math.distanceBetween({x:y,y:b},u)<32,u.devtag.visible=u.name.visible&&u.netData.isDev):(u.name.visible=!1,u.devtag.visible=!1)),u.netData.alive?("ant_worker"===t&&"food"===u.carriedObject&&0===u.z&&(Math.abs(u.dx)>.5||Math.abs(u.dy)>.5)&&($<=0?(!function(e,t,a,n,i,r,o){var s=new PIXI.Container;o||(o={});s.x=t,s.y=a,s.z=n,s.valid=!0,s.lastX=t,s.lastY=a,s.dx=0,s.dy=0,s.type=e,s.maxLifetime=100,"pheromone"===e&&(s.maxLifetime=4e3,s.sprite=new PIXI.Sprite(j.pheromone.texture),s.sprite.width=i,s.sprite.height=r,s.sprite.anchor.set(.5),s.addChild(s.sprite),o.color&&(s.sprite.tint=o.color));s.lifetime=s.maxLifetime,s.tick=function(){s.lifetime>0?s.lifetime--:s.remove(),"pheromone"===e&&(s.sprite.alpha=s.lifetime/s.maxLifetime*.75),s.sprite&&(s.visible=s.isVisible()),s.lastX=s.x,s.lastY=s.y},s.getZIndex=function(){return 50-s.y},s.isVisible=function(){return s.z===q.z&&je(s)},s.onRemove=function(){},s.remove=function(){s.valid=!1,s.onRemove(),c.cstage.removeChild(s)},c.cstage.addChild(s),x.push(s)}("pheromone",u.x,u.y,u.z,45,45,{color:T}),$=35+Math.round(20*Math.random())):$--),u.netData&&u.netData.digging&&"ant_worker"===t?(u.animation=1,u.frame+=.22,parseInt(u.frame)>=8&&(u.frame=0,fe(B["wood_hit"+(parseInt(4*Math.random())+1)],u,.02)),N&&(me(N),N=null)):!W||"ant_queen"===t||"bug"===t&&u.netData&&"centipede"===u.netData.bugType?(B.walk&&(Math.abs(u.dx)>=.5||Math.abs(u.dy)>=.5)&&"body"!==u.netData.centipedeType?N?ge(N):fe(B.walk,u,.12,function(e){N=e}):N&&(me(N),N=null),"ant_worker"===t||"ant_queen"===t?(u.animation=0,(Math.abs(u.dx)>=.5||Math.abs(u.dy)>=.5)&&(u.frame+=.3+.04*(Math.abs(u.dx)+Math.abs(u.dy))),parseInt(u.frame)>=8&&(u.frame=0),u.cosmeticsHeadSprite&&u.cosmeticsHeadSprite.visible&&(u.cosmeticsHeadSprite.x=.21*-Ee[Math.floor(u.frame)]),u.cosmeticsAbdomenSprite&&u.cosmeticsAbdomenSprite.visible&&(u.cosmeticsAbdomenSprite.x=.5*-_e[Math.floor(u.frame)])):"spider"===t?(u.animation=0,(Math.abs(u.dx)>=.5||Math.abs(u.dy)>=.5)&&(u.frame+=.24),parseInt(u.frame)>=(1===p?5:4)&&(u.frame=0)):"bug"===t?u.netData&&"centipede"===u.netData.bugType?"head"===u.netData.centipedeType?(u.animation=0,u.frame+=.12,parseInt(u.frame)>=6&&(u.frame=0)):"tail"===u.netData.centipedeType?(u.animation=0,u.frame=6):(u.animation=1,(Math.abs(u.dx)>=.5||Math.abs(u.dy)>=.5)&&(u.frame+=.1+.04*(Math.abs(u.dx)+Math.abs(u.dy))),parseInt(u.frame)>=6&&(u.frame=0)):((Math.abs(u.dx)>=.5||Math.abs(u.dy)>=.5)&&(u.frame+=.18),parseInt(u.frame)>=4&&(u.frame=0)):"beetle"===t&&(u.animation=0,(Math.abs(u.dx)>=.5||Math.abs(u.dy)>=.5)&&(u.frame+=.18),parseInt(u.frame)>=4&&(u.frame=0))):("spider"!==t&&"bug"!==t&&"beetle"!==t||(u.animation=1,u.frame+=.22,parseInt(u.frame)>=4&&(u.frame=0,W=!1)),"ant_worker"!==t&&"ant_queen"!==t||(u.animation=1,u.frame+=.22,parseInt(u.frame)>=8&&(u.frame=0,W=!1))),f&&(R+=Z,parseInt(R)>=8&&(R=0,Z=.08+Math.random()/6),u.antennaSprite.texture=M[parseInt(R)][0])):C.visible=!1,L&&L.visible&&L.removeChat<Date.now()&&(L.removeChat=null,de||(L.visible=!1)),U>0?(U--,d.tint=16777215):d.tint=T;try{d.texture=v[parseInt(u.frame)][u.animation]}catch(e){}F(),P.visible=u.isVisible()&&u.netData.alive,C.visible=u.netData.hungry,P.visible&&(P.x=u.x,P.y=u.y-30)},u.changeGrabbedObject=function(e){if(u.carriedObject=e?e.subtype:null,e){if("food"===e.subtype)e.netData.superFood?u.carriedObjectSprite.texture=j.super_food.texture:u.carriedObjectSprite.texture=j.food.texture,u.carriedObjectSprite.visible=!0;else if("aphid"===e.subtype)u.carriedObjectSprite.texture=j.aphid.texture,u.carriedObjectSprite.visible=!0;else if("dirt"===e.subtype)u.carriedObjectSprite.texture=j.dirt.texture,u.carriedObjectSprite.visible=!0;else if("brood"===e.subtype){var t=Oe(j.brood.texture,64,64);u.carriedObjectSprite.texture=t[0][e.data],u.carriedObjectSprite.visible=!0}e.size?(w.width=e.size,w.height=e.size):(w.width=45,w.height=45)}else u.carriedObjectSprite.visible=!1;fe(B["wood_hit"+(parseInt(4*Math.random())+1)],u,.15)},u.setAIState=function(e){u.netData.name=e},u.setDigging=function(e){u.netData.digging=e},u.performAttack=function(){W=!0,u.frame=0},u.damage=function(){fe(B["wood_hit"+(parseInt(4*Math.random())+1)],u,.15),U=5},u.kill=function(){u.netData.alive=!1,u.showDead(),u===I&&game.onPlayerDead(),N&&(me(N),N=null)},u.onRemove=function(){c.cstage.removeChild(u.guiSpriteContainer),N&&(me(N),N=null)},u.showDead=function(){f&&(u.antennaSprite.visible=!1),g&&(u.carriedObjectSprite.visible=!1),u.wingsSprite&&(u.wingsSprite.visible=!1),C.visible=!1,"ant_worker"===u.subtype?(u.frame=0,u.animation=3):"spider"===u.subtype?(u.frame=0,u.animation=2):"bug"===u.subtype?"centipede"===u.netData.bugType?"head"===u.netData.centipedeType?(u.frame=7,u.animation=0):"tail"===u.netData.centipedeType?(u.frame=7,u.animation=1):(u.frame=6,u.animation=1):(u.frame=3,u.animation=2):"beetle"===u.subtype?(u.frame=0,u.animation=1):(u.frame=1,u.animation=1)},u.netData.alive||u.showDead(),u.getZIndex=function(){return u.netData.alive?"spider"===t||"bug"===t||"beetle"===t?-u.y-200-h:-u.y-h:200-u.y},u}function Ce(e,t,a,n,i,r,o,s,l){var u=qe(e,"object",t,a,n,i,s,l);if("stick"===t&&(u.clientsideOnly=!0),"rock"===t||"stick"===t||"plant"===t){var d=new PIXI.Sprite;d.tint=0,d.width=r,d.height=o,d.alpha=.5,d.anchor.set(.5),u.shadow=d,u.addChild(d)}var h=new PIXI.Sprite;h.width=r,h.height=o,h.anchor.set(.5),u.sprite=h,u.addChild(h);var p=null;if("anthill"===t){h.texture=j.anthill.texture;var f=new PIXI.Sprite(j.anthill_below.texture);f.y=-20,f.width=r,f.height=o,f.anchor.set(.5),u.sprite2=f,u.addChild(f)}else"food"===t?l.superFood?h.texture=j.super_food.texture:h.texture=j.food.texture:"brood"===t?(p=Oe(j.brood.texture,64,64),h.texture=p[0][0]):"rock"===t?(p=[[j.rock1.texture,j.rock2.texture,j.rock3.texture,j.rock4.texture]],h.texture=p[0][l.rockType],u.shadow.texture=h.texture):"stick"===t?(p=Oe(j.sticks.texture,512,128),h.texture=p[0][l.stickType],u.shadow.texture=h.texture):"plant"===t?(h.texture=j.plant.texture,u.shadow.texture=h.texture):"aphid"===t?h.texture=j.aphid.texture:console.error("Invalid object subtype:",t);if("brood"===t){var g=new PIXI.Container;g.getZIndex=function(){return-g.y-100},u.guiSpriteContainer=g,c.cstage.addChild(g);var m=new PIXI.Sprite(X[0][0]);m.width=40,m.height=40,m.anchor.set(.5),u.guiSprite=m,g.addChild(m)}var y=parseInt(8*Math.random()),b=.2,v=u.tick,w=!1;return u.tick=function(){if("brood"===t&&(y+=b,parseInt(y)>=8&&(y=0,b=.08+Math.random()/6),u.netData&&u.netData.broodStage&&(h.texture=p[parseInt(y)][u.netData.broodStage])),v(),u.shadow&&!w&&(w=!0,u.shadow.x=10*Math.cos(-u.rotation),u.shadow.y=15*Math.sin(-u.rotation)),u.visible&&"plant"===u.subtype){var e=1e3;if(I)e=Math.distanceBetween(u,I);else if(c.renderer.plugins.interaction&&c.renderer.plugins.interaction.eventData&&c.renderer.plugins.interaction.eventData.data){var a=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage);e=Math.distanceBetween(u,a)}u.alpha=e<200?.4:1}if("anthill"===t)if(u.visible=!0,u.sprite.visible=q.z===u.z,u.sprite2.visible=q.z===u.z+1,u.netData.anthillSize<2){var n=.5+u.netData.anthillSize/2/2;u.sprite.texture=j.anthill_small.texture,u.sprite.scale.x=n,u.sprite.scale.y=n}else{(n=.5+(u.netData.anthillSize-2)/4/2)>1&&(n=1),u.sprite.texture=j.anthill.texture,u.sprite.scale.x=n,u.sprite.scale.y=n}u.guiSpriteContainer&&(u.guiSpriteContainer.visible=u.isVisible(),u.guiSprite.visible=u.netData.hungry,u.guiSpriteContainer.visible&&(g.x=u.x,g.y=u.y-30))},u.changeAnthillSize=function(e){u.netData.anthillSize=e},u.onRemove=function(){c.cstage.removeChild(u.guiSpriteContainer)},u.changeBroodStage=function(e){u.netData.broodStage=e},u.getZIndex=function(){return"plant"===t?-u.y-1e3:"anthill"===t?q.z===u.z?-u.y+(u.netData.anthillSize>=4?3e3:5e3):8-u.y:"rock"===t?4200-u.y:"stick"===t?4500-u.y:50-u.y},u}var Le={};function Oe(e,t,a){if(Le[e.baseTexture.imageUrl])return Le[e.baseTexture.imageUrl];for(var n=[],i=0;i<Math.round(e.baseTexture.width/t);i++){for(var r=[],o=0;o<Math.round(e.baseTexture.height/a);o++){var s=new PIXI.Rectangle(i*t,o*a,t,a),l=new PIXI.Texture(PIXI.BaseTexture.fromImage(e.baseTexture.imageUrl),s);r.push(l)}n.push(r)}return Le[e.baseTexture.imageUrl]=n,n}function qe(e,t,a,n,i,r,o,s){var l=new PIXI.Container;return l.serverId=e,l.subtype=a,l.team=o,l.netData=s,l.states=[],l.x=n,l.y=i,l.z=r,l.lastX=n,l.lastY=i,l.dx=0,l.dy=0,l.type=t,l.valid=!0,l.tick=function(){if(l.states.length>=2){var e=l.states[0],t=l.states[1],a=Date.now()-e.serverTimeDiff,n=2*(1-(t.time-e.time)/(a-e.time)),i=Math.lerp(e,t,n);l.x=i.x,l.y=i.y,Math.abs(e.rotation-t.rotation)>Math.PI/2?(e.rotation=t.rotation,l.rotation=e.rotation):l.rotation=Math.vallerp(e.rotation,t.rotation,n)}l.sprite&&(l.visible=l.isVisible()),l.dx=l.x-l.lastX,l.dy=l.y-l.lastY,l.lastX=l.x,l.lastY=l.y},l.changeName=function(e){l.netData.name=e.name,l.netData.isDev=e.isDev,l.netData.settings=e.settings},l.setHungry=function(e){l.netData.hungry=e},l.addState=function(e){e.serverTimeDiff=Date.now()-e.time;var t=0;l.states.length>=2&&(t=l.states[1].time),e.time>t&&l.states.push(e),l.states.length>2&&l.states.shift()},l.getZIndex=function(){return-l.y},l.changeZLevel=function(e){l.z=e},l.isVisible=function(){return l.z===q.z&&je(l)},l.onRemove=function(){},l.remove=function(){l.valid=!1,l.onRemove(),c.cstage.removeChild(l)},c.cstage.addChild(l),w.push(l),l}var ze=250;function je(a){return a.x>=q.x-ze&&a.y>=q.y-ze&&a.x<=q.x+e+ze&&a.y<=q.y+t+ze}game.onPlayerDead=function(){game.showBannerAd&&game.showBannerAd()},game.onPlayerAlive=function(){game.hideBannerAd&&game.hideBannerAd()};var Be=0,Ne=null,Re=null,Ze=null,Fe=new PIXI.filters.ColorMatrixFilter,We=!1,$e=-10,Ue=-10,Ge=-10;Fe.night(.2,!0);var Xe=0;c.ticker.add(function(){var i=Date.now();if(!(i-Xe<10)){if(Xe=i,c.renderer.plugins.interaction.eventData.data){var r=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage);y=r.x,b=r.y}if("lobby"===f&&Be){Be-=c.ticker.elapsedMS;var o=Math.round(Be/1e3);o>0?$("#lobby-menu-title-message").text("Starting in "+o+" seconds"):$("#lobby-menu-title-message").text("Starting...")}if(V&&V.tutorialData){V.square.x=V.avatar.width,V.square.width=e,V.text.x=V.square.x+12,V.text.y=12,V.text.style.wordWrapWidth=V.square.width-V.square.x-24,V.square.height=V.avatar.height,V.y=t-V.height,V.visible=!0}else V&&(V.visible=!1);if(!game.isPlayScreen){if(!We){n=Math.round(e/a)+5,We=!0;for(var s=0;s<50;s++)Pe(-1,"ant_worker",Math.random()*e,Math.random()*t,0,65,65,Math.floor(8*Math.random()),{alive:!0})}for(s=0;s<w.length;s++){if("ant_worker"===(A=w[s]).subtype&&(A.moveTo||(A.moveTo=(void 0,(p=Math.random())<=.25?{x:n*a*Math.random(),y:0}:p>.25&&p<=.5?{x:0,y:n*a*Math.random()}:p>.5&&p<=.75?{x:n*a*Math.random(),y:n*a}:{x:n*a,y:n*a*Math.random()}),A.moveTo.x-=200,A.moveTo.y-=200),A.moveTo)){var l=Math.angleBetween(A,A.moveTo);(L=Math.distanceBetween(A,A.moveTo))<=20?A.moveTo=null:(A.rotation=l+Math.PI/2,A.x+=2*Math.cos(l),A.y+=2*Math.sin(l))}}}var p;if(I&&I.valid&&I.canControl&&c.renderer.plugins.interaction.eventData.data){var g=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage),m=1e4,k=null;for(s=0;s<w.length;s++){var A=w[s],_=!1,L=Math.distanceBetween(g,A);_=P||C?("ant_worker"===A.subtype||P&&"ant_queen"===A.subtype)&&!A.netData.name&&A.netData.alive&&A.team===I.team&&L<=35:("brood"===A.subtype||"food"===A.subtype||"anthill"===A.subtype||"aphid"===A.subtype)&&L<=("anthill"===A.subtype?40:16),A.valid&&A.z===I.z&&A!==I&&_&&L<m&&(k=A,m=L),A.updateFilters?A.updateFilters():A.filters=null}k&&k.valid&&(k.filters=[O])}if(Me&&I&&I.valid&&I.netData&&I.netData.alive&&c.renderer.plugins.interaction.eventData.data)for(g=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage),s=0;s<te.length;s++){var z=te[s],N={x:F.x+z.x,y:F.y+z.y};Math.distanceBetween(g,N)<=75?(z.text.style.fontSize=25,z.text.style.fill=16777113,z.text.filters=[O]):(z.text.style.fontSize=22,z.text.style.fill=16777215,z.text.filters=null)}if(q.z>=1&&D){var R=Math.floor(q.x/a),Z=Math.floor(q.y/a);if(R!==$e||Z!==Ue||q.z!==Ge){$e=R,Ue=Z,Ge=q.z;for(var G=0;G<n;G++)for(var X=0;X<n;X++)D[G][X].visible=!1;for(var H=-2;H<Math.floor(e/a)+2;H++)for(var Y=-2;Y<Math.floor(t/a)+2;Y++){var ae=R+H,ne=Z+Y;if(D[ne]){var ie=D[ne][ae];ie&&(ie.visible=!(15===ie.corners&&15===ie.edges))}}}}if(u!==d)Math.abs(u-d)>.005?u>d?u-=.001:u+=.001:u=d;for(s=0;s<w.length;s++){(A=w[s]).valid?A.tick():(w.splice(s,1),s--)}for(s=0;s<x.length;s++){var re=x[s];re.valid?re.tick():(x.splice(s,1),s--)}if(null!=S&&S.connected){var oe=0,le=0;if(!de&&I?(ce[87]?le=-1:ce[83]&&(le=1),ce[65]?oe=-1:ce[68]&&(oe=1),0===oe&&0===le||(pe<=0?(S.emit("move",{x:I.x+60*oe,y:I.y+60*le}),pe=2):pe--)):!de&&h&&(ce[87]?le=-1:ce[83]&&(le=1),ce[65]?oe=-1:ce[68]&&(oe=1),0!==oe&&(q.x+=15*oe),0!==le&&(q.y+=15*le)),v&&0===we&&c.renderer.plugins.interaction.eventData.data){g=c.renderer.plugins.interaction.eventData.data.getLocalPosition(c.cstage);pe<=0?(S.emit("move",g),pe=10):pe--}}if(0===q.z?(W.scale.x=2,W.scale.y=2,W.texture=j.outside.texture):(W.scale.x=1.5,W.scale.y=1.5,W.texture=se[0][1]),F.visible=I&&I.netData.alive&&Me,F.visible&&(F.x=I.x,F.y=I.y-5),P?(K.text="Tap another ant to switch to.",K.visible=!0):C?(K.text="Tap another ant to follow you. (Right click or tap your ant to stop)",K.visible=!0):K.visible=!1,I&&!h){var ue={x:I.x*q.zoom-e/2,y:I.y*q.zoom-t/2};q.x=ue.x,q.y=ue.y,q.z=I.z}if(Q&&I)if(T&&T.valid&&T.team===I.team)if((L=Math.distanceBetween(I,T))>e/3){l=Math.angleBetween(I,T);Q.visible=!0,Q.x=I.x+Math.cos(l)*(e/6),Q.y=I.y+Math.sin(l)*(t/6),Q.rotation=l+Math.PI/2}else Q.visible=!1;else Q.visible=!1;if(J&&I&&(J.visible=M&&M.valid&&M.team===I.team&&M.netData&&M.netData.hungry),E)for(var he=0;he<2;he++){var fe=E[he];fe&&(fe.visible=q.z===he)}q.x<0&&(q.x=0),q.x+e>n*a&&(q.x=n*a-e),q.y<0&&(q.y=0),q.y+t>n*a&&(q.y=n*a-t),game.isPlayScreen&&B.aboveground&&B.aboveground_night&&B.underground&&(0===q.z?(null===Ne&&(Ne=B.aboveground.play(),Ze&&(B.underground.pause(Ze),Ze=null)),null===Re&&(Re=B.aboveground_night.play(),Ze&&(B.underground.pause(Ze),Ze=null)),B.aboveground.volume(.1*(1-u)),B.aboveground_night.volume(.004*u)):null===Ze&&(Ze=B.underground.play(),Ne&&(B.aboveground.pause(Ne),B.aboveground_night.pause(Re),Ne=null,Re=null))),q.z>=1?(ee.uniforms.resX=Ye(e),ee.uniforms.resY=Ye(t),ee.uniforms.size=.2,ee.uniforms.amount=5,I&&I.valid?(ee.uniforms.focalPointX=I.x-q.x,ee.uniforms.focalPointY=I.y-q.y):(ee.uniforms.focalPointX=e/2,ee.uniforms.focalPointY=t/2),c.cstage.filters=[ee]):0===u?c.cstage.filters=null:(ee.uniforms.resX=Ye(e),ee.uniforms.resY=Ye(t),ee.uniforms.size=.04*u,ee.uniforms.amount=2.5*u,I&&I.valid?(ee.uniforms.focalPointX=I.x-q.x,ee.uniforms.focalPointY=I.y-q.y):(ee.uniforms.focalPointX=e/2,ee.uniforms.focalPointY=t/2),Fe.alpha=.3*u,c.cstage.filters=[Fe,ee]),U.visible=game.isPlayScreen&&!game.isMapEditor&&!h&&!f&&(!I||!I.canControl||!I.netData.alive),c.cstage.x=Math.floor(-q.x),c.cstage.y=Math.floor(-q.y),c.cstage.scale.x=q.zoom,c.cstage.scale.y=q.zoom,c.cstage.updateLayersOrder()}});var He=8;function Ye(e){return e<256-He?256:e<512-He?512:e<1024-He?1024:e<2048-He?2048:4096}game.disconnect=function(){window.location.reload()},setInterval(function(){window.ga&&S&&S.connected&&ga("send","event","heartbeat","60s")},6e4);var Qe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Je(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return Qe[e]})}var Ve=$("#lobby-menu-chat-text"),Ke=0;Ve.bind("enterKey",function(e){e.preventDefault();var t=Ve.val();t&&t.trim&&(t=t.trim()),Ve.val(""),S&&t&&t.length>=1&&t.length<=500&&Date.now()-Ke>600&&(Ke=Date.now(),S.emit("chat",t))}),Ve.keyup(function(e){e.preventDefault(),13===e.keyCode&&$(this).trigger("enterKey")}),game.lobbyReady=function(){S.emit("lobbyReady")},game.lobbyJoinTeam=function(e){S.emit("lobbyJoinTeam",e)},game.lobbyNewTeam=function(){S.emit("lobbyNewTeam")},game.lobbyLockTeam=function(){S.emit("lobbyLockTeam")},game.copyShareLink=function(){!function(e){var t,a,n="INPUT"===e.tagName||"TEXTAREA"===e.tagName;if(n)i=e,t=e.selectionStart,a=e.selectionEnd;else{if(!(i=document.getElementById("_hiddenCopyText_"))){var i=document.createElement("textarea");i.style.position="absolute",i.style.left="-9999px",i.style.top="0",i.id="_hiddenCopyText_",document.body.appendChild(i)}i.textContent=e.textContent}var r,o=document.activeElement;i.focus(),i.setSelectionRange(0,i.value.length);try{r=document.execCommand("copy")}catch(e){r=!1}o&&"function"==typeof o.focus&&o.focus(),n?e.setSelectionRange(t,a):i.textContent=""}(document.getElementById("lobby-menu-share-link"))},Math.angleBetween=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},Math.distanceBetween=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},Math.magnitude=function(e){return Math.hypot(e.dx,e.dy)},Math.vallerp=function(e,t,a){return e+(t-e)*a},Math.lerp=function(e,t,a){return{x:e.x+(t.x-e.x)*a,y:e.y+(t.y-e.y)*a}}}();var adplayer=null,aiptag=aiptag||{},RANK_CONSTANT=.075;aiptag.cmd=aiptag.cmd||[],aiptag.cmd.player=aiptag.cmd.player||[],aiptag.cmd.display=aiptag.cmd.display||[],aiptag.gdprShowConsentTool=!0,aiptag.cmd.player.push(function(){adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!0,AD_CENTERPLAYER:!0,LOADING_TEXT:"Loading Advertisement",PREROLL_ELEM:function(){return document.getElementById("preroll")},AIP_COMPLETE:function(){$("#preroll").hide(),game.videoComplete()},AIP_REMOVE:function(){}})});var API_URL=window.location.host,isProduction="antwar.io"===window.location.host;-1!==API_URL.indexOf("antwar.io")&&(API_URL="api."+API_URL),API_URL=window.location.protocol+"//"+API_URL;var pollfishConfig={api_key:"411de1ec-67b5-47fe-90d5-f564ab95f73b",debug:!isProduction,ready:pollfishReady,userNotEligibleCallback:customUserNotEligible,surveyCompletedCallback:customSurveyFinished,surveyAvailable:customSurveyAvailable};function pollfishReady(){console.log("Pollfish ready."),Pollfish.hide()}function customUserNotEligible(){game.availableSurveyData=null,updateAvailableSurvey()}function customSurveyFinished(){if(game.availableSurveyData&&game.availableSurveyData.revenue){var e=Math.round(12*game.availableSurveyData.revenue),t=0;try{t=parseInt($("#coins").text())}catch(e){}t+=e,$("#coins").text(t)}game.availableSurveyData=null,updateAvailableSurvey()}function customSurveyAvailable(e){game.availableSurveyData=e,updateAvailableSurvey()}function updateAvailableSurvey(){if(game.availableSurveyData&&game.availableSurveyData.revenue){var e=Math.round(18*game.availableSurveyData.revenue);e>=1&&($("#openSurveyButton").show(),$("#openSurveyButton").html('<i class="fa fa-dollar"></i> Earn '+e+" Coins with Survey"))}else $("#openSurveyButton").hide()}function onGoogleSignIn(e){game.onGoogleSignIn(e)}game.availableSurveyData=null,function(){game.queryData=function(){for(var e,t=[],a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<a.length;n++)e=a[n].split("="),t.push(e[0]),t[e[0]]=e[1];return t}(),game.currentUser=null,updateAvailableSurvey(),game.disableTutorialAsk="true"===Cookies.get("disableTutorialAsk");try{var e=parseInt(Cookies.get("lastUpdateSeen"));e&&e!==$("#change-log-text").data().updateCount&&$("#new-updates").show()}catch(e){}var t,a,n,i,r,o=!1;function s(e){$("#ad-menu").remove(),game.isPlayScreen=!0,e&&(game.isSingleplayer=!0),e||game.queryData&&game.queryData.token?($("#ui").hide(),game.hideBannerAd(),x()):window.location="/",$(".game-menu-button").show()}if(game.showBannerAd=function(){"/play/"===window.location.pathname?$("#ad-game").show():$("#ad-menu").show(),(!isMobile||window.innerHeight>window.innerWidth)&&aiptag.cmd.display.push(function(){o?aipDisplayTag.refresh("antwar-io_300x250"):(aipDisplayTag.display("antwar-io_300x250"),o=!0)})},game.hideBannerAd=function(){"/play/"===window.location.pathname?$("#ad-game").hide():$("#ad-menu").hide(),$("#antwar-io_300x250").hide()},game.openSurvey=function(){ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openSurvey"}),game.currentUser?game.availableSurveyData&&Pollfish.showFullSurvey():$("#openSignInButton").click()},"/play/"===window.location.pathname?s():($("#ad-game").remove(),game.queryData&&(game.queryData.token||game.queryData.invite)&&x(),(isMobile||self!==top)&&$("body").css({"overflow-y":"auto"}),game.showBannerAd(),$("#shop-head").on("click",function(e){e.preventDefault(),b("head")}),$("#shop-thorax").on("click",function(e){e.preventDefault(),b("thorax")}),$("#shop-abdomen").on("click",function(e){e.preventDefault(),b("abdomen")}),$.getScript("https://checkout.stripe.com/checkout.js",function(){game.currentUser&&game.loadStripe()}),window.fbAsyncInit=function(){FB.init({appId:"2185014758385248",cookie:!0,xfbml:!0,version:"v2.12"}),FB.AppEvents.logPageView()},t=document,a="script",n="facebook-jssdk",r=t.getElementsByTagName(a)[0],t.getElementById(n)||((i=t.createElement(a)).id=n,i.src="https://connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(i,r)),$.ajax({url:API_URL+"/gameStats",method:"GET"}).then(function(e){$("#game-count").text(e.gameCount),$("#player-count").text(e.playerCount);var t,a,n,i,r,o,s,l="",d=Object.keys(e.regions),h="NA1",c=1e5;d.sort(function(e,t){return e>t});for(var p=0;p<d.length;p++){var f=e.regions[d[p]];l+='<option value="'+f.code+'">'+f.name+" ("+f.playerCount+" Players)</option>";var g=(t=e.coords[0],a=e.coords[1],n=f.coords[0],i=f.coords[1],r=u(n-t),o=u(i-a),s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(u(t))*Math.cos(u(n))*Math.sin(o/2)*Math.sin(o/2),6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))));g<c&&(h=f.code,c=g)}if("RU"===e.country)for(var p=0;p<d.length;p++)"AS1"===d[p]&&(h="AS1");$("#server-region").html(l).val(h);for(var m,y="",p=0;p<e.leaderboard.length;p++){var b=e.leaderboard[p],v=game.calculateRank(b.xp);y+="<li>"+(m=b.name,String(m).replace(/[&<>"'`=\/]/g,function(e){return I[e]}))+' <div style="float:right;"><img class="icon-xs" src="assets/rank_icon.png"> <b>'+v+"</b></div></li>"}$("#leaderboard").html(y),setTimeout(function(){game.queryData.shop?($("#openShopButton").click(),x()):game.queryData.signIn&&($("#openSignInButton").click(),x())},250)}),$.ajax({url:"https://storage.googleapis.com/pollfish_production/sdk/webplugin/pollfish.min.js",dataType:"script"})),setTimeout(function(){ga("send","pageview")},200),window.localStorage){var l=window.localStorage.getItem("name");l&&null!==l&&"null"!==l&&(document.getElementById("name").value=l)}function u(e){return e*Math.PI/180}game.calculateRank=function(e){return Math.floor(RANK_CONSTANT*Math.sqrt(e))};var d=[];game.joinGame=function(e){var t=d[e];t&&(game.queryData||(game.queryData={}),game.queryData.invite=t.token,game.play())},game.openGameList=function(e){e.preventDefault(),$("#gamelist").html('<i class="fa fa-refresh fa-spin fa-4x"></i>'),$.ajax({url:API_URL+"/gameList",method:"GET"}).then(function(e){if(e&&e.games&&e.games.length&&(d=e.games).sort(function(e,t){return t.players-e.players}),d.length){for(var t="",a=0;a<d.length;a++){var n=d[a];t+='<div class="card card-body bg-light" style="margin-bottom:4px;"><div class="row">';var i="lobby"===n.state?"In Lobby":"Playing";t+='<div class="col text-left"><b>Game #'+n.id+" ("+i+')</b><br><i class="fa fa-globe"></i> '+n.region.name+"</div>",t+='<div class="col pull-right text-right"><b><i class="fa fa-user"></i> '+n.players+"/"+n.maxPlayers+'&nbsp;&nbsp;</b><br><button onclick="game.joinGame('+a+')" type="button" style="margin-bottom:-6px;" class="btn btn-success btn-xs pull-right"><i class="fa fa-play"></i> Join</button></div>',t+="</div></div>"}$("#gamelist").html(t)}else $("#gamelist").html("<h3>No games found.</h3>")}),ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openGameList"})},game.openChangeLog=function(e){e.preventDefault(),$("#new-updates").hide(),Cookies.set("lastUpdateSeen",$("#change-log-text").data().updateCount,{expires:365}),ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openChangeLog"})};var h=!1,c=null;game.loadStripe=function(){return!!window.StripeCheckout&&(!h&&(h=!0,void(c=StripeCheckout.configure({key:"antwar.io"===window.location.host?"pk_live_0DjH3Q7yRROnuQjdrVOoHVPI":"pk_test_0P7TNqrsKhReeOJbcgCSeiY1",locale:"auto",email:game.currentUser.email}))))};var p=[],f=[],g=null,m={};game.openShop=function(){window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openShop"})};var y={};function b(e){g=e,$("#shop-"+g).tab("show"),$("#shop-cosmetic-body").html('<br><br><i class="fa fa-refresh fa-spin fa-4x"></i><br><br><br>'),$.ajax({url:API_URL+"/shop/"+g,method:"GET"}).then(function(e){e.unshift({name:"None",price:0});var t="";isMobile&&(t='style="width:'+200*e.length+'px; height:210px;"');for(var a="<div "+t+">",n=0;n<e.length;n++){var i=e[n];if(a+='<div class="shop-card"><div class="shop-card-body"><h5>'+(i.name?i.name:"&nbsp;")+"</h5>",i.data&&i.data.shop&&i.data.shop.image){a+='<div style="';var r=150,o=100,s=0,l=0,u="contain",d=null;i.data.shop.width&&(r=i.data.shop.width),i.data.shop.height&&(o=i.data.shop.height),i.data.shop.offsetx&&(s=-i.data.shop.offsetx),i.data.shop.offsety&&(l=-i.data.shop.offsety),i.data.shop.size&&(u=i.data.shop.size),i.data.shop.background&&(d=i.data.shop.background),a+="width:"+r+"px;",a+="height:"+o+"px;",a+="transform: scale(1.2);",a+="margin-top: 10px;",a+="background: url('"+i.data.shop.image+"') "+s+"px "+l+"px;",d&&(a+="background-color:"+d+";"),a+="max-width:150px;",a+="max-height:100px; background-size:"+u+"; background-repeat:no-repeat; margin-left:auto; margin-right:auto;",a+='"></div>'}else a+="<br>";i.description&&(a+='<small style="position:relative; top:-20px;">'+i.description+"</small>"),0===i.price||f.includes(i.slug)?m[g]===i.slug?a+='</div><button class="btn btn-old btn-primary">Equiped</div>':i.slug?a+='</div><button class="btn btn-old btn-default" onclick="game.equipItem(\''+i.slug+"')\">Equip</div>":a+='</div><button class="btn btn-old btn-default" onclick="game.equipItem(null)">Equip</div>':a+='</div><button class="btn btn-old btn-success" onclick="game.buyItem(\''+i.slug+"', "+i.price+')">Buy '+i.price+' <img class="icon-sm" src="assets/money_icon.png"></button></div>'}a+="</div>",$("#shop-cosmetic-body").html(a)})}game.buyCoins=function(e){var t=y[e];if(t){var a=Math.round(parseInt(t.attributes.coins)+t.attributes.coins*parseFloat(t.attributes.percentage));window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openPurchase",eventLabel:e}),c.open({name:"Bombsight Games",description:a+" Coins",amount:t.price,token:function(n){n.skuId=e,$("#loading-overlay").show();var i=Cookies.get("token");$.ajax({url:API_URL+"/buyCoins?token="+i,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(n)}).then(function(n){if(n.success){var i=parseInt($("#coins").text());$("#coins").text(i+a),window.ga&&(ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"performPurchase",eventLabel:e}),ga("ecommerce:addTransaction",{id:n.data.id,revenue:""+t.price/100}),ga("ecommerce:addItem",{id:n.data.id,name:a+" Coins",sku:e,category:"Coins",price:""+t.price/100,quantity:"1"}),ga("ecommerce:send")),$("#shop-coins-body").html("<br><br><h3>Thank you for your purchase and supporting us! :)</h3><br><br><br>"),$("#loading-overlay").hide()}else $("#loading-overlay").hide(),$.bootstrapGrowl(n.message,{type:"danger"})},function(){$("#loading-overlay").hide()})}})}window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openBuyCoins",eventLabel:e})},game.openCoinShop=function(e){e.preventDefault(),window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openCoinShop"}),game.currentUser?($("#shop-coin-modal-body-full").show(),$("#shop-coin-modal-body-guest").hide(),$("#shop-coins-body").html('<br><br><i class="fa fa-refresh fa-spin fa-4x"></i><br><br><br>'),$.ajax({url:API_URL+"/coins",method:"GET"}).then(function(e){var t="";y={},e.sort(function(e,t){return t.price-e.price});for(var a=0;a<e.length;a++){var n=e[a];y[n.id]=n;var i="alert-warning";0===a&&(i="alert-danger"),t+='<div class="text-right alert '+i+'">',0===a?t+='<h4 class="pull-left" style="display:inline-block;"><span class="badge badge-pill badge-danger">Best Deal</span></h4>':1===a&&(t+='<h4 class="pull-left" style="display:inline-block;"><span class="badge badge-pill badge-primary">Popular</span></h4>'),t+='<h4 style="display:inline-block;">',t+=parseInt(n.attributes.coins)+' <img class="icon-sm" src="assets/money_icon.png">&nbsp;+&nbsp;',t+='&nbsp;<span class="badge badge-pill badge-warning">'+100*parseFloat(n.attributes.percentage)+"% Free</span>&nbsp;=&nbsp;",t+=Math.round(parseInt(n.attributes.coins)+n.attributes.coins*parseFloat(n.attributes.percentage))+' <img class="icon-xs" src="assets/money_icon.png">&nbsp;',t+='&nbsp;<button class="btn btn-old btn-success" onclick="game.buyCoins(\''+n.id+"')\">$"+n.price/100+' Continue <i class="fa fa-arrow-right"></i></button></h4></div>'}$("#shop-coins-body").html(t)})):($("#shop-coin-modal-body-full").hide(),$("#shop-coin-modal-body-guest").show())},game.openCosmeticShop=function(e,t){if(t&&t.preventDefault(),e||(window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"openCosmeticShop"}),g="head"),game.currentUser){$("#shop-cosmetic-modal-body-full").show(),$("#shop-cosmetic-modal-body-guest").hide(),$("#shop-cosmetic-body").html('<br><br><i class="fa fa-refresh fa-spin fa-4x"></i><br><br><br>');var a=Cookies.get("token");$.ajax({url:API_URL+"/inventory?token="+a,method:"GET"}).then(function(e){p=e,$.ajax({url:API_URL+"/settings?token="+a,method:"GET"}).then(function(e){m=e||{};for(var t=0;t<p.length;t++){var a=p[t];f.push(a.skuSlug)}b(g)})})}else $("#shop-cosmetic-modal-body-full").hide(),$("#shop-cosmetic-modal-body-guest").show()},game.buyItem=function(e,t){$("#loading-overlay").show();var a=Cookies.get("token");$.ajax({url:API_URL+"/buyItem?token="+a,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({slug:e})}).then(function(a){if(a.success){try{var n=parseInt($("#coins").text());$("#coins").text(n-t)}catch(e){}game.equipItem(e),window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"buyItem",eventLabel:e}),$.bootstrapGrowl("Item purchased!",{type:"success"})}else $.bootstrapGrowl(a.message,{type:"danger"}),$("#loading-overlay").hide(),"Not enough funds."===a.message&&$("#shopCoinModalButton").click()})},game.equipItem=function(e){$("#loading-overlay").show(),e?m[g]=e:delete m[g];var t=Cookies.get("token");$.ajax({url:API_URL+"/settings?token="+t,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(m)}).then(function(t){m=t||{},game.openCosmeticShop(!0),$("#loading-overlay").hide(),window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"equipItem",eventLabel:e})})};var v=!1;function w(e){for(var t=e.serializeArray(),a={},n=0;n<t.length;n++)a[t[n].name]=t[n].value;return a}function x(){var e=window.location.toString(),t=e.substring(0,e.indexOf("?"));window.history.replaceState({},document.title,t)}game.videoComplete=function(){v&&(game.play(),v=!1)},game.onGoogleSignIn=function(e){var t=e.getAuthResponse().id_token;game.login("google",t)},game.showSignIn=function(){window.ga&&ga("send",{hitType:"event",eventCategory:"Game",eventAction:"showSignIn"}),setTimeout(function(){window.location="/?signIn=1"},100)},game.showShop=function(){window.ga&&ga("send",{hitType:"event",eventCategory:"Game",eventAction:"showShop"}),setTimeout(function(){window.location="/?shop=1"},100)},game.login=function(e,t){if(!game.isPlayScreen&&!Cookies.get("token")){var a={type:e,token:t};window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"signIn"}),$.ajax({url:API_URL+"/login",method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(a)}).then(function(e){e.success?(Cookies.set("token",e.data.session,{expires:365,secure:"localhost"!==window.location.hostname}),game.initUser()):$.bootstrapGrowl("Failed to login.",{type:"danger"})},function(e){$.bootstrapGrowl("Failed to connect to server for login.",{type:"danger"})})}},game.signInFacebook=function(){FB.login(function(e){e.authResponse&&game.login("facebook",e.authResponse.accessToken)},{scope:"public_profile,email"})},game.renderProfile=function(){$(".loggedout").hide(),$(".loggedin").show(),$("#profile").show(),$("#sign-out-button").show(),$("#profile-col").show(),$("#profile-name-edit-button").show(),$("#profile-name-main").text(game.currentUser.name),$("#username").hide()},game.initUser=function(){if(!game.isPlayScreen){var e=Cookies.get("token");e&&$.ajax({url:API_URL+"/session?token="+e,method:"GET"}).then(function(t){if(t&&t.session&&t.session.userId){$("#signInModal").modal("hide"),$("#shopCoinModal").modal("hide"),$("#shopCosmeticModal").modal("hide"),game.currentUser=t.user,pollfishConfig.uuid=game.currentUser.id;try{Pollfish.hide(),Pollfish.start(pollfishConfig)}catch(e){}game.renderProfile(),game.loadStripe&&game.loadStripe(),$.ajax({url:API_URL+"/settings?token="+e,method:"GET"}),$.ajax({url:API_URL+"/wallets?token="+e,method:"GET"}).then(function(e){if(e.success&&e.data&&e.data.data)for(var t=0;t<e.data.data.length;t++){var a=e.data.data[t];if("coins"===a.currency.slug)$("#coins").text(a.amount);else if("xp"===a.currency.slug){var n=RANK_CONSTANT*Math.sqrt(a.amount),i=Math.floor(n),r=n-i;$("#rank").text(i),$("#nextRank").text(i+1);var o=Math.round(100*r);$("#nextRankBar").width(o+"%"),$("#nextRankBarPercentage").text(o+"%")}}})}else Cookies.remove("token")},function(){Cookies.remove("token")})}},game.editProfile=function(){game.currentUser&&($("#profileName").val(game.currentUser.name),$("#profileEmail").val(game.currentUser.email))},$("#profile-form").submit(function(e){if(game.currentUser){var t=Cookies.get("token"),a=w($("#profile-form"));$("#loading-overlay").show(),$.ajax({url:API_URL+"/profile?token="+t,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(a)}).then(function(e){e.success?(game.currentUser.name=$("#profileName").val(),$.bootstrapGrowl("Profile saved successfully.",{type:"success"}),game.renderProfile()):e.message?$.bootstrapGrowl(e.message,{type:"danger"}):$.bootstrapGrowl("Failed to save profile.",{type:"danger"}),$("#loading-overlay").hide()},function(){$("#loading-overlay").hide(),$.bootstrapGrowl("Failed to save profile.",{type:"danger"})})}e.preventDefault()}),$("#create-game-form").submit(function(e){if(game.currentUser){var t=w($("#create-game-form"));t.createGame=!0,t.privateGame="on"===t.privateGame,game.queryData||(game.queryData={}),game.play(null,t)}e.preventDefault()}),game.logout=function(){window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"signOut"}),gapi.auth2.getAuthInstance().signOut().then(function(){Cookies.remove("token"),window.location="/"})},Cookies.get("token")?game.initUser():isMobile&&$("#profile-col").hide(),game.openMapEditor=function(){game.isMapEditor=!0,$("#ad-menu").remove(),game.isPlayScreen=!0,$("#ui").hide(),game.hideBannerAd(),game.init()},game.play=function(e,t){e&&e.preventDefault();var a=$("#name").val();if(a)if(/[^a-zA-Z0-9\[\]]/.test(a))$.bootstrapGrowl("Names can only have letters and numbers.",{type:"danger"});else if(a.length<=2)$.bootstrapGrowl("Name is too short.",{type:"danger"});else if(a.length>16)$.bootstrapGrowl("Name is too long.",{type:"danger"});else{if(!game.disableTutorialAsk){if(confirm("If this is your first time playing, we recommend the tutorial! Would you like to play it?"))return void game.startSingleplayer(!0);game.disableTutorialAsk=!0,Cookies.set("disableTutorialAsk",game.disableTutorialAsk,{expires:365})}if(t||game.queryData&&game.queryData.invite||((n=parseInt(window.localStorage.getItem("lastVidCheck")))||(n=0),n>=3?(window.localStorage.setItem("lastVidCheck",0),$("#preroll-container").show(),aiptag.cmd.player.push(function(){adplayer.startPreRoll()}),0):(window.localStorage.setItem("lastVidCheck",n+1),1))){var n,i="";Cookies.get("token")&&(i="&session="+Cookies.get("token"));var r=$("#server-region").val();r||(r="NA1");var o="";game.queryData&&game.queryData.invite&&(o="&invite="+game.queryData.invite),$.ajax({url:API_URL+"/token?name="+a+"&region="+r+i+o,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(t)}).then(function(e){if(e.success){Cookies.set("lastUpdateSeen",$("#change-log-text").data().updateCount,{expires:365}),window.localStorage&&window.localStorage.setItem("name",a),window.ga&&(ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:i?"playAsUser":"playAsGuest"}),t&&t.privateGame&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:"createPrivateGame"}));var n=window.location+"play/?token="+e.token+"&address="+e.address+"&port="+e.port;n.startsWith("https")&&(n=n.replace("https","http"));try{-1!==(window.location!==window.parent.location?document.referrer:document.location.href).indexOf("iogames.space")?window.location=n:window.parent.location=n}catch(e){window.location=n}}else $.bootstrapGrowl(e.message,{type:"danger"})},function(e){$.bootstrapGrowl("Failed to connect to game server.",{type:"danger"})})}else v=!0}else $.bootstrapGrowl("Please enter a name.",{type:"danger"})};var I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};window.gapi&&gapi.load("auth2",function(){gapi.auth2.init({client_id:"773830838234-5jiv3cbb2hibmg21feg9iabjdo8f8v9n.apps.googleusercontent.com",cookiepolicy:"single_host_origin"}).attachClickHandler(document.getElementById("signin-google"),{},onGoogleSignIn,function(e){console.error("Google sign in error:",e)})}),game.startSingleplayer=function(e){game.loadSounds();var t={to:function(){return t},emit:function(e,t){game.fakeSockets&&game.fakeSockets.clientSocket.socketEvents[e](t)}},a={isSingleplayer:!0,isTutorial:e,skipGameLobby:!0},n=new window.antwarServer.Server(t,t,1,null,null,null,null,a);n.startGame(),e&&(game.disableTutorialAsk=!0,Cookies.set("disableTutorialAsk",game.disableTutorialAsk,{expires:365})),window.ga&&ga("send",{hitType:"event",eventCategory:"Lobby",eventAction:e?"playTutorial":"playSingleplayer"}),game.fakeSockets={serverSocket:{connected:!0,on:function(e,t){game.fakeSockets.serverSocket.socketEvents[e]=t},emit:function(e,t){game.fakeSockets.clientSocket.socketEvents[e](t)},snapSocket:{client:{conn:{write:function(e){game.onSnapshot(e.buffer)}}}},socketEvents:{}}},s(!0),game.server=n,game.init();var i="Player";try{var r=$("#name").val();r&&(i=r)}catch(e){}game.fakeSockets.serverSocket.name=i,game.fakeSockets.serverSocket.user={isDev:!0},n.onClientConnected(game.fakeSockets.serverSocket)}}(),function(){return function e(t,a,n){function i(o,s){if(!a[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=a[o]={exports:{}};t[o][0].call(d.exports,function(e){return i(t[o][1][e]||e)},d,d.exports,e,t,a,n)}return a[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}}()({1:[function(e,t,a){"use strict";a.byteLength=function(e){var t=u(e),a=t[0],n=t[1];return 3*(a+n)/4-n},a.toByteArray=function(e){for(var t,a=u(e),n=a[0],o=a[1],s=new r(function(e,t,a){return 3*(t+a)/4-a}(0,n,o)),l=0,d=o>0?n-4:n,h=0;h<d;h+=4)t=i[e.charCodeAt(h)]<<18|i[e.charCodeAt(h+1)]<<12|i[e.charCodeAt(h+2)]<<6|i[e.charCodeAt(h+3)],s[l++]=t>>16&255,s[l++]=t>>8&255,s[l++]=255&t;2===o&&(t=i[e.charCodeAt(h)]<<2|i[e.charCodeAt(h+1)]>>4,s[l++]=255&t);1===o&&(t=i[e.charCodeAt(h)]<<10|i[e.charCodeAt(h+1)]<<4|i[e.charCodeAt(h+2)]>>2,s[l++]=t>>8&255,s[l++]=255&t);return s},a.fromByteArray=function(e){for(var t,a=e.length,i=a%3,r=[],o=0,s=a-i;o<s;o+=16383)r.push(d(e,o,o+16383>s?s:o+16383));1===i?(t=e[a-1],r.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[a-2]<<8)+e[a-1],r.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return r.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var a=e.indexOf("=");return-1===a&&(a=t),[a,a===t?0:4-a%4]}function d(e,t,a){for(var i,r,o=[],s=t;s<a;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(r=i)>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],2:[function(e,t,a){(function(t){"use strict";var n=e("base64-js"),i=e("ieee754");a.Buffer=t,a.SlowBuffer=function(e){+e!=e&&(e=0);return t.alloc(+e)},a.INSPECT_MAX_BYTES=50;var r=2147483647;function o(e){if(e>r)throw new RangeError('The value "'+e+'" is invalid for option "size"');var a=new Uint8Array(e);return a.__proto__=t.prototype,a}function t(e,t,a){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return s(e,t,a)}function s(e,a,n){if("string"==typeof e)return function(e,a){"string"==typeof a&&""!==a||(a="utf8");if(!t.isEncoding(a))throw new TypeError("Unknown encoding: "+a);var n=0|c(e,a),i=o(n),r=i.write(e,a);r!==n&&(i=i.slice(0,r));return i}(e,a);if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer))return function(e,a,n){if(a<0||e.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<a+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;i=void 0===a&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,a):new Uint8Array(e,a,n);return i.__proto__=t.prototype,i}(e,a,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return t.from(i,a,n);var r=function(e){if(t.isBuffer(e)){var a=0|h(e.length),n=o(a);return 0===n.length?n:(e.copy(n,0,0,a),n)}if(void 0!==e.length)return"number"!=typeof e.length||R(e.length)?o(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return t.from(e[Symbol.toPrimitive]("string"),a,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return l(e),o(e<0?0:0|h(e))}function d(e){for(var t=e.length<0?0:0|h(e.length),a=o(t),n=0;n<t;n+=1)a[n]=255&e[n];return a}function h(e){if(e>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function c(e,a){if(t.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(a){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(r)return i?-1:z(e).length;a=(""+a).toLowerCase(),r=!0}}function p(e,t,a){var n=e[t];e[t]=e[a],e[a]=n}function f(e,a,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),R(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof a&&(a=t.from(a,i)),t.isBuffer(a))return 0===a.length?-1:g(e,a,n,i,r);if("number"==typeof a)return a&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,a,n):Uint8Array.prototype.lastIndexOf.call(e,a,n):g(e,[a],n,i,r);throw new TypeError("val must be string, number or Buffer")}function g(e,t,a,n,i){var r,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,a/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var d=-1;for(r=a;r<s;r++)if(u(e,r)===u(t,-1===d?0:r-d)){if(-1===d&&(d=r),r-d+1===l)return d*o}else-1!==d&&(r-=r-d),d=-1}else for(a+l>s&&(a=s-l),r=a;r>=0;r--){for(var h=!0,c=0;c<l;c++)if(u(e,r+c)!==u(t,c)){h=!1;break}if(h)return r}return-1}function m(e,t,a,n){a=Number(a)||0;var i=e.length-a;n?(n=Number(n))>i&&(n=i):n=i;var r=t.length;n>r/2&&(n=r/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(R(s))return o;e[a+o]=s}return o}function y(e,t,a,n){return B(z(t,e.length-a),e,a,n)}function b(e,t,a,n){return B(function(e){for(var t=[],a=0;a<e.length;++a)t.push(255&e.charCodeAt(a));return t}(t),e,a,n)}function v(e,t,a,n){return b(e,t,a,n)}function w(e,t,a,n){return B(j(t),e,a,n)}function x(e,t,a,n){return B(function(e,t){for(var a,n,i,r=[],o=0;o<e.length&&!((t-=2)<0);++o)a=e.charCodeAt(o),n=a>>8,i=a%256,r.push(i),r.push(n);return r}(t,e.length-a),e,a,n)}function I(e,t,a){return 0===t&&a===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,a))}function T(e,t,a){a=Math.min(e.length,a);for(var n=[],i=t;i<a;){var r,o,s,l,u=e[i],d=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=a)switch(h){case 1:u<128&&(d=u);break;case 2:128==(192&(r=e[i+1]))&&(l=(31&u)<<6|63&r)>127&&(d=l);break;case 3:r=e[i+1],o=e[i+2],128==(192&r)&&128==(192&o)&&(l=(15&u)<<12|(63&r)<<6|63&o)>2047&&(l<55296||l>57343)&&(d=l);break;case 4:r=e[i+1],o=e[i+2],s=e[i+3],128==(192&r)&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&r)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(d=l)}null===d?(d=65533,h=1):d>65535&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),i+=h}return function(e){var t=e.length;if(t<=M)return String.fromCharCode.apply(String,e);var a="",n=0;for(;n<t;)a+=String.fromCharCode.apply(String,e.slice(n,n+=M));return a}(n)}a.kMaxLength=r,t.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),t.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}}),Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(e,t,a){return s(e,t,a)},t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,t.alloc=function(e,t,a){return function(e,t,a){return l(e),e<=0?o(e):void 0!==t?"string"==typeof a?o(e).fill(t,a):o(e).fill(t):o(e)}(e,t,a)},t.allocUnsafe=function(e){return u(e)},t.allocUnsafeSlow=function(e){return u(e)},t.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==t.prototype},t.compare=function(e,a){if(N(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),N(a,Uint8Array)&&(a=t.from(a,a.offset,a.byteLength)),!t.isBuffer(e)||!t.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===a)return 0;for(var n=e.length,i=a.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==a[r]){n=e[r],i=a[r];break}return n<i?-1:i<n?1:0},t.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,a){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var n;if(void 0===a)for(a=0,n=0;n<e.length;++n)a+=e[n].length;var i=t.allocUnsafe(a),r=0;for(n=0;n<e.length;++n){var o=e[n];if(N(o,Uint8Array)&&(o=t.from(o)),!t.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},t.byteLength=c,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},t.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},t.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},t.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):function(e,t,a){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===a||a>this.length)&&(a=this.length),a<=0)return"";if((a>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return S(this,t,a);case"utf8":case"utf-8":return T(this,t,a);case"ascii":return k(this,t,a);case"latin1":case"binary":return D(this,t,a);case"base64":return I(this,t,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,a);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},t.prototype.toLocaleString=t.prototype.toString,t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var e="",t=a.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},t.prototype.compare=function(e,a,n,i,r){if(N(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),!t.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===a&&(a=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),a<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&a>=n)return 0;if(i>=r)return-1;if(a>=n)return 1;if(a>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var o=r-i,s=n-a,l=Math.min(o,s),u=this.slice(i,r),d=e.slice(a,n),h=0;h<l;++h)if(u[h]!==d[h]){o=u[h],s=d[h];break}return o<s?-1:s<o?1:0},t.prototype.includes=function(e,t,a){return-1!==this.indexOf(e,t,a)},t.prototype.indexOf=function(e,t,a){return f(this,e,t,a,!0)},t.prototype.lastIndexOf=function(e,t,a){return f(this,e,t,a,!1)},t.prototype.write=function(e,t,a,n){if(void 0===t)n="utf8",a=this.length,t=0;else if(void 0===a&&"string"==typeof t)n=t,a=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(a)?(a>>>=0,void 0===n&&(n="utf8")):(n=a,a=void 0)}var i=this.length-t;if((void 0===a||a>i)&&(a=i),e.length>0&&(a<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var r=!1;;)switch(n){case"hex":return m(this,e,t,a);case"utf8":case"utf-8":return y(this,e,t,a);case"ascii":return b(this,e,t,a);case"latin1":case"binary":return v(this,e,t,a);case"base64":return w(this,e,t,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,a);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),r=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var M=4096;function k(e,t,a){var n="";a=Math.min(e.length,a);for(var i=t;i<a;++i)n+=String.fromCharCode(127&e[i]);return n}function D(e,t,a){var n="";a=Math.min(e.length,a);for(var i=t;i<a;++i)n+=String.fromCharCode(e[i]);return n}function S(e,t,a){var n=e.length;(!t||t<0)&&(t=0),(!a||a<0||a>n)&&(a=n);for(var i="",r=t;r<a;++r)i+=q(e[r]);return i}function A(e,t,a){for(var n=e.slice(t,a),i="",r=0;r<n.length;r+=2)i+=String.fromCharCode(n[r]+256*n[r+1]);return i}function E(e,t,a){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>a)throw new RangeError("Trying to access beyond buffer length")}function _(e,a,n,i,r,o){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>r||a<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function P(e,t,a,n,i,r){if(a+n>e.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("Index out of range")}function C(e,t,a,n,r){return t=+t,a>>>=0,r||P(e,0,a,4),i.write(e,t,a,n,23,4),a+4}function L(e,t,a,n,r){return t=+t,a>>>=0,r||P(e,0,a,8),i.write(e,t,a,n,52,8),a+8}t.prototype.slice=function(e,a){var n=this.length;e=~~e,a=void 0===a?n:~~a,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),a<0?(a+=n)<0&&(a=0):a>n&&(a=n),a<e&&(a=e);var i=this.subarray(e,a);return i.__proto__=t.prototype,i},t.prototype.readUIntLE=function(e,t,a){e>>>=0,t>>>=0,a||E(e,t,this.length);for(var n=this[e],i=1,r=0;++r<t&&(i*=256);)n+=this[e+r]*i;return n},t.prototype.readUIntBE=function(e,t,a){e>>>=0,t>>>=0,a||E(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},t.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},t.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},t.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},t.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},t.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},t.prototype.readIntLE=function(e,t,a){e>>>=0,t>>>=0,a||E(e,t,this.length);for(var n=this[e],i=1,r=0;++r<t&&(i*=256);)n+=this[e+r]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},t.prototype.readIntBE=function(e,t,a){e>>>=0,t>>>=0,a||E(e,t,this.length);for(var n=t,i=1,r=this[e+--n];n>0&&(i*=256);)r+=this[e+--n]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},t.prototype.readInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},t.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var a=this[e]|this[e+1]<<8;return 32768&a?4294901760|a:a},t.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var a=this[e+1]|this[e]<<8;return 32768&a?4294901760|a:a},t.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},t.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},t.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!0,23,4)},t.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!1,23,4)},t.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!0,52,8)},t.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!1,52,8)},t.prototype.writeUIntLE=function(e,t,a,n){(e=+e,t>>>=0,a>>>=0,n)||_(this,e,t,a,Math.pow(2,8*a)-1,0);var i=1,r=0;for(this[t]=255&e;++r<a&&(i*=256);)this[t+r]=e/i&255;return t+a},t.prototype.writeUIntBE=function(e,t,a,n){(e=+e,t>>>=0,a>>>=0,n)||_(this,e,t,a,Math.pow(2,8*a)-1,0);var i=a-1,r=1;for(this[t+i]=255&e;--i>=0&&(r*=256);)this[t+i]=e/r&255;return t+a},t.prototype.writeUInt8=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,1,255,0),this[t]=255&e,t+1},t.prototype.writeUInt16LE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeUInt16BE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeUInt32LE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},t.prototype.writeUInt32BE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeIntLE=function(e,t,a,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*a-1);_(this,e,t,a,i-1,-i)}var r=0,o=1,s=0;for(this[t]=255&e;++r<a&&(o*=256);)e<0&&0===s&&0!==this[t+r-1]&&(s=1),this[t+r]=(e/o>>0)-s&255;return t+a},t.prototype.writeIntBE=function(e,t,a,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*a-1);_(this,e,t,a,i-1,-i)}var r=a-1,o=1,s=0;for(this[t+r]=255&e;--r>=0&&(o*=256);)e<0&&0===s&&0!==this[t+r+1]&&(s=1),this[t+r]=(e/o>>0)-s&255;return t+a},t.prototype.writeInt8=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},t.prototype.writeInt16LE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeInt16BE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeInt32LE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},t.prototype.writeInt32BE=function(e,t,a){return e=+e,t>>>=0,a||_(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeFloatLE=function(e,t,a){return C(this,e,t,!0,a)},t.prototype.writeFloatBE=function(e,t,a){return C(this,e,t,!1,a)},t.prototype.writeDoubleLE=function(e,t,a){return L(this,e,t,!0,a)},t.prototype.writeDoubleBE=function(e,t,a){return L(this,e,t,!1,a)},t.prototype.copy=function(e,a,n,i){if(!t.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),a>=e.length&&(a=e.length),a||(a=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(a<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-a<i-n&&(i=e.length-a+n);var r=i-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(a,n,i);else if(this===e&&n<a&&a<i)for(var o=r-1;o>=0;--o)e[o+a]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),a);return r},t.prototype.fill=function(e,a,n,i){if("string"==typeof e){if("string"==typeof a?(i=a,a=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!t.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var r=e.charCodeAt(0);("utf8"===i&&r<128||"latin1"===i)&&(e=r)}}else"number"==typeof e&&(e&=255);if(a<0||this.length<a||this.length<n)throw new RangeError("Out of range index");if(n<=a)return this;var o;if(a>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=a;o<n;++o)this[o]=e;else{var s=t.isBuffer(e)?e:t.from(e,i),l=s.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-a;++o)this[o+a]=s[o%l]}return this};var O=/[^+/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){var a;t=t||1/0;for(var n=e.length,i=null,r=[],o=0;o<n;++o){if((a=e.charCodeAt(o))>55295&&a<57344){if(!i){if(a>56319){(t-=3)>-1&&r.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&r.push(239,191,189);continue}i=a;continue}if(a<56320){(t-=3)>-1&&r.push(239,191,189),i=a;continue}a=65536+(i-55296<<10|a-56320)}else i&&(t-=3)>-1&&r.push(239,191,189);if(i=null,a<128){if((t-=1)<0)break;r.push(a)}else if(a<2048){if((t-=2)<0)break;r.push(a>>6|192,63&a|128)}else if(a<65536){if((t-=3)<0)break;r.push(a>>12|224,a>>6&63|128,63&a|128)}else{if(!(a<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;r.push(a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128)}}return r}function j(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(O,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,a,n){for(var i=0;i<n&&!(i+a>=t.length||i>=e.length);++i)t[i+a]=e[i];return i}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function R(e){return e!=e}}).call(this,e("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:3}],3:[function(e,t,a){a.read=function(e,t,a,n,i){var r,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,d=-7,h=a?i-1:0,c=a?-1:1,p=e[t+h];for(h+=c,r=p&(1<<-d)-1,p>>=-d,d+=s;d>0;r=256*r+e[t+h],h+=c,d-=8);for(o=r&(1<<-d)-1,r>>=-d,d+=n;d>0;o=256*o+e[t+h],h+=c,d-=8);if(0===r)r=1-u;else{if(r===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),r-=u}return(p?-1:1)*o*Math.pow(2,r-n)},a.write=function(e,t,a,n,i,r){var o,s,l,u=8*r-i-1,d=(1<<u)-1,h=d>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:r-1,f=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?c/l:c*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=d?(s=0,o=d):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[a+p]=255&s,p+=f,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[a+p]=255&o,p+=f,o/=256,u-=8);e[a+p-f]|=128*g}},{}],4:[function(e,t,a){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var u,d=[],h=!1,c=-1;function p(){h&&u&&(h=!1,u.length?d=u.concat(d):c=-1,d.length&&f())}function f(){if(!h){var e=l(p);h=!0;for(var t=d.length;t;){for(u=d,d=[];++c<t;)u&&u[c].run();c=-1,t=d.length}u=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];d.push(new g(e,t)),1!==d.length||h||l(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],5:[function(e,t,a){(function(t,n){var i=e("process/browser.js").nextTick,r=Function.prototype.apply,o=Array.prototype.slice,s={},l=0;function u(e,t){this._id=e,this._clearFn=t}a.setTimeout=function(){return new u(r.call(setTimeout,window,arguments),clearTimeout)},a.setInterval=function(){return new u(r.call(setInterval,window,arguments),clearInterval)},a.clearTimeout=a.clearInterval=function(e){e.close()},u.prototype.unref=u.prototype.ref=function(){},u.prototype.close=function(){this._clearFn.call(window,this._id)},a.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},a.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},a._unrefActive=a.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a.setImmediate="function"==typeof t?t:function(e){var t=l++,n=!(arguments.length<2)&&o.call(arguments,1);return s[t]=!0,i(function(){s[t]&&(n?e.apply(null,n):e.call(null),a.clearImmediate(t))}),t},a.clearImmediate="function"==typeof n?n:function(e){delete s[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":4,timers:5}],6:[function(e,t,a){t.exports=e("./lib/heap")},{"./lib/heap":7}],7:[function(e,t,a){(function(){var e,a,n,i,r,o,s,l,u,d,h,c,p,f,g;n=Math.floor,d=Math.min,a=function(e,t){return e<t?-1:e>t?1:0},u=function(e,t,i,r,o){var s;if(null==i&&(i=0),null==o&&(o=a),i<0)throw new Error("lo must be non-negative");for(null==r&&(r=e.length);i<r;)o(t,e[s=n((i+r)/2)])<0?r=s:i=s+1;return[].splice.apply(e,[i,i-i].concat(t)),t},o=function(e,t,n){return null==n&&(n=a),e.push(t),f(e,0,e.length-1,n)},r=function(e,t){var n,i;return null==t&&(t=a),n=e.pop(),e.length?(i=e[0],e[0]=n,g(e,0,t)):i=n,i},l=function(e,t,n){var i;return null==n&&(n=a),i=e[0],e[0]=t,g(e,0,n),i},s=function(e,t,n){var i;return null==n&&(n=a),e.length&&n(e[0],t)<0&&(t=(i=[e[0],t])[0],e[0]=i[1],g(e,0,n)),t},i=function(e,t){var i,r,o,s,l,u;for(null==t&&(t=a),l=[],r=0,o=(s=function(){u=[];for(var t=0,a=n(e.length/2);0<=a?t<a:t>a;0<=a?t++:t--)u.push(t);return u}.apply(this).reverse()).length;r<o;r++)i=s[r],l.push(g(e,i,t));return l},p=function(e,t,n){var i;if(null==n&&(n=a),-1!==(i=e.indexOf(t)))return f(e,0,i,n),g(e,i,n)},h=function(e,t,n){var r,o,l,u,d;if(null==n&&(n=a),!(o=e.slice(0,t)).length)return o;for(i(o,n),l=0,u=(d=e.slice(t)).length;l<u;l++)r=d[l],s(o,r,n);return o.sort(n).reverse()},c=function(e,t,n){var o,s,l,h,c,p,f,g,m;if(null==n&&(n=a),10*t<=e.length){if(!(l=e.slice(0,t).sort(n)).length)return l;for(s=l[l.length-1],h=0,p=(f=e.slice(t)).length;h<p;h++)n(o=f[h],s)<0&&(u(l,o,0,null,n),l.pop(),s=l[l.length-1]);return l}for(i(e,n),m=[],c=0,g=d(t,e.length);0<=g?c<g:c>g;0<=g?++c:--c)m.push(r(e,n));return m},f=function(e,t,n,i){var r,o,s;for(null==i&&(i=a),r=e[n];n>t&&i(r,o=e[s=n-1>>1])<0;)e[n]=o,n=s;return e[n]=r},g=function(e,t,n){var i,r,o,s,l;for(null==n&&(n=a),r=e.length,l=t,o=e[t],i=2*t+1;i<r;)(s=i+1)<r&&!(n(e[i],e[s])<0)&&(i=s),e[t]=e[i],i=2*(t=i)+1;return e[t]=o,f(e,l,t,n)},e=function(){function e(e){this.cmp=null!=e?e:a,this.nodes=[]}return e.push=o,e.pop=r,e.replace=l,e.pushpop=s,e.heapify=i,e.updateItem=p,e.nlargest=h,e.nsmallest=c,e.prototype.push=function(e){return o(this.nodes,e,this.cmp)},e.prototype.pop=function(){return r(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return l(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return s(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return i(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return p(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),(void 0!==t&&null!==t?t.exports:void 0)?t.exports=e:window.Heap=e}).call(this)},{}],8:[function(e,t,a){!function(e){function t(e){function t(e,t,a){this.x=e,this.y=t,this.z=a}t.prototype.dot2=function(e,t){return this.x*e+this.y*t},t.prototype.dot3=function(e,t,a){return this.x*e+this.y*t+this.z*a},this.grad3=[new t(1,1,0),new t(-1,1,0),new t(1,-1,0),new t(-1,-1,0),new t(1,0,1),new t(-1,0,1),new t(1,0,-1),new t(-1,0,-1),new t(0,1,1),new t(0,-1,1),new t(0,1,-1),new t(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(e||0)}t.prototype.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=this.p,a=0;a<256;a++){var n;n=1&a?t[a]^255&e:t[a]^e>>8&255;var i=this.perm,r=this.gradP;i[a]=i[a+256]=n,r[a]=r[a+256]=this.grad3[n%12]}};var a=.5*(Math.sqrt(3)-1),n=(3-Math.sqrt(3))/6,i=1/6;function r(e){return e*e*e*(e*(6*e-15)+10)}function o(e,t,a){return(1-a)*e+a*t}t.prototype.simplex2=function(e,t){var i,r,o=(e+t)*a,s=Math.floor(e+o),l=Math.floor(t+o),u=(s+l)*n,d=e-s+u,h=t-l+u;d>h?(i=1,r=0):(i=0,r=1);var c=d-i+n,p=h-r+n,f=d-1+2*n,g=h-1+2*n;s&=255,l&=255;var m=this.perm,y=this.gradP,b=y[s+m[l]],v=y[s+i+m[l+r]],w=y[s+1+m[l+1]],x=.5-d*d-h*h,I=.5-c*c-p*p,T=.5-f*f-g*g;return 70*((x<0?0:(x*=x)*x*b.dot2(d,h))+(I<0?0:(I*=I)*I*v.dot2(c,p))+(T<0?0:(T*=T)*T*w.dot2(f,g)))},t.prototype.simplex3=function(e,t,a){var n,r,o,s,l,u,d=(e+t+a)*(1/3),h=Math.floor(e+d),c=Math.floor(t+d),p=Math.floor(a+d),f=(h+c+p)*i,g=e-h+f,m=t-c+f,y=a-p+f;g>=m?m>=y?(n=1,r=0,o=0,s=1,l=1,u=0):g>=y?(n=1,r=0,o=0,s=1,l=0,u=1):(n=0,r=0,o=1,s=1,l=0,u=1):m<y?(n=0,r=0,o=1,s=0,l=1,u=1):g<y?(n=0,r=1,o=0,s=0,l=1,u=1):(n=0,r=1,o=0,s=1,l=1,u=0);var b=g-n+i,v=m-r+i,w=y-o+i,x=g-s+2*i,I=m-l+2*i,T=y-u+2*i,M=g-1+.5,k=m-1+.5,D=y-1+.5;h&=255,c&=255,p&=255;var S=this.perm,A=this.gradP,E=A[h+S[c+S[p]]],_=A[h+n+S[c+r+S[p+o]]],P=A[h+s+S[c+l+S[p+u]]],C=A[h+1+S[c+1+S[p+1]]],L=.5-g*g-m*m-y*y,O=.5-b*b-v*v-w*w,q=.5-x*x-I*I-T*T,z=.5-M*M-k*k-D*D;return 32*((L<0?0:(L*=L)*L*E.dot3(g,m,y))+(O<0?0:(O*=O)*O*_.dot3(b,v,w))+(q<0?0:(q*=q)*q*P.dot3(x,I,T))+(z<0?0:(z*=z)*z*C.dot3(M,k,D)))},t.prototype.perlin2=function(e,t){var a=Math.floor(e),n=Math.floor(t);e-=a,t-=n,a&=255,n&=255;var i=this.perm,s=this.gradP,l=s[a+i[n]].dot2(e,t),u=s[a+i[n+1]].dot2(e,t-1),d=s[a+1+i[n]].dot2(e-1,t),h=s[a+1+i[n+1]].dot2(e-1,t-1),c=r(e);return o(o(l,d,c),o(u,h,c),r(t))},t.prototype.perlin3=function(e,t,a){var n=Math.floor(e),i=Math.floor(t),s=Math.floor(a);e-=n,t-=i,a-=s,n&=255,i&=255,s&=255;var l=this.perm,u=this.gradP,d=u[n+l[i+l[s]]].dot3(e,t,a),h=u[n+l[i+l[s+1]]].dot3(e,t,a-1),c=u[n+l[i+1+l[s]]].dot3(e,t-1,a),p=u[n+l[i+1+l[s+1]]].dot3(e,t-1,a-1),f=u[n+1+l[i+l[s]]].dot3(e-1,t,a),g=u[n+1+l[i+l[s+1]]].dot3(e-1,t,a-1),m=u[n+1+l[i+1+l[s]]].dot3(e-1,t-1,a),y=u[n+1+l[i+1+l[s+1]]].dot3(e-1,t-1,a-1),b=r(e),v=r(t),w=r(a);return o(o(o(d,f,b),o(h,g,b),w),o(o(c,m,b),o(p,y,b),w),v)},e.Noise=t}(void 0===t?this:t.exports)},{}],9:[function(e,t,a){t.exports=e("./src/PathFinding")},{"./src/PathFinding":10}],10:[function(e,t,a){t.exports={Heap:e("heap"),Node:e("./core/Node"),Grid:e("./core/Grid"),Util:e("./core/Util"),DiagonalMovement:e("./core/DiagonalMovement"),Heuristic:e("./core/Heuristic"),AStarFinder:e("./finders/AStarFinder"),BestFirstFinder:e("./finders/BestFirstFinder"),BreadthFirstFinder:e("./finders/BreadthFirstFinder"),DijkstraFinder:e("./finders/DijkstraFinder"),BiAStarFinder:e("./finders/BiAStarFinder"),BiBestFirstFinder:e("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:e("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:e("./finders/BiDijkstraFinder"),IDAStarFinder:e("./finders/IDAStarFinder"),JumpPointFinder:e("./finders/JumpPointFinder")}},{"./core/DiagonalMovement":11,"./core/Grid":12,"./core/Heuristic":13,"./core/Node":14,"./core/Util":15,"./finders/AStarFinder":16,"./finders/BestFirstFinder":17,"./finders/BiAStarFinder":18,"./finders/BiBestFirstFinder":19,"./finders/BiBreadthFirstFinder":20,"./finders/BiDijkstraFinder":21,"./finders/BreadthFirstFinder":22,"./finders/DijkstraFinder":23,"./finders/IDAStarFinder":24,"./finders/JumpPointFinder":29,heap:6}],11:[function(e,t,a){t.exports={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4}},{}],12:[function(e,t,a){var n=e("./Node"),i=e("./DiagonalMovement");function r(e,t,a){var n;"object"!=typeof e?n=e:(t=e.length,n=e[0].length,a=e),this.width=n,this.height=t,this.nodes=this._buildNodes(n,t,a)}r.prototype._buildNodes=function(e,t,a){var i,r,o=new Array(t);for(i=0;i<t;++i)for(o[i]=new Array(e),r=0;r<e;++r)o[i][r]=new n(r,i);if(void 0===a)return o;if(a.length!==t||a[0].length!==e)throw new Error("Matrix size does not fit");for(i=0;i<t;++i)for(r=0;r<e;++r)a[i][r]&&(o[i][r].walkable=!1);return o},r.prototype.getNodeAt=function(e,t){return this.nodes[t][e]},r.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable},r.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height},r.prototype.setWalkableAt=function(e,t,a){this.nodes[t][e].walkable=a},r.prototype.getNeighbors=function(e,t){var a=e.x,n=e.y,r=[],o=!1,s=!1,l=!1,u=!1,d=!1,h=!1,c=!1,p=!1,f=this.nodes;if(this.isWalkableAt(a,n-1)&&(r.push(f[n-1][a]),o=!0),this.isWalkableAt(a+1,n)&&(r.push(f[n][a+1]),l=!0),this.isWalkableAt(a,n+1)&&(r.push(f[n+1][a]),d=!0),this.isWalkableAt(a-1,n)&&(r.push(f[n][a-1]),c=!0),t===i.Never)return r;if(t===i.OnlyWhenNoObstacles)s=c&&o,u=o&&l,h=l&&d,p=d&&c;else if(t===i.IfAtMostOneObstacle)s=c||o,u=o||l,h=l||d,p=d||c;else{if(t!==i.Always)throw new Error("Incorrect value of diagonalMovement");s=!0,u=!0,h=!0,p=!0}return s&&this.isWalkableAt(a-1,n-1)&&r.push(f[n-1][a-1]),u&&this.isWalkableAt(a+1,n-1)&&r.push(f[n-1][a+1]),h&&this.isWalkableAt(a+1,n+1)&&r.push(f[n+1][a+1]),p&&this.isWalkableAt(a-1,n+1)&&r.push(f[n+1][a-1]),r},r.prototype.clone=function(){var e,t,a=this.width,i=this.height,o=this.nodes,s=new r(a,i),l=new Array(i);for(e=0;e<i;++e)for(l[e]=new Array(a),t=0;t<a;++t)l[e][t]=new n(t,e,o[e][t].walkable);return s.nodes=l,s},t.exports=r},{"./DiagonalMovement":11,"./Node":14}],13:[function(e,t,a){t.exports={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var a=Math.SQRT2-1;return e<t?a*e+t:a*t+e},chebyshev:function(e,t){return Math.max(e,t)}}},{}],14:[function(e,t,a){t.exports=function(e,t,a){this.x=e,this.y=t,this.walkable=void 0===a||a}},{}],15:[function(e,t,a){function n(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}function i(e,t,a,n){var i,r,o,s,l,u,d=Math.abs,h=[];for(o=d(a-e),s=d(n-t),i=e<a?1:-1,r=t<n?1:-1,l=o-s;h.push([e,t]),e!==a||t!==n;)(u=2*l)>-s&&(l-=s,e+=i),u<o&&(l+=o,t+=r);return h}a.backtrace=n,a.biBacktrace=function(e,t){var a=n(e),i=n(t);return a.concat(i.reverse())},a.pathLength=function(e){var t,a,n,i,r,o=0;for(t=1;t<e.length;++t)a=e[t-1],n=e[t],i=a[0]-n[0],r=a[1]-n[1],o+=Math.sqrt(i*i+r*r);return o},a.interpolate=i,a.expandPath=function(e){var t,a,n,r,o,s,l=[],u=e.length;if(u<2)return l;for(o=0;o<u-1;++o)for(t=e[o],a=e[o+1],r=(n=i(t[0],t[1],a[0],a[1])).length,s=0;s<r-1;++s)l.push(n[s]);return l.push(e[u-1]),l},a.smoothenPath=function(e,t){var a,n,r,o,s,l,u,d,h,c=t.length,p=t[0][0],f=t[0][1],g=t[c-1][0],m=t[c-1][1];for(r=[[a=p,n=f]],o=2;o<c;++o){for(u=i(a,n,(l=t[o])[0],l[1]),h=!1,s=1;s<u.length;++s)if(d=u[s],!e.isWalkableAt(d[0],d[1])){h=!0;break}h&&(lastValidCoord=t[o-1],r.push(lastValidCoord),a=lastValidCoord[0],n=lastValidCoord[1])}return r.push([g,m]),r},a.compressPath=function(e){if(e.length<3)return e;var t,a,n,i,r,o,s=[],l=e[0][0],u=e[0][1],d=e[1][0],h=e[1][1],c=d-l,p=h-u;for(c/=r=Math.sqrt(c*c+p*p),p/=r,s.push([l,u]),o=2;o<e.length;o++)t=d,a=h,n=c,i=p,c=(d=e[o][0])-t,p=(h=e[o][1])-a,p/=r=Math.sqrt(c*c+p*p),(c/=r)===n&&p===i||s.push([t,a]);return s.push([d,h]),s}},{}],16:[function(e,t,a){var n=e("heap"),i=e("../core/Util"),r=e("../core/Heuristic"),o=e("../core/DiagonalMovement");function s(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||r.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.OnlyWhenNoObstacles:this.diagonalMovement=o.IfAtMostOneObstacle:this.diagonalMovement=o.Never),this.diagonalMovement===o.Never?this.heuristic=e.heuristic||r.manhattan:this.heuristic=e.heuristic||r.octile}s.prototype.findPath=function(e,t,a,r,o){var s,l,u,d,h,c,p,f,g=new n(function(e,t){return e.f-t.f}),m=o.getNodeAt(e,t),y=o.getNodeAt(a,r),b=this.heuristic,v=this.diagonalMovement,w=this.weight,x=Math.abs,I=Math.SQRT2;for(m.g=0,m.f=0,g.push(m),m.opened=!0;!g.empty();){if((s=g.pop()).closed=!0,s===y)return i.backtrace(y);for(d=0,h=(l=o.getNeighbors(s,v)).length;d<h;++d)(u=l[d]).closed||(c=u.x,p=u.y,f=s.g+(c-s.x==0||p-s.y==0?1:I),(!u.opened||f<u.g)&&(u.g=f,u.h=u.h||w*b(x(c-a),x(p-r)),u.f=u.g+u.h,u.parent=s,u.opened?g.updateItem(u):(g.push(u),u.opened=!0)))}return[]},t.exports=s},{"../core/DiagonalMovement":11,"../core/Heuristic":13,"../core/Util":15,heap:6}],17:[function(e,t,a){var n=e("./AStarFinder");function i(e){n.call(this,e);var t=this.heuristic;this.heuristic=function(e,a){return 1e6*t(e,a)}}i.prototype=new n,i.prototype.constructor=i,t.exports=i},{"./AStarFinder":16}],18:[function(e,t,a){var n=e("heap"),i=e("../core/Util"),r=e("../core/Heuristic"),o=e("../core/DiagonalMovement");function s(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||r.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.OnlyWhenNoObstacles:this.diagonalMovement=o.IfAtMostOneObstacle:this.diagonalMovement=o.Never),this.diagonalMovement===o.Never?this.heuristic=e.heuristic||r.manhattan:this.heuristic=e.heuristic||r.octile}s.prototype.findPath=function(e,t,a,r,o){var s,l,u,d,h,c,p,f,g=function(e,t){return e.f-t.f},m=new n(g),y=new n(g),b=o.getNodeAt(e,t),v=o.getNodeAt(a,r),w=this.heuristic,x=this.diagonalMovement,I=this.weight,T=Math.abs,M=Math.SQRT2;for(b.g=0,b.f=0,m.push(b),b.opened=1,v.g=0,v.f=0,y.push(v),v.opened=2;!m.empty()&&!y.empty();){for((s=m.pop()).closed=!0,d=0,h=(l=o.getNeighbors(s,x)).length;d<h;++d)if(!(u=l[d]).closed){if(2===u.opened)return i.biBacktrace(s,u);c=u.x,p=u.y,f=s.g+(c-s.x==0||p-s.y==0?1:M),(!u.opened||f<u.g)&&(u.g=f,u.h=u.h||I*w(T(c-a),T(p-r)),u.f=u.g+u.h,u.parent=s,u.opened?m.updateItem(u):(m.push(u),u.opened=1))}for((s=y.pop()).closed=!0,d=0,h=(l=o.getNeighbors(s,x)).length;d<h;++d)if(!(u=l[d]).closed){if(1===u.opened)return i.biBacktrace(u,s);c=u.x,p=u.y,f=s.g+(c-s.x==0||p-s.y==0?1:M),(!u.opened||f<u.g)&&(u.g=f,u.h=u.h||I*w(T(c-e),T(p-t)),u.f=u.g+u.h,u.parent=s,u.opened?y.updateItem(u):(y.push(u),u.opened=2))}}return[]},t.exports=s},{"../core/DiagonalMovement":11,"../core/Heuristic":13,"../core/Util":15,heap:6}],19:[function(e,t,a){var n=e("./BiAStarFinder");function i(e){n.call(this,e);var t=this.heuristic;this.heuristic=function(e,a){return 1e6*t(e,a)}}i.prototype=new n,i.prototype.constructor=i,t.exports=i},{"./BiAStarFinder":18}],20:[function(e,t,a){var n=e("../core/Util"),i=e("../core/DiagonalMovement");function r(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=i.OnlyWhenNoObstacles:this.diagonalMovement=i.IfAtMostOneObstacle:this.diagonalMovement=i.Never)}r.prototype.findPath=function(e,t,a,i,r){var o,s,l,u,d,h=r.getNodeAt(e,t),c=r.getNodeAt(a,i),p=[],f=[],g=this.diagonalMovement;for(p.push(h),h.opened=!0,h.by=0,f.push(c),c.opened=!0,c.by=1;p.length&&f.length;){for((l=p.shift()).closed=!0,u=0,d=(o=r.getNeighbors(l,g)).length;u<d;++u)if(!(s=o[u]).closed)if(s.opened){if(1===s.by)return n.biBacktrace(l,s)}else p.push(s),s.parent=l,s.opened=!0,s.by=0;for((l=f.shift()).closed=!0,u=0,d=(o=r.getNeighbors(l,g)).length;u<d;++u)if(!(s=o[u]).closed)if(s.opened){if(0===s.by)return n.biBacktrace(s,l)}else f.push(s),s.parent=l,s.opened=!0,s.by=1}return[]},t.exports=r},{"../core/DiagonalMovement":11,"../core/Util":15}],21:[function(e,t,a){var n=e("./BiAStarFinder");function i(e){n.call(this,e),this.heuristic=function(e,t){return 0}}i.prototype=new n,i.prototype.constructor=i,t.exports=i},{"./BiAStarFinder":18}],22:[function(e,t,a){var n=e("../core/Util"),i=e("../core/DiagonalMovement");function r(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=i.OnlyWhenNoObstacles:this.diagonalMovement=i.IfAtMostOneObstacle:this.diagonalMovement=i.Never)}r.prototype.findPath=function(e,t,a,i,r){var o,s,l,u,d,h=[],c=this.diagonalMovement,p=r.getNodeAt(e,t),f=r.getNodeAt(a,i);for(h.push(p),p.opened=!0;h.length;){if((l=h.shift()).closed=!0,l===f)return n.backtrace(f);for(u=0,d=(o=r.getNeighbors(l,c)).length;u<d;++u)(s=o[u]).closed||s.opened||(h.push(s),s.opened=!0,s.parent=l)}return[]},t.exports=r},{"../core/DiagonalMovement":11,"../core/Util":15}],23:[function(e,t,a){var n=e("./AStarFinder");function i(e){n.call(this,e),this.heuristic=function(e,t){return 0}}i.prototype=new n,i.prototype.constructor=i,t.exports=i},{"./AStarFinder":16}],24:[function(e,t,a){e("../core/Util");var n=e("../core/Heuristic"),i=e("../core/Node"),r=e("../core/DiagonalMovement");function o(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||n.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=r.OnlyWhenNoObstacles:this.diagonalMovement=r.IfAtMostOneObstacle:this.diagonalMovement=r.Never),this.diagonalMovement===r.Never?this.heuristic=e.heuristic||n.manhattan:this.heuristic=e.heuristic||n.octile}o.prototype.findPath=function(e,t,a,n,r){var o,s,l,u=(new Date).getTime(),d=function(e,t){return this.heuristic(Math.abs(t.x-e.x),Math.abs(t.y-e.y))}.bind(this),h=function(e,t,a,n,o){if(0,this.timeLimit>0&&(new Date).getTime()-u>1e3*this.timeLimit)return 1/0;var s,l,c,f,g=t+d(e,p)*this.weight;if(g>a)return g;if(e==p)return n[o]=[e.x,e.y],e;var m,y,b=r.getNeighbors(e,this.diagonalMovement);for(c=0,s=1/0;f=b[c];++c){if(this.trackRecursion&&(f.retainCount=f.retainCount+1||1,!0!==f.tested&&(f.tested=!0)),(l=h(f,t+(y=f,(m=e).x===y.x||m.y===y.y?1:Math.SQRT2),a,n,o+1))instanceof i)return n[o]=[e.x,e.y],l;this.trackRecursion&&0==--f.retainCount&&(f.tested=!1),l<s&&(s=l)}return s}.bind(this),c=r.getNodeAt(e,t),p=r.getNodeAt(a,n),f=d(c,p);for(o=0;;++o){if((l=h(c,0,f,s=[],0))===1/0)return[];if(l instanceof i)return s;f=l}return[]},t.exports=o},{"../core/DiagonalMovement":11,"../core/Heuristic":13,"../core/Node":14,"../core/Util":15}],25:[function(e,t,a){var n=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,a,n){var i=this.grid,r=e-a,o=t-n;if(!i.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r&&0!==o){if(i.isWalkableAt(e-r,t+o)&&!i.isWalkableAt(e-r,t)||i.isWalkableAt(e+r,t-o)&&!i.isWalkableAt(e,t-o))return[e,t];if(this._jump(e+r,t,e,t)||this._jump(e,t+o,e,t))return[e,t]}else if(0!==r){if(i.isWalkableAt(e+r,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+r,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+o)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+o)&&!i.isWalkableAt(e-1,t))return[e,t];return this._jump(e+r,t+o,e,t)},r.prototype._findNeighbors=function(e){var t,a,n,r,o,s,l,u,d=e.parent,h=e.x,c=e.y,p=this.grid,f=[];if(d)t=d.x,a=d.y,n=(h-t)/Math.max(Math.abs(h-t),1),r=(c-a)/Math.max(Math.abs(c-a),1),0!==n&&0!==r?(p.isWalkableAt(h,c+r)&&f.push([h,c+r]),p.isWalkableAt(h+n,c)&&f.push([h+n,c]),p.isWalkableAt(h+n,c+r)&&f.push([h+n,c+r]),p.isWalkableAt(h-n,c)||f.push([h-n,c+r]),p.isWalkableAt(h,c-r)||f.push([h+n,c-r])):0===n?(p.isWalkableAt(h,c+r)&&f.push([h,c+r]),p.isWalkableAt(h+1,c)||f.push([h+1,c+r]),p.isWalkableAt(h-1,c)||f.push([h-1,c+r])):(p.isWalkableAt(h+n,c)&&f.push([h+n,c]),p.isWalkableAt(h,c+1)||f.push([h+n,c+1]),p.isWalkableAt(h,c-1)||f.push([h+n,c-1]));else for(l=0,u=(o=p.getNeighbors(e,i.Always)).length;l<u;++l)s=o[l],f.push([s.x,s.y]);return f},t.exports=r},{"../core/DiagonalMovement":11,"./JumpPointFinderBase":30}],26:[function(e,t,a){var n=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,a,n){var i=this.grid,r=e-a,o=t-n;if(!i.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r&&0!==o){if(i.isWalkableAt(e-r,t+o)&&!i.isWalkableAt(e-r,t)||i.isWalkableAt(e+r,t-o)&&!i.isWalkableAt(e,t-o))return[e,t];if(this._jump(e+r,t,e,t)||this._jump(e,t+o,e,t))return[e,t]}else if(0!==r){if(i.isWalkableAt(e+r,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+r,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+o)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+o)&&!i.isWalkableAt(e-1,t))return[e,t];return i.isWalkableAt(e+r,t)||i.isWalkableAt(e,t+o)?this._jump(e+r,t+o,e,t):null},r.prototype._findNeighbors=function(e){var t,a,n,r,o,s,l,u,d=e.parent,h=e.x,c=e.y,p=this.grid,f=[];if(d)t=d.x,a=d.y,n=(h-t)/Math.max(Math.abs(h-t),1),r=(c-a)/Math.max(Math.abs(c-a),1),0!==n&&0!==r?(p.isWalkableAt(h,c+r)&&f.push([h,c+r]),p.isWalkableAt(h+n,c)&&f.push([h+n,c]),(p.isWalkableAt(h,c+r)||p.isWalkableAt(h+n,c))&&f.push([h+n,c+r]),!p.isWalkableAt(h-n,c)&&p.isWalkableAt(h,c+r)&&f.push([h-n,c+r]),!p.isWalkableAt(h,c-r)&&p.isWalkableAt(h+n,c)&&f.push([h+n,c-r])):0===n?p.isWalkableAt(h,c+r)&&(f.push([h,c+r]),p.isWalkableAt(h+1,c)||f.push([h+1,c+r]),p.isWalkableAt(h-1,c)||f.push([h-1,c+r])):p.isWalkableAt(h+n,c)&&(f.push([h+n,c]),p.isWalkableAt(h,c+1)||f.push([h+n,c+1]),p.isWalkableAt(h,c-1)||f.push([h+n,c-1]));else for(l=0,u=(o=p.getNeighbors(e,i.IfAtMostOneObstacle)).length;l<u;++l)s=o[l],f.push([s.x,s.y]);return f},t.exports=r},{"../core/DiagonalMovement":11,"./JumpPointFinderBase":30}],27:[function(e,t,a){var n=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,a,n){var i=this.grid,r=e-a,o=t-n;if(!i.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r&&0!==o){if(this._jump(e+r,t,e,t)||this._jump(e,t+o,e,t))return[e,t]}else if(0!==r){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-r,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-r,t+1))return[e,t]}else if(0!==o&&(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-o)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-o)))return[e,t];return i.isWalkableAt(e+r,t)&&i.isWalkableAt(e,t+o)?this._jump(e+r,t+o,e,t):null},r.prototype._findNeighbors=function(e){var t,a,n,r,o,s,l,u,d,h=e.parent,c=e.x,p=e.y,f=this.grid,g=[];if(h){if(t=h.x,a=h.y,n=(c-t)/Math.max(Math.abs(c-t),1),r=(p-a)/Math.max(Math.abs(p-a),1),0!==n&&0!==r)f.isWalkableAt(c,p+r)&&g.push([c,p+r]),f.isWalkableAt(c+n,p)&&g.push([c+n,p]),f.isWalkableAt(c,p+r)&&f.isWalkableAt(c+n,p)&&g.push([c+n,p+r]);else if(0!==n){d=f.isWalkableAt(c+n,p);var m=f.isWalkableAt(c,p+1),y=f.isWalkableAt(c,p-1);d&&(g.push([c+n,p]),m&&g.push([c+n,p+1]),y&&g.push([c+n,p-1])),m&&g.push([c,p+1]),y&&g.push([c,p-1])}else if(0!==r){d=f.isWalkableAt(c,p+r);var b=f.isWalkableAt(c+1,p),v=f.isWalkableAt(c-1,p);d&&(g.push([c,p+r]),b&&g.push([c+1,p+r]),v&&g.push([c-1,p+r])),b&&g.push([c+1,p]),v&&g.push([c-1,p])}}else for(l=0,u=(o=f.getNeighbors(e,i.OnlyWhenNoObstacles)).length;l<u;++l)s=o[l],g.push([s.x,s.y]);return g},t.exports=r},{"../core/DiagonalMovement":11,"./JumpPointFinderBase":30}],28:[function(e,t,a){var n=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,a,n){var i=this.grid,r=e-a,o=t-n;if(!i.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-r,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-r,t+1))return[e,t]}else{if(0===o)throw new Error("Only horizontal and vertical movements are allowed");if(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-o)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-o))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}return this._jump(e+r,t+o,e,t)},r.prototype._findNeighbors=function(e){var t,a,n,r,o,s,l,u,d=e.parent,h=e.x,c=e.y,p=this.grid,f=[];if(d)t=d.x,a=d.y,n=(h-t)/Math.max(Math.abs(h-t),1),r=(c-a)/Math.max(Math.abs(c-a),1),0!==n?(p.isWalkableAt(h,c-1)&&f.push([h,c-1]),p.isWalkableAt(h,c+1)&&f.push([h,c+1]),p.isWalkableAt(h+n,c)&&f.push([h+n,c])):0!==r&&(p.isWalkableAt(h-1,c)&&f.push([h-1,c]),p.isWalkableAt(h+1,c)&&f.push([h+1,c]),p.isWalkableAt(h,c+r)&&f.push([h,c+r]));else for(l=0,u=(o=p.getNeighbors(e,i.Never)).length;l<u;++l)s=o[l],f.push([s.x,s.y]);return f},t.exports=r},{"../core/DiagonalMovement":11,"./JumpPointFinderBase":30}],29:[function(e,t,a){var n=e("../core/DiagonalMovement"),i=e("./JPFNeverMoveDiagonally"),r=e("./JPFAlwaysMoveDiagonally"),o=e("./JPFMoveDiagonallyIfNoObstacles"),s=e("./JPFMoveDiagonallyIfAtMostOneObstacle");t.exports=function(e){return(e=e||{}).diagonalMovement===n.Never?new i(e):e.diagonalMovement===n.Always?new r(e):e.diagonalMovement===n.OnlyWhenNoObstacles?new o(e):new s(e)}},{"../core/DiagonalMovement":11,"./JPFAlwaysMoveDiagonally":25,"./JPFMoveDiagonallyIfAtMostOneObstacle":26,"./JPFMoveDiagonallyIfNoObstacles":27,"./JPFNeverMoveDiagonally":28}],30:[function(e,t,a){var n=e("heap"),i=e("../core/Util"),r=e("../core/Heuristic");e("../core/DiagonalMovement");function o(e){e=e||{},this.heuristic=e.heuristic||r.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}o.prototype.findPath=function(e,t,a,r,o){var s,l=this.openList=new n(function(e,t){return e.f-t.f}),u=this.startNode=o.getNodeAt(e,t),d=this.endNode=o.getNodeAt(a,r);for(this.grid=o,u.g=0,u.f=0,l.push(u),u.opened=!0;!l.empty();){if((s=l.pop()).closed=!0,s===d)return i.expandPath(i.backtrace(d));this._identifySuccessors(s)}return[]},o.prototype._identifySuccessors=function(e){var t,a,n,i,o,s,l,u,d,h,c=this.grid,p=this.heuristic,f=this.openList,g=this.endNode.x,m=this.endNode.y,y=e.x,b=e.y,v=Math.abs;Math.max;for(i=0,o=(t=this._findNeighbors(e)).length;i<o;++i)if(a=t[i],n=this._jump(a[0],a[1],y,b)){if(s=n[0],l=n[1],(h=c.getNodeAt(s,l)).closed)continue;u=r.octile(v(s-y),v(l-b)),d=e.g+u,(!h.opened||d<h.g)&&(h.g=d,h.h=h.h||p(v(s-g),v(l-m)),h.f=h.g+h.h,h.parent=e,h.opened?f.updateItem(h):(f.push(h),h.opened=!0))}},t.exports=o},{"../core/DiagonalMovement":11,"../core/Heuristic":13,"../core/Util":15,heap:6}],31:[function(e,t,a){t.exports=function(e,t,a,n,i,r,o,s,l){const u=this;let d={id:u.lastEntityId++,x:a,y:n,z:i,lastX:a,lastY:n,lastZ:i,width:r,height:o,team:s,rotation:0,dx:0,dy:0,energy:100,collisionLayer:1,type:e,subtype:t,valid:!0,netData:{alive:!0,health:100}};return l&&Object.assign(d.netData,l),d.tick=(()=>{Math.abs(d.dx)<=.001&&(d.dx=0),Math.abs(d.dy)<=.001&&(d.dy=0),d.x+=d.dx,d.y+=d.dy,d.sendMoveUpdate=d.x!==d.lastX||d.y!==d.lastY||d.rotation!==d.lastRotation,d.z!==d.lastZ&&d.sendRPC("changeZLevel",d.z),d.netData.name!==d.lastName&&(d.lastName=d.netData.name,d.sendRPC("changeName",{name:d.netData.name,isDev:d.netData.isDev,settings:d.netData.settings})),d.kill&&d.netData.alive&&!d.isAI&&(d.x<=0||d.y<=0||d.x>=u.MAP_SIZE*u.TILE_SIZE||d.y>=u.MAP_SIZE*u.TILE_SIZE)&&d.kill(),d.lastX=d.x,d.lastY=d.y,d.lastZ=d.z,d.lastRotation=d.rotation}),d.remove=(()=>{d.valid=!1}),d.onRemove=(()=>{}),d.setHungry=(e=>{d.netData.hungry=e,d.sendRPC("setHungry",d.netData.hungry)}),d.lastRequestTime=u.getModifiedTime(),d.checkRequestTask=(()=>{if(d.valid&&d.netData.alive&&u.getModifiedTime()>=d.lastRequestTime)if(d.netData.hungry){let e=u.getNearbyWorker(d);e?(e.target=d,e.setAIState("feed"),d.lastRequestTime=u.getModifiedTime()+15e3):d.lastRequestTime=u.getModifiedTime()+("ant_queen"===d.subtype?2e3:1e4)}else d.lastRequestTime=u.getModifiedTime()+1e3}),d.eat=(e=>{d.hasEaten=!0,d.energy=100,d.netData.health=100,d.setHungry(!1),e&&e.netData.superFood&&(d.netData.isSuper=!0,d.superTime=u.getModifiedTime()),"ant_worker"===d.subtype&&(d.feedCountAvailable=3)}),d.getCreateData=(()=>({id:d.id,x:d.x,y:d.y,z:d.z,width:r,height:o,rotation:d.rotation,type:d.type,team:d.team,subtype:d.subtype,netData:d.netData})),d.sendRPC=((e,t)=>{u.sendMessage("entityrpc",{id:d.id,name:e,data:t})}),u.addEntity(d),d}},{}],32:[function(e,t,a){(function(a){const n=e("pathfinding"),i=e("../tilefinder");t.exports=function(e,t,r,o,s,l,u,d){const h=this;if("ant_queen"===e&&-1===u){let e=h.createTeam();u=e.id}d&&"centipede"===d.bugType&&!d.zOffset&&(d.zOffset=0);let c=h.createEntity("insect",e,t,r,o,s,l,u,d);c.isAI=!0,c.radius=14,c.carriedObject=null,c.leader=null,c.path=[],c.aiState="idle",c.lastAITeamThink=h.getModifiedTime(),c.stateChangeTime=h.getModifiedTime(),c.aiReturnPos=null,c.griefCount=0,c.dataAI={greetList:{},roleEncounters:{},role:"nurse",lastRoleCheck:Date.now()-(3e4+Math.round(1e4*Math.random()))},"ant_queen"===e&&(h.teamData[u].queen=c,h.teamData[u]&&h.teamData[u].queens&&h.teamData[u].queens.push(c)),"ant_worker"===e&&(c.feedCountAvailable=3),c.stuckTicker=0,c.stuckCheckTicker=0,c.stuckCheckPos={x:0,y:0};let p=1e3,f=0,g=null,m=8,y=6,b=28,v=!1,w=1e4;if("ant_queen"===e)m=15,c.radius=20,c.netData.health=125;else if("ant_worker"===e&&c.netData.soldier){let e=1,t=1;s>80?(e=1.15,t=.85,c.radius=22):c.radius=14,m=22*e,y=5*t,b=28,c.netData.health=130*e}else if("spider"===e)y=5.25,c.radius=35,b=50,p=1200,m=60,w=16e4;else if("bug"===e){if(d&&"centipede"===d.bugType){v=!0;let e=s/120,a=1-e+1;if(y=6*a,c.radius=s/6*e,b=c.radius-2,p=800*a,m=40*e,"head"===d.centipedeType){c.netData.health=90*e,b=50;let a=c,n=15+Math.round(15*Math.random());c.z>=1&&(n-=8);for(let e=0;e<n;e++){let i=h.createInsect("bug",t,r+18*(e+1),c.z,s,l,-1,{bugType:"centipede",centipedeType:e>=n-1?"tail":"body",zOffset:25*(e+1)});i.mainEntity=c,i.attach(a,"head"===a.netData.centipedeType?10:14),a=i}}else c.netData.health=60*e,y=2*a}else y=3,c.radius=30,b=50,p=1800,m=10;w=16e4}else"beetle"===e&&(y=2.8,c.radius=45,b=50,p=1800,m=10,w=16e4);c.parent=null;let x=12;c.attach=function(e,t){c.parent=e,x=t};let I=100,T=Math.round(40*Math.random()),M=c.tick;c.tick=(()=>{if(c.netData.alive){if(c.netData.isSuper&&c.superTime&&h.getModifiedTime()-c.superTime>9e4&&(c.netData.isSuper=!1),c.isAI&&"ant_queen"!==c.subtype||(c.energy<=0?c.kill():(c.energy>100&&(c.energy=100),c.energy-=.018,c.energy<=40&&!c.netData.hungry&&c.setHungry(!0))),!c.isAI&&c.target)if(c.target.valid&&c.target.netData&&c.target.netData.alive){c.moveToPos={x:c.target.x,y:c.target.y},Math.distanceBetween(c,c.target)<c.radius+c.target.radius+10&&c.performAttack(c.target)}else c.target=null;if("ant_queen"===c.subtype&&!c.netData.hungry&&!c.netData.newQueen&&1===c.z)if(I<=0){h.teamData[c.team].aliveAntCount<0&&(h.teamData[c.team].aliveAntCount=1),I=c.netData.isSuper?325+3*h.teamData[c.team].aliveAntCount:425+4*h.teamData[c.team].aliveAntCount;let e=c.x+Math.random(),t=c.y+Math.random();e+=6*Math.cos(c.rotation+Math.PI/2),t+=6*Math.sin(c.rotation+Math.PI/2);let a="normal",n=45;"domination"===h.gamemode.type&&c.valid&&c.birthCount>=25&&h.teamData[c.team].queens.length<3&&(c.birthCount=0,n=75,a="queen");let i=h.createObject("brood",e,t,c.z,n,n,c.team);i.broodType=a,i.queen=c}else I--;if(c.moveToPos&&c.netData&&!c.netData.digging&&(v||h.getModifiedTime()-f>p)){let e=Math.distanceBetween(c,c.moveToPos),t=Math.angleBetween(c,c.moveToPos);c.rotation=t+Math.PI/2;let a=2*y;c.carriedObject&&(a*=.82),c.netData.isSuper&&(a*=1.4),c.lastDamageTime&&h.getModifiedTime()-c.lastDamageTime<=2500&&(a*=.75),c.dx+=Math.cos(t)*a,c.dy+=Math.sin(t)*a;let n=b;c.moveToPos.action&&c.carriedObject&&"dirt"===c.carriedObject.subtype&&(n+=30),e<n&&(c.moveToPos.action&&c.performAction(),c.moveToPos=null)}if(c.netData.digging&&(g?g.amount<25?g.amount++:(c.changeGrabbedObject({subtype:"dirt"}),h.updateTile(g.tx,g.ty,0),c.stopDig()):c.stopDig()),c.isAI){if("ant_worker"===c.subtype&&c.queen&&(!c.queen.valid||!c.queen.netData||!c.queen.netData.alive)){if(!(h.teamData[c.team]&&h.teamData[c.team].queens&&h.teamData[c.team].queens.length))return c.queen=null,void c.kill();c.queen=h.teamData[c.team].queens[Math.floor(Math.random()*h.teamData[c.team].queens.length)]}if(c.tickAI(),c.target&&c.tickTargetAI(),!c.leader||c.leader.valid&&c.leader.netData&&c.leader.netData.alive&&!c.leader.isAI||(c.leader=null),"ant_queen"===c.subtype&&c.checkRequestTask(),c.stuckCheckTicker<=0){c.stuckCheckTicker=50,Math.distanceBetween(c,c.stuckCheckPos)<5?c.stuckTicker++:c.stuckTicker=0,c.stuckCheckPos.x=c.x,c.stuckCheckPos.y=c.y,c.stuckTicker>2&&(c.stuckTicker=0,c.moveToPos=null,c.path=[],c.setAIState("idle"))}else c.stuckCheckTicker--}}else c.removeTime?c.removeTime<h.getModifiedTime()&&c.remove():c.removeTime=h.getModifiedTime()+w;c.dx*=.5,c.dy*=.5,M()}),c.dig=((e,t)=>{"bug"===c.subtype?h.updateTile(e,t,0):(g={tx:e,ty:t,amount:0},c.netData.digging=!0,c.sendRPC("setDigging",c.netData.digging))}),c.stopDig=(()=>{g=null,c.netData.digging=!1,c.sendRPC("setDigging",c.netData.digging)});let k=Math.PI/2,D=Math.random()*Math.PI*2,S=null;c.tickAI=(()=>{if(c.isAggro=Math.abs(h.getModifiedTime()-c.lastAggroTime)>1e5,"spider"===e||"bug"===e||"beetle"===e){if("bug"===e&&c.netData&&c.netData.alive&&"centipede"===c.netData.bugType&&("head"===c.netData.centipedeType||c.parent||(c.netData.health-=5,c.netData.health<=0&&c.damage(1))),!c.moveToPos)if(c.parent&&c.parent.netData&&c.parent.netData.alive){c.moveToPos=null;let e=Math.distanceBetween(c,c.parent),t=Math.angleBetween(c,c.parent),a=e-x;if(Math.abs(a)>.5){c.rotation=t+Math.PI/2;let e=.95*a;c.x+=Math.cos(t)*e,c.y+=Math.sin(t)*e}if(c.parent.z!==c.z)if(S){Math.distanceBetween(c,S)>12&&(c.z=c.parent.z,S=null)}else S={x:c.parent.x,y:c.parent.y}}else if(c.parent&&(c.parent=null),T<=0){if(T="bug"===e&&c.netData&&"centipede"===c.netData.bugType?2:10,Math.random()>=.35&&(D+=Math.random()*k-k/2,c.moveToPos={x:c.x+Math.cos(D)*(50+600*Math.random()),y:c.y+Math.sin(D)*(50+600*Math.random())},c.moveToPos.x<=0||c.moveToPos.x>=h.MAP_SIZE*h.TILE_SIZE||c.moveToPos.y<=0||c.moveToPos.y>=h.MAP_SIZE*h.TILE_SIZE)){let e=3e3;c.moveToPos={x:h.MAP_SIZE*h.TILE_SIZE/2-e/2+Math.random()*e,y:h.MAP_SIZE*h.TILE_SIZE/2-e/2+Math.random()*e}}}else T--}else if(!c.moveToPos)if(c.path&&c.path.length>0){let e=c.path[0];c.moveToPos={x:e.x,y:e.y,action:!!e.action},Math.distanceBetween(c,e)<(e.maxDist?e.maxDist:180)&&(e.z>=0&&(c.z=e.z),c.path.shift(),c.path.length<=0&&e.dropObject&&c.carriedObject&&c.dropGrabbedObject())}else switch(c.aiState){case"feed":if(c.target&&c.target.valid&&c.target.netData.alive)if(c.carriedObject||"ant_worker"===c.target.subtype)c.target.netData.hungry&&c.target.z===c.z&&Math.distanceBetween(c,c.target)<2e3?(c.pathTo(c.target,null,null,!0),c.setAIState("idle")):(c.setAIState("idle"),c.dropGrabbedObject());else{let e=h.quadtrees[c.z].retrieve({x:c.x,y:c.y,width:3e3,height:3e3}),t=null,a=2e4;for(let n=0;n<e.length;n++){let i=e[n],r=Math.distanceBetween(c,i);c.z===i.z&&c.team===i.team&&i.valid&&"food"===i.subtype&&r<a&&(t=i,a=r)}t?c.pathTo(t,null,null,!0):c.setAIState("idle")}else c.setAIState("idle"),c.dropGrabbedObject();break;case"moveobject":if(!c.target||"food"!==c.target.subtype&&"brood"!==c.target.subtype)c.setAIState("idle"),c.dropGrabbedObject();else if(c.carriedObject)if(c.carriedObject===c.target&&c.queen&&c.queen.valid){let e=c.getPotentialTilesNearQueen("brood"===c.target.subtype?1:0);if(e.length){let t=e.length;t>4&&(t=4);let a=e[Math.floor(Math.random()*(t-1))].node;c.pathTo({x:a.x*h.TILE_SIZE+h.TILE_SIZE/2,y:a.y*h.TILE_SIZE+h.TILE_SIZE/2,z:1,returningHome:!0},35,!0)}else if(c.queen&&c.queen.anthill){let e=360*Math.random();c.pathTo({x:c.queen.anthill.x+100*Math.cos(e),y:c.queen.anthill.y+100*Math.sin(e),z:1,returningHome:!0},35,!0)}c.setAIState("idle")}else c.dropGrabbedObject();else c.pathTo(c.target,null,null,!0),c.path&&c.path.length||(c.setAIState("idle"),c.dropGrabbedObject());break;case"dig":if(c.carriedObject&&"dirt"===c.carriedObject.subtype)if(1===c.z&&c.queen&&c.queen.anthill){let e=360*Math.random(),t=null;try{t=h.getClosestAnthill(c,null,c)}catch(e){}t||(t=c.queen.anthill),c.pathTo({x:t.x+100*Math.cos(e),y:t.y+100*Math.sin(e),z:0},35,!1)}else c.setAIState("idle"),c.dropGrabbedObject();else c.digTarget?(c.dig(c.digTarget.x,c.digTarget.y),c.digTarget=null,c.target=null):(c.setAIState("idle"),c.dropGrabbedObject());break;case"follow":let e=c.leader;c.leader&&c.leader.followers&&c.leader.followers.length&&(c.leaderIndex=4*Math.floor(e.followers.indexOf(c)/4)-1,c.leader.followers[c.leaderIndex-1]&&(e=c.leader.followers[c.leaderIndex-1])),e&&e.valid&&e.netData.alive?(Math.distanceBetween(c,e)>100||e.z!==c.z)&&c.pathTo(e):c.setAIState("idle");break;case"defend":if(T<=0)if(T=10,c.defendTarget){if(Math.distanceBetween(c,c.defendTarget)>(c.defendRadius?c.defendRadius:200))c.pathTo(c.defendTarget,100);else if(Math.random()>=.75){let e=100;if(c.moveToPos={x:c.x+(Math.random()*(2*e)-e),y:c.y+(Math.random()*(2*e)-e)},1===c.z){let e=parseInt((c.moveToPos.x+h.TILE_SIZE/2)/h.TILE_SIZE),t=parseInt((c.moveToPos.y+h.TILE_SIZE/2)/h.TILE_SIZE);0!==h.getTile(e,t)[0]&&(c.moveToPos=null)}}}else c.setAIState("idle");else T--;break;case"idle":default:if(T<=0){if(T=50,"ant_worker"===c.subtype&&0===c.z&&!c.target&&h.getModifiedTime()-c.stateChangeTime>1e4&&Math.random()>=.25)h.teamData[c.team]&&(h.teamData[c.team].isFakeTeam&&"coop"===h.gamemode.type&&h.teamData[0]&&h.teamData[0].queen&&h.teamData[0].queen.valid?(c.pathTo({x:h.teamData[0].queen.x,y:h.teamData[0].queen.y,z:1},35),c.path&&c.path.length||(c.x=h.teamData[0].queen.x+Math.random(),c.y=h.teamData[0].queen.y+Math.random(),c.z=h.teamData[0].queen.z)):c.queen&&c.queen.anthill&&c.pathTo({x:c.queen.anthill.x,y:c.queen.anthill.y,z:1,returningHome:!0},35,!0));else if(Math.random()>=.9){let e=100;if("ant_queen"===c.subtype&&(e=25),c.moveToPos={x:c.x+(Math.random()*(2*e)-e),y:c.y+(Math.random()*(2*e)-e)},1===c.z){let e=parseInt((c.moveToPos.x+h.TILE_SIZE/2)/h.TILE_SIZE),t=parseInt((c.moveToPos.y+h.TILE_SIZE/2)/h.TILE_SIZE);0!==h.getTile(e,t)[0]&&(c.moveToPos=null)}}c.moveToPos||(c.carriedObject&&"dirt"===c.carriedObject.subtype?c.setAIState("dig"):c.dropGrabbedObject())}else T--;c.moveToPos||!h.teamData[c.team]||!h.teamData[c.team].isAI||c.carriedObject||"idle"!==c.aiState||c.path&&c.path.length||h.tickTeamAIEntity(c)}}),c.searchForTile=((e,t,a)=>{let r=new i({allowDiagonal:!0,dontCrossCorners:!1}),o=h.tileGrids[1].clone();if(a&&(o=new n.Grid(h.MAP_SIZE,h.MAP_SIZE)),!h.getTile(parseInt(e.x/h.TILE_SIZE),parseInt(e.y/h.TILE_SIZE)))return!1;try{let a=r.findTile(parseInt(e.x/h.TILE_SIZE),parseInt(e.y/h.TILE_SIZE),t,o);return a||!1}catch(e){return!1}});let A=0;c.tilesPathTo=((e,t,a,i,r)=>{if(!(a||h.getModifiedTime()-A>2e3))return!1;{let a=c.path&&c.path.length&&c.path[c.path.length-1]?c.path[c.path.length-1]:c;if(i&&(t=a.z),!h.tileGrids[t])return!1;let o=new n.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0}),s=h.tileGrids[t].clone(),l=h.getTile(parseInt(a.x/h.TILE_SIZE),parseInt(a.y/h.TILE_SIZE)),u=h.getTile(parseInt(e.x/h.TILE_SIZE),parseInt(e.y/h.TILE_SIZE));if(!l||!u)return A=h.getModifiedTime(),!1;try{let t=o.findPath(parseInt(a.x/h.TILE_SIZE),parseInt(a.y/h.TILE_SIZE),parseInt(e.x/h.TILE_SIZE),parseInt(e.y/h.TILE_SIZE),s);if(t&&t.length){if(!r)for(let e=t.length>=1?1:0;e<t.length-1;e++){let a=t[e];c.path.push({x:a[0]*h.TILE_SIZE+h.TILE_SIZE/2,y:a[1]*h.TILE_SIZE+h.TILE_SIZE/2})}return!0}return A=h.getModifiedTime(),!1}catch(e){return A=h.getModifiedTime(),!1}}}),c.pathTo=((e,t,a,n,i)=>{if(c.path=[],c.z!==e.z){let t=h.getClosestAnthill(c,e.returningHome?c.team:null,c);if(!t)return;c.tilesPathTo(t,c.z),0===c.z&&c.path&&c.path.length>=2&&c.path.shift(),c.path.push({x:t.x,y:t.y,z:e.z,maxDist:35})}else if(0===c.z){let t=e.z===c.z?e:c.path[c.path.length-1];if(!t)return void(c.path=[]);if(Math.distanceBetween(c,t)>600||i){if(!c.tilesPathTo(t,c.z))return void(c.path=[])}}if(e.z>=1){if(!c.tilesPathTo(e,e.z)){c.path=[];let t=h.getClosestAnthill(c,null,c),a=h.getClosestAnthill(e);if(c.path=[],t===a||!t||!a)return void(c.path=[]);if(t){if(!c.tilesPathTo(t,c.z,!0,!0))return void(c.path=[]);c.path.push({x:t.x,y:t.y,z:0,maxDist:35})}if(a){if(!c.tilesPathTo(a,c.z,!0,!0))return void(c.path=[]);c.path.push({x:a.x,y:a.y,z:e.z,maxDist:35})}c.tilesPathTo(e,e.z,!0)}}let r={x:e.x+(10*Math.random()-5),y:e.y+(10*Math.random()-5),z:e.z};a&&(r.dropObject=a),t&&(r.maxDist=t),n&&(r.action=n),c.path.push(r)}),c.stateChangeTime=h.getModifiedTime(),c.setAIState=(e=>{c.aiState=e,c.stateChangeTime=h.getModifiedTime(),"idle"===e&&(c.target=null,_=0),"local"===a.env.NODE_ENV&&c.sendRPC("setAIState",c.aiState)}),c.setFollow=(e=>{c.leader=e,c.dropGrabbedObject(),e?(c.path=[],c.moveToPos=null,c.setAIState("follow"),e.followers||(e.followers=[]),e.followers.push(c)):c.setAIState("idle")}),c.lastActionTime=h.getModifiedTime(),c.performAction=(()=>{if(c.moveToPos.action&&h.getModifiedTime()-c.lastActionTime>=100){if(c.lastActionTime=h.getModifiedTime(),c.moveToPos.action=!1,!c.carriedObject)for(let e=0;e<h.entities.length;e++){let t=h.entities[e],a=Math.distanceBetween(c.moveToPos,t);if(c!==t&&c.z===t.z&&t.valid&&("food"===t.subtype||"brood"===t.subtype||"aphid"===t.subtype)&&a<15)return void(c.netData.hungry&&"food"===t.subtype?(c.eat(t),t.remove()):c.changeGrabbedObject(t))}let e=h.quadtrees[c.z].retrieve({x:c.x,y:c.y,width:200,height:200});for(let t=0;t<e.length;t++){let a=e[t],n=Math.distanceBetween(c.moveToPos,a);if("anthill"===a.subtype&&(c.z===a.z||c.z===a.z+1)&&a.valid&&n<40&&("ant_queen"!==c.subtype||c.team===a.team&&c.netData&&c.netData.newQueen))return void(c.z>a.z?c.z--:c.z++);if(!c.carriedObject&&"insect"===a.type&&c.team!==a.team&&c.z===a.z&&a.valid&&a.netData.alive&&n<c.radius+a.radius+5)return c.performAttack(a),void(c.moveToPos=null);if(c!==a&&c.carriedObject&&"food"===c.carriedObject.subtype&&("insect"===a.type||"brood"===a.subtype)&&c.team===a.team&&a.netData.hungry&&c.z===a.z&&a.valid&&n<c.radius+a.radius+5)return a.eat(c.carriedObject),void c.changeGrabbedObject(null)}if(1===c.z&&!c.carriedObject){let e=parseInt(c.moveToPos.x/h.TILE_SIZE),t=parseInt(c.moveToPos.y/h.TILE_SIZE);if(1===h.getTile(e,t)[0])return void c.dig(e,t)}if(c.carriedObject)c.dropGrabbedObject();else if("ant_queen"===c.subtype&&c.netData.newQueen&&0===c.z){let e=h.MAP_SIZE*h.TILE_SIZE;if(c.x<250||c.y<250||c.x>e-250||c.y>e-250)c.currentPlayer&&c.currentPlayer.emit("growl","Nest too close to map edge.");else{let e=!1;for(let t=0;t<h.entities.length;t++){let a=h.entities[t],n=850;"anthill"===a.subtype&&a.team===c.team&&(n=500),"anthill"!==a.subtype||a.queen&&a.queen.valid||(n=250),"anthill"===a.subtype&&Math.distanceBetween(c,a)<n&&(e=!0)}e?c.currentPlayer&&c.currentPlayer.emit("growl","Nest too close to another colony."):h.createNewAnthill(c)}}}}),c.lastAggroTime=h.getModifiedTime(),c.isAggro=!1,c.performAttack=(e=>{if(e&&e.damage&&!c.carriedObject&&h.getModifiedTime()-f>p){f=h.getModifiedTime();let t=e.damage(m,c);c.rotation=Math.angleBetween(c,e)+Math.PI/2,c.sendRPC("performAttack",null),t&&("spider"===c.subtype||"bug"===c.subtype&&c.netData&&"centipede"===c.netData.bugType&&"head"===c.netData.centipedeType)&&(c.lastAggroTime=h.getModifiedTime()),c.isAI||(c.target=e)}}),c.damage=((e,t)=>{if(c.netData&&c.netData.alive){if(c.netData.health-=e,c.lastDamageTime=h.getModifiedTime(),c.lastAggroTime=0,c.mainEntity&&(c.mainEntity.lastAggroTime=0),c.netData.health<=0)return c.kill(),!0;c.sendRPC("damage",e)}});let E=1e4,_=0;return c.resetTarget=(()=>{c.target&&(c.target=null,E=1e4,_=0,c.dropGrabbedObject(),c.moveToPos=null,c.path=null)}),c.tickTargetAI=(()=>{if(c.target&&(c.target.valid||c.target===c.carriedObject)){if(E=Math.distanceBetween(c,c.target),c.target!==c.carriedObject&&(E>800||c.z!==c.target.z||"object"!==c.target.subtype&&c.target.netData&&!c.target.netData.alive))c.resetTarget();else if("spider"===c.subtype||"bug"===c.subtype&&c.netData&&"centipede"===c.netData.bugType&&"head"===c.netData.centipedeType){if(("ant_worker"===c.target.subtype||"ant_queen"===c.target.subtype)&&c.target.netData.alive&&(E<=70&&c.performAttack(c.target),E<=400))if(c.netData&&"centipede"===c.netData.bugType){if(E>100){let e=Math.angleBetween(c,c.target);c.moveToPos={x:c.target.x+150*Math.cos(e),y:c.target.y+150*Math.sin(e)}}}else c.moveToPos={x:c.target.x,y:c.target.y}}else if("ant_worker"===c.subtype||"ant_queen"===c.subtype)if("insect"===c.target.type&&!c.carriedObject&&c.team!==c.target.team&&c.target.netData.alive&&E<=250&&(("idle"===c.aiState||"defend"===c.aiState)&&"ant_queen"!==c.subtype||E<80))if(c.netData.newQueen){if(!(c.moveToPos||c.path&&c.path.length)){let e=Math.angleBetween(c,c.target)-Math.PI/2;c.pathTo({x:100*Math.cos(e),y:100*Math.sin(e),z:c.z})}}else E<c.radius+c.target.radius+5?c.performAttack(c.target):c.moveToPos||c.path&&c.path.length||c.pathTo(c.target);else"ant_worker"!==c.subtype||"idle"!==c.aiState||!c.queen||!c.queen.anthill||0!==c.z&&c.team===c.target.team||"food"!==c.target.subtype&&"brood"!==c.target.subtype||c.carriedObject||!(E<=350)||h.teamData[c.team].isFakeTeam?"ant_worker"===c.subtype&&"ant_worker"===c.target.subtype&&h.teamData[c.team]&&h.teamData[c.team].isAI&&c.team===c.target.team&&"idle"===c.aiState?c.moveToPos||c.path&&c.path.length||(c.greetOther(c.target,!0),c.pathTo(c.target),c.target=null):"ant_worker"===c.subtype&&"anthill"===c.target.subtype&&(c.pathTo({x:c.target.x,y:c.target.y,z:1}),c.target=null):(c.moveToPos||c.path&&c.path.length||c.pathTo(c.target),E<25&&(c.changeGrabbedObject(c.target),c.setAIState("moveobject"),c.aiReturnPos={x:c.target.x,y:c.target.y,z:c.target.z}))}else c.resetTarget()}),c.greetOther=((e,t,a)=>{c.dataAI&&c.dataAI.greetList&&!c.dataAI.greetList[e.id]?(c.dataAI.greetList[e.id]=!0,c.dataAI.roleEncounters[e.dataAI.role]||(c.dataAI.roleEncounters[e.dataAI.role]=0),c.dataAI.roleEncounters[e.dataAI.role]++,t&&e.greetOther(c,!1,!0),!c.carriedObject&&e.aiReturnPos&&"idle"===c.aiState&&e.carriedObject&&c.pathTo(e.aiReturnPos)):a&&Math.random()>.5&&(c.carriedObject||!e.aiReturnPos||"idle"!==c.aiState||!e.carriedObject||c.path&&c.path.length||c.pathTo(e.aiReturnPos))}),c.thinkAI=((e,t)=>{let a=!1,n=1;c.isAggro&&("spider"===c.subtype||"bug"===c.subtype&&c.netData&&"centipede"===c.netData.bugType&&"head"===c.netData.centipedeType)?"ant_worker"!==e.subtype&&"ant_queen"!==e.subtype||!e.netData.alive||(a=!0,n=5):"ant_worker"!==c.subtype&&"ant_queen"!==c.subtype||("insect"===e.type&&c.team!==e.team&&e.netData.alive&&(t<=250&&e.isAggro||t<=120)&&(("idle"===c.aiState||"defend"===c.aiState)&&"ant_queen"!==c.subtype||t<80)?(a=!0,n=5):"ant_worker"===c.subtype&&"idle"===c.aiState&&h.teamData[c.team]&&c.queen&&c.queen.anthill&&(0===c.z||c.team!==e.team)&&("food"===e.subtype||"brood"===e.subtype)&&t<=350?(a=!0,n="brood"===e.subtype?4:"food"===e.subtype&&e.netData&&e.netData.superFood?3:2):"ant_worker"===e.subtype&&t<250&&h.teamData[c.team]&&h.teamData[c.team].isAI&&c.team===e.team&&c.dataAI.greetList&&!c.dataAI.greetList[e.id]?(a=!0,n=1):!("anthill"===e.subtype&&c.queen&&c.queen.birthCount>30&&t<150&&h.teamData[c.team]&&h.teamData[c.team].isAI&&c.team!==e.team)||c.carriedObject||c.path&&c.path.length||c.moveToPos||"idle"!==c.aiState||(a=!0,n=2)),a&&n>_&&c.carriedObject&&t<100&&c.resetTarget(),a&&!c.carriedObject&&n>=_&&(!c.target||t<E)&&(E=t,_=n,c.target=e)}),c.getPotentialTilesNearQueen=(e=>{let t=[];return c.searchForTile(c.queen,(a,n)=>{let i=h.getTile(a.x,a.y);if(i[1]===e&&i[2]<=.98){let e=Math.distanceBetween(a,n);return t.push({node:a,tile:i,score:4*(1-i[2])-e}),t.length>=8}return!1}),t.sort((e,t)=>t.score-e.score),t}),c.onCollide=(e=>{"ant_queen"===c.subtype&&c.netData.alive&&c.netData.hungry&&"food"===e.subtype?(c.eat(e),e.remove()):"ant_worker"!==c.subtype&&c.netData.alive&&e.static?(c.moveToPos=null,D=Math.random()*Math.PI*2):"ant_worker"===c.subtype&&"ant_worker"===e.subtype&&h.teamData[c.team]&&h.teamData[c.team].isAI&&c.team===e.team&&c.dataAI&&c.dataAI.greetList&&!c.dataAI.greetList[e.id]&&c.greetOther(e,!0,!0)}),c.dropGrabbedObject=(()=>{if(c.carriedObject)if("food"===c.carriedObject.subtype||"brood"===c.carriedObject.subtype||"aphid"===c.carriedObject.subtype){if(c.z>=1&&c.moveToPos){let e=parseInt(c.moveToPos.x/h.TILE_SIZE),t=parseInt(c.moveToPos.y/h.TILE_SIZE),a=h.getTile(e,t);if(null===a||1===a[0])return}let e=c.x+Math.random(),t=c.y+Math.random();if(e+=20*Math.cos(c.rotation-Math.PI/2),t+=20*Math.sin(c.rotation-Math.PI/2),c.carriedObject.x=e,c.carriedObject.y=t,c.carriedObject.z=c.z,c.carriedObject.rotation=Math.random()*Math.PI*2,!(c.isAI||"brood"!==c.carriedObject.subtype||0!==c.z||c.team!==c.carriedObject.originalTeam||c.carriedObject.netData&&null!==c.carriedObject.netData.fakeTeam&&void 0!==c.carriedObject.netData.fakeTeam)&&(c.griefCount++,c.griefCount>=5)){c.griefCount=0;for(let e=0;e<h.clients.length;e++){let t=h.clients[e];if(t.player===c){console.log("Banned player for griefing."),h.banClient(t);break}}}h.addEntity(c.carriedObject),c.changeGrabbedObject(null)}else if("dirt"===c.carriedObject.subtype)if(c.z>=1&&c.moveToPos){let e=parseInt(c.moveToPos.x/h.TILE_SIZE),t=parseInt(c.moveToPos.y/h.TILE_SIZE),a=parseInt(c.x/h.TILE_SIZE),n=parseInt(c.y/h.TILE_SIZE),i=h.getTile(e,t);if(null!==i&&0===i[0]&&(e!==a||t!==n)){let a={x:e*h.TILE_SIZE+h.TILE_SIZE/2,y:t*h.TILE_SIZE+h.TILE_SIZE/2},n=h.quadtrees[1].retrieve({x:a.x,y:a.y,width:200,height:200}),i=!0;for(let e=0;e<n.length;e++){let t=n[e],r=h.TILE_SIZE;if("anthill"===t.subtype&&(r=1.8*h.TILE_SIZE),t!==c&&Math.distanceBetween(a,t)<r){i=!1;break}}i&&(h.updateTile(e,t,1),c.changeGrabbedObject(null))}}else c.changeGrabbedObject(null)}),c.changeGrabbedObject=(e=>{c.carriedObject=e;let t=null;c.carriedObject&&"brood"===c.carriedObject.subtype&&(t=c.carriedObject.netData.broodStage,e.team!==c.team&&(e.queen=c.queen),c.carriedObject.team!==c.team&&(null!==c.carriedObject.netData.fakeTeam&&void 0!==c.carriedObject.netData.fakeTeam||(c.carriedObject.netData.fakeTeam=c.carriedObject.team))),c.carriedObject&&(c.carriedObject.team=c.team,c.carriedObject.moveToPos=null),c.sendRPC("changeGrabbedObject",c.carriedObject?{subtype:c.carriedObject.subtype,data:t,netData:c.carriedObject.netData,size:c.carriedObject.width}:null),e&&e.valid&&e.remove(),h.teamData[c.team]&&h.teamData[c.team].isAI&&c.aiReturnPos&&!c.carriedObject&&(c.pathTo(c.aiReturnPos,35,!1),c.aiReturnPos=null)}),c.kill=(()=>{if(h.dismissFollowers(c),c.leader&&c.leader.followers&&c.leader.followers.length)for(let e=0;e<c.leader.followers.length;e++){let t=c.leader.followers.length;if(c===t){c.leader.followers.splice(e,1);break}}if(c.dropGrabbedObject(),c.netData.alive=!1,c.sendRPC("kill",!1),"ant_queen"===c.subtype){if(h.teamData[u]&&h.teamData[u].queens)for(let e=0;e<h.teamData[u].queens.length;e++){if(h.teamData[u].queens[e]===c){h.teamData[u].queens.splice(e,1);break}}let e={},t=0;for(let a=0;a<h.entities.length;a++){let n=h.entities[a];"ant_queen"===n.subtype&&n.valid&&n.netData.alive&&!e[n.team]&&(e[n.team]=!0,t++)}t<=1?h.endGame():e[c.team]||h.killTeam(c.team)}else if("ant_worker"===c.subtype&&c.queen&&c.queen.birthCount>12){if(h.teamData[c.team]&&h.teamData[c.team].isAI){let e=h.getAvailableFollowers(c,!0);for(let t=0;t<e.length;t++){let a=e[t];!a.carriedObject&&Math.random()>.5&&(a.pathTo(c),a.dropGrabbedObject())}}}else if("spider"===c.subtype){let e=6;for(let t=0;t<e;t++){let e=2*Math.PI*Math.random(),t=15+50*Math.random();h.createObject("food",c.x+Math.cos(e)*t,c.y+Math.sin(e)*t,c.z,45,45,-1)}for(let e=0;e<3;e++){let e=2*Math.PI*Math.random(),t=15+50*Math.random();h.createObject("food",c.x+Math.cos(e)*t,c.y+Math.sin(e)*t,c.z,45,45,-1,{superFood:!0})}}else if("bug"===c.subtype||"beetle"===e)if(c.netData&&"centipede"===c.netData.bugType){if("head"===c.netData.centipedeType){let e=s/120,t=1+Math.round(3*e);for(let e=0;e<t;e++){let e=2*Math.PI*Math.random(),t=15+40*Math.random();h.createObject("food",c.x+Math.cos(e)*t,c.y+Math.sin(e)*t,c.z,45,45,-1,{superFood:!0})}}else if(Math.random()>.85)if(Math.random()>.95)for(let e=0;e<1;e++){let e=2*Math.PI*Math.random(),t=15+40*Math.random();h.createObject("food",c.x+Math.cos(e)*t,c.y+Math.sin(e)*t,c.z,45,45,-1,{superFood:!0})}else for(let e=0;e<1;e++){let e=2*Math.PI*Math.random(),t=15+40*Math.random();h.createObject("food",c.x+Math.cos(e)*t,c.y+Math.sin(e)*t,c.z,45,45,-1)}}else{let e=6;for(let t=0;t<e;t++){let e=2*Math.PI*Math.random(),t=15+50*Math.random();h.createObject("food",c.x+Math.cos(e)*t,c.y+Math.sin(e)*t,c.z,45,45,-1)}}}),c.onRemove=(()=>{h.dismissFollowers(c)}),c}}).call(this,e("_process"))},{"../tilefinder":36,_process:4,pathfinding:9}],33:[function(e,t,a){t.exports=function(e,t,a,n,i,r,o,s){const l=this;s||(s={}),"rock"===e&&(s.rockType=Math.floor(4*Math.random())),"stick"===e&&(s.stickType=Math.floor(4*Math.random())),"anthill"===e&&(s.anthillSize=0);let u=l.createEntity("object",e,t,a,n,i,r,o,s);u.collisionLayer=2,"anthill"===e?(u.radius=0,l.teamData[o]&&(l.teamData[o].anthill=u)):"brood"===e?(u.netData.broodStage=0,u.matureTime=5,u.radius=12,u.rotation=Math.random()*Math.PI*2):"aphid"===e?(u.radius=12,u.rotation=Math.random()*Math.PI*2):"rock"===e?(u.radius=i/4,u.rotation=Math.random()*Math.PI*2,u.collisionLayer=1,u.static=!0):"plant"===e?(u.radius=i/12,u.rotation=Math.random()*Math.PI*2,u.collisionLayer=1,u.static=!0):"stick"===e?(u.radius=0,u.rotation=Math.random()*Math.PI*2,u.collisionLayer=4,u.static=!0):(u.radius=12,u.rotation=Math.random()*Math.PI*2),u.originalTeam=o,u.spoilage=0;let d=0,h=null,c=0,p=0,f=u.tick;if(u.tick=(()=>{if(u.moveToPos&&u.moveToPos.z===u.z){let e=Math.distanceBetween(u,u.moveToPos),t=Math.angleBetween(u,u.moveToPos);u.rotation=t+Math.PI/2,u.dx+=3*Math.cos(t),u.dy+=3*Math.sin(t),e<=(u.moveToPos.moveToDist?u.moveToPos.moveToDist:30)&&(u.moveToPos=null)}if("food"===u.subtype||"brood"===u.subtype)if(d<=0){if(d=125,1===u.z){let e=parseInt(u.x/l.TILE_SIZE),t=parseInt(u.y/l.TILE_SIZE),a=l.getTile(e,t)[1],n=!1;if("food"===u.subtype&&0!==a?n=!0:"brood"===u.subtype&&1!==a&&(n=!0),n){if("brood"===u.subtype?u.tickBroodMaturing(.25):u.spoilage+=.075,u.z>=1&&-1!==u.team&&l.getModifiedTime()>p){let e=l.getNearbyWorker(u);e?(e.target=u,e.setAIState("moveobject"),p=l.getModifiedTime()+18e3):p=l.getModifiedTime()+6e3}}else u.spoilage-=.1,-1!==u.team&&l.increaseTileUsage(e,t),u.tickBroodMaturing(1)}else 0===u.z&&"brood"===u.subtype?u.spoilage+=.2:0===u.z&&"food"===u.subtype&&(u.spoilage+=.025);u.spoilage>=1?u.remove():u.spoilage<0&&(u.spoilage=0)}else d--;if("aphid"===u.subtype)if(d<=0){if(d=850,!h||!h.valid||h.z!==u.z||Math.distanceBetween(u,h)>=200){let e=l.quadtrees[u.z].retrieve({x:u.x,y:u.y,width:1e3,height:1e3}),t=null,a=1e4;for(let n=0;n<e.length;n++){let i=e[n],r=Math.distanceBetween(u,i);"plant"===i.subtype&&r<a&&(t=i,a=r)}if(t&&(u.moveToPos={x:t.x,y:t.y,z:t.z,moveToDist:1.4*t.radius}),t&&a<=5*t.radius){let e=15,t=u.rotation+Math.PI/2;l.getModifiedTime()-l.roundStartTime>18e4&&++c>=8?(c=0,h=l.createObject("food",u.x+Math.cos(t)*e,u.y+Math.sin(t)*e,0,45,45,-1,{superFood:!0})):h=l.createObject("food",u.x+Math.cos(t)*e,u.y+Math.sin(t)*e,0,45,45,-1)}}}else d--;"brood"===u.subtype&&1===u.netData.broodStage&&(u.checkRequestTask(),u.energy<=0?u.remove():(u.energy>100&&(u.energy=100),u.energy-=.02,u.energy<=60&&!u.netData.hungry&&u.setHungry(!0))),u.dx*=.5,u.dy*=.5,f()}),"rock"!==e&&"plant"!==e&&"stick"!==e||delete u.tick,"rock"===e||"plant"===e){let e=Math.floor(u.x/l.TILE_SIZE),t=Math.floor(u.y/l.TILE_SIZE),a=Math.floor(u.width/l.TILE_SIZE);for(let n=-a;n<a;n++)for(let i=-a;i<a;i++){let a=e+n,r=t+i;if(a>=0&&r>=0&&a<l.MAP_SIZE&&r<l.MAP_SIZE){Math.distanceBetween(u,{x:a*l.TILE_SIZE+l.TILE_SIZE/2,y:r*l.TILE_SIZE+l.TILE_SIZE/2})<=1.2*u.radius+1.2*l.TILE_SIZE&&l.tileGrids[0].setWalkableAt(a,r,!1)}}}u.tickBroodMaturing=(e=>{if(u.matureTime>0)u.matureTime-=e;else if(u.netData.broodStage<1)u.matureBroodStage();else if("brood"===u.subtype&&u.matureTime<=0&&u.netData.broodStage>=2){if(u.remove(),u.queen&&(u.queen.birthCount||(u.queen.birthCount=0),u.queen.birthCount++),"queen"===u.broodType){l.createInsect("ant_queen",u.x+Math.random(),u.y+Math.random(),u.z,70,70,u.team,{newQueen:!0}).anthill=u.queen.anthill}else if(u.netData.isSuper){let e=80;l.teamData[u.team]&&(l.teamData[u.team].majorCount++,l.teamData[u.team].majorCount>=4&&(e=110,l.teamData[u.team].majorCount=0)),l.createInsect("ant_worker",u.x+Math.random(),u.y+Math.random(),u.z,e,e,u.team,{soldier:!0,fakeTeam:u.netData.fakeTeam}).queen=u.queen}else{l.createInsect("ant_worker",u.x+Math.random(),u.y+Math.random(),u.z,65,65,u.team,{fakeTeam:u.netData.fakeTeam}).queen=u.queen}l.teamData[u.team]&&u.queen&&u.queen.anthill&&u.queen.anthill.netData.anthillSize<10&&u.queen.anthill.increaseAnthillSize()}}),u.matureBroodStage=(()=>{u.netData.broodStage++,u.matureTime=5,u.sendRPC("changeBroodStage",u.netData.broodStage)});let g=0;return u.increaseAnthillSize=(()=>{++g>2&&(g=0,u.netData.anthillSize++,u.sendRPC("changeAnthillSize",u.netData.anthillSize))}),u.eat=(e=>{u.hasEaten=!0,u.energy=100,u.netData.health=100,u.setHungry(!1),e&&e.netData.superFood&&(u.netData.isSuper=!0,u.superTime=l.getModifiedTime()),"brood"===u.subtype&&u.matureBroodStage()}),u}},{}],34:[function(e,t,a){function n(e,t,a,n){this.max_objects=t||10,this.max_levels=a||4,this.level=n||0,this.bounds=e,this.objects=[],this.nodes=[]}n.prototype.split=function(){var e=this.level+1,t=Math.round(this.bounds.width/2),a=Math.round(this.bounds.height/2),i=Math.round(this.bounds.x),r=Math.round(this.bounds.y);this.nodes[0]=new n({x:i+t,y:r,width:t,height:a},this.max_objects,this.max_levels,e),this.nodes[1]=new n({x:i,y:r,width:t,height:a},this.max_objects,this.max_levels,e),this.nodes[2]=new n({x:i,y:r+a,width:t,height:a},this.max_objects,this.max_levels,e),this.nodes[3]=new n({x:i+t,y:r+a,width:t,height:a},this.max_objects,this.max_levels,e)},n.prototype.getIndex=function(e){var t=-1,a=this.bounds.x+this.bounds.width/2,n=this.bounds.y+this.bounds.height/2,i=e.y<n&&e.y+e.height<n,r=e.y>n;return e.x<a&&e.x+e.width<a?i?t=1:r&&(t=2):e.x>a&&(i?t=0:r&&(t=3)),t},n.prototype.insert=function(e){var t,a=0;if(void 0===this.nodes[0]||-1===(t=this.getIndex(e))){if(this.objects.push(e),this.objects.length>this.max_objects&&this.level<this.max_levels)for(void 0===this.nodes[0]&&this.split();a<this.objects.length;)-1!==(t=this.getIndex(this.objects[a]))?this.nodes[t].insert(this.objects.splice(a,1)[0]):a+=1}else this.nodes[t].insert(e)},n.prototype.retrieve=function(e,t){t||(e.x-=e.width/2,e.y-=e.height/2);var a=this.getIndex(e),n=this.objects;if(void 0!==this.nodes[0])if(-1!==a)n=n.concat(this.nodes[a].retrieve(e,!0));else for(var i=0;i<this.nodes.length;i+=1)n=n.concat(this.nodes[i].retrieve(e,!0));return n},n.prototype.clear=function(){this.objects=[];for(var e=0;e<this.nodes.length;e+=1)void 0!==this.nodes[e]&&this.nodes[e].clear();this.nodes=[]},t.exports=n},{}],35:[function(e,t,a){(function(a,n,i,r,o,s,l,u){const d=e("noisejs"),h=e("pathfinding"),c=e("./quadtree"),p=e("./tutorial"),f=e("./entities/entity"),g=e("./entities/object"),m=e("./entities/insect"),y=9e4;function b(e,t,n,r,o,s,l,b){const v=this;v.TILE_SIZE=64,v.MAP_SIZE=Math.round(6e3/v.TILE_SIZE);let w=1e3/15,x=125,I=w;v.changeTimestep=(e=>{if(e){x=50;let e=I/(w=1e3/120);v.getModifiedTime=function(){return Date.now()+(Date.now()-v.roundStartTime)*e}}else x=125,I=w=1e3/15,v.getModifiedTime=function(){return Date.now()}}),v.changeTimestep(!1),v.serverId=n,l||(l={}),b.isTutorial&&(v.tutorial=new p(this));let T=4,M=18e4,k=12e4;v.roundStartTime=Date.now(),v.gamemode={type:"domination"},v.lastEntityId=0,v.clients=[],v.entities=[];let D=[];v.tileGrids=null;let S=!1;v.teamData={};let A=0,E=0,_=!1,P=v.getModifiedTime()+M,C=!1,L={type:"lobby",endTime:Date.now()+y};v.quadtrees=[];for(let e=0;e<2;e++)v.quadtrees.push(new c({x:0,y:0,width:v.MAP_SIZE*v.TILE_SIZE,height:v.MAP_SIZE*v.TILE_SIZE}));v.createEntity=f.bind(this),v.createObject=g.bind(this),v.createInsect=m.bind(this);let O=Math.round(1e4*Math.random());v.getGameId=(()=>O),v.getClients=(()=>v.clients),v.getServerInviteToken=(()=>s),v.isPrivate=(()=>l.privateGame),v.getPlayerCount=(()=>v.clients.length),v.hasOpenSlot=(e=>{if("lobby"===v.getRoundState().type)return!0;{let t=0,a=Object.keys(v.teamData).length;for(let n=0;n<a;n++){let a=v.teamData[n];a&&!a.locked&&!a.dead&&a.queen&&a.queen.valid&&a.queen.netData.alive&&a.clients.length<T&&(!e||a.aliveAntCount>a.clients.length||a.queen.newQueen)&&t++}return t>0}}),v.createTeam=(()=>{let e=v.teamData[A]={id:A,locked:!1,queens:[],clients:[],spawnQueue:[],majorCount:0,isAI:!1,dataAI:{}};return A++,e}),v.getNearbyWorker=(e=>{let t=v.getAvailableFollowers(e);if(e&&t&&t.length){for(let a=0;a<t.length;a++){let n=t[a];if(e.z===n.z&&Math.distanceBetween(e,n)<=2e3&&"idle"===n.aiState&&!n.carriedObject&&n.valid&&n.netData.alive&&(!n.path||!n.path.length))return n}return null}}),v.getAvailableFollowers=((e,t)=>{if(e&&v.teamData[e.team]){let a=v.quadtrees[e.z].retrieve({x:e.x,y:e.y,width:1500,height:1500}),n=[];for(let t=0;t<a.length;t++){let i=a[t];i.isAI&&"ant_worker"===i.subtype&&i.valid&&i.netData&&i.netData.alive&&i.team===e.team&&!i.leader&&"defend"!==i.aiState&&n.push(i)}if(t){let t=e.z;t=0===t?1:0,a=v.quadtrees[t].retrieve({x:e.x,y:e.y,width:1500,height:1500});for(let t=0;t<a.length;t++){let i=a[t],r=Math.distanceBetween(e,i);i.isAI&&"ant_worker"===i.subtype&&i.valid&&r<1e3&&i.netData&&i.netData.alive&&i.team===e.team&&!i.leader&&"defend"!==i.aiState&&n.push(i)}}return n.sort((t,a)=>{return Math.distanceBetween(e,t)-Math.distanceBetween(e,a)}),n}return[]}),v.getClosestAnthill=((e,t,a)=>{let n=[];for(let a=0;a<v.entities.length;a++){let i=v.entities[a];if("anthill"===i.subtype&&(null===t||void 0===t||i.team===t)){let t=Math.distanceBetween(e,i);n.push({anthill:i,dist:t})}}if(n.sort((e,t)=>e.dist<t.dist?-1:e.dist>t.dist?1:0),a&&a.tilesPathTo&&null!==a.z&&void 0!==a.z)for(let e=0;e<n.length;e++){let t=n[e];if(a.tilesPathTo(t.anthill,a.z,!0,!0,!0))break;n.shift(),e--}return n&&n.length?n[0].anthill:null}),v.addEntity=(e=>{e.valid=!0,v.sendMessage("createEntity",e.getCreateData()),v.entities.push(e)}),v.onClientConnected=(t=>{t.clientId=E++,t.team=null,t.lastAction=Date.now(),v.clients.push(t),t.playStartTime=Date.now(),t.connected=!0,v.running||v.startLoop(),t.on("move",e=>{t.player&&t.player.valid&&(t.lastAction=Date.now(),e&&e.x&&e.y&&(t.player.moveToPos={x:parseFloat(e.x),y:parseFloat(e.y),action:e.action}),t.player.target=null,t.player.netData.digging&&t.player.stopDig())}),t.on("switchPlayer",e=>{if(t.player&&t.player.valid&&t.player.netData.alive)for(let a=0;a<v.entities.length;a++){let n=v.entities[a];if(n.id===e){n.valid&&n.netData.alive&&n.isAI&&n.team===t.player.team&&n.z===t.player.z&&Math.distanceBetween(t.player,n)<=2e3&&("ant_worker"===n.subtype||"ant_queen"===n.subtype)&&v.switchPlayer(t,n);break}}}),t.on("tutorialContinue",()=>{v.tutorial&&v.tutorial.continue()}),t.on("followPlayer",e=>{if(t.player&&t.player.valid&&t.player.netData.alive)for(let a=0;a<v.entities.length;a++){let n=v.entities[a];if(n.id===e){n.valid&&n.netData.alive&&n.isAI&&n.team===t.player.team&&n.z===t.player.z&&Math.distanceBetween(t.player,n)<=2e3&&"ant_worker"===n.subtype&&!n.leader&&n.setFollow(t.player);break}}}),t.on("lobbyReady",()=>{t.ready||t.player||(t.ready=!0,"lobby"!==L.type&&(null!==t.team&&void 0!==t.team||v.joinSmallestTeam(t,!0),v.teamData[t.team]&&!v.teamData[t.team].dead&&v.teamData[t.team].queen&&v.teamData[t.team].queen.valid&&v.teamData[t.team].queen.netData.alive?v.addClientToSpawnQueue(t):!v.teamData[t.team]||v.teamData[t.team].dead||v.teamData[t.team].queen?(t.emit("growl","This team has already died, please pick another."),t.ready=!1):v.createTeamQueen(t.team,t)),v.sendLobbyUpdate())}),t.on("lobbyNewTeam",()=>{if(Object.keys(v.teamData).length<8&&"coop"!==v.gamemode.type){let e=v.createTeam();v.setClientTeam(t,e.id),v.sendLobbyUpdate()}}),t.on("lobbyJoinTeam",e=>{null!==e&&void 0!==e&&t.team!==e&&v.teamData[e]&&v.teamData[e].clients.length<T&&(v.setClientTeam(t,e),v.sendLobbyUpdate())}),t.on("lobbyLockTeam",()=>{null!==t.team&&void 0!==t.team&&t.team>=2&&v.teamData[t.team].clients[0]===t&&(v.teamData[t.team].locked=!v.teamData[t.team].locked,v.sendLobbyUpdate())}),t.on("command",e=>{if(t.player&&t.player.valid&&t.player.netData&&t.player.netData.alive)if("+5 Follow"===e){let e=v.getAvailableFollowers(t.player),a=e.length;a>5&&(a=5);for(let n=0;n<a;n++){let a=e[n];Math.distanceBetween(t.player,a)<800&&t.player.z===a.z&&(a.leader?a.setAIState("follow"):a.setFollow(t.player))}}else if("+1 Follow"===e){let e=v.getAvailableFollowers(t.player);for(let a=0;a<e.length;a++){let n=e[a];if("follow"!==n.aiState&&Math.distanceBetween(t.player,n)<800&&t.player.z===n.z){n.leader?n.setAIState("follow"):n.setFollow(t.player);break}}}else if("Dismiss"===e)v.dismissFollowers(t.player);else if("Defend"===e){if(t.player.followers&&t.player.followers.length){let e=[];for(let a=0;a<t.player.followers.length;a++){let n=t.player.followers[a];e.push(n)}v.dismissFollowers(t.player);for(let a=0;a<e.length;a++){let n=e[a];n.setAIState("defend"),n.defendTarget={x:t.player.x,y:t.player.y,z:t.player.z},n.defendRadius=15*e.length,n.defendRadius<50&&(n.defendRadius=50),n.defendRadius>400&&(n.defendRadius=400),n.pathTo(n.defendTarget,35)}}}else if("Stop Defend"===e){let e=v.quadtrees[t.player.z].retrieve({x:t.player.x,y:t.player.y,width:1500,height:1500});for(let a=0;a<e.length;a++){let n=e[a];n.isAI&&"ant_worker"===n.subtype&&n.valid&&n.netData&&n.netData.alive&&n.team===t.player.team&&!n.leader&&"defend"===n.aiState&&n.setFollow(t.player)}}}),t.on("chat",a=>{if(a&&a.length&&a.length<=500)if(a.startsWith("/")&&t.user&&t.user.isDev){if(a.startsWith("/banip")){let n=a.replace("/banip","").trim();console.log(t.realAddress+": Banned IP:",n),e.banList||(e.banList=[]),e.banList.push(n)}else if(a.startsWith("/ban")){let e=a.replace("/ban","").trim(),n=v.getClientByName(e);n?v.banClient(n):t.emit("growl",'Player with name "'+e+'" not found.')}else if(a.startsWith("/kick")){let e=a.replace("/kick","").trim(),n=v.getClientByName(e);n?(console.log(t.realAddress+": Kicked player:",n.name,n.realAddress),v.sendMessage("growl",'Player "'+e+'" has been kicked.'),n.disconnect()):t.emit("growl",'Player with name "'+e+'" not found.')}else if(a.startsWith("/slay")){let e=a.replace("/slay","").trim(),n=v.getClientByName(e);n&&n.player&&n.player.valid&&n.player.netData.alive?(console.log(t.realAddress+": Slayed player:",n.name,n.realAddress),v.sendMessage("growl",'Player "'+e+'" has been slain.'),n.player.kill()):t.emit("growl",'Player with name "'+e+'" not found.')}else if(a.startsWith("/spider")){let e=null;for(let a=0;a<v.entities.length;a++){let n=v.entities[a];if(n&&n.valid&&n!==t.player&&n.netData.alive&&"spider"===n.subtype){e=n;break}}e?v.switchPlayer(t,e):t.emit("growl","No spiders found.")}else if(a.startsWith("/centipede")){let e=null;for(let a=0;a<v.entities.length;a++){let n=v.entities[a];if(n&&n.valid&&n!==t.player&&n.netData.alive&&"bug"===n.subtype&&n.netData&&"centipede"===n.netData.bugType&&"head"===n.netData.centipedeType){e=n;break}}e?v.switchPlayer(t,e):t.emit("growl","No centipedes found.")}else if(a.startsWith("/changez")){if(t.player&&t.player.netData.alive&&(0===t.player.z?t.player.z=1:t.player.z=0,1===t.player.z)){let e=Math.floor(t.player.x/v.TILE_SIZE),a=Math.floor(t.player.y/v.TILE_SIZE);v.getTile(e,a)[0]&&v.updateTile(e,a,0)}}else if(a.startsWith("/kill"))t.player&&t.player.netData.alive&&t.player.damage(1e3);else if(a.startsWith("/toggleai")){let e=Object.keys(v.teamData);for(let t=0;t<e.length;t++){let a=v.teamData[e[t]];a.isAI=!a.isAI}v.sendMessage("growl","AI has been toggled.")}else if(a.startsWith("/spectate")){let e=a.replace("/spectate","").trim();if(e){let a=v.getClientByName(e);a?v.setPlayerSpectate(a):t.emit("growl",'Player with name "'+e+'" not found.')}else v.setPlayerSpectate(t)}else if(a.startsWith("/spawn")){if(t.player&&t.player.valid&&t.player.netData.alive){let e=a.replace("/spawn","").trim().split(" ");if(e&&e.length>=1)try{if("queen"===e[0]){let e=v.createInsect("ant_queen",t.player.x+Math.random(),t.player.y+Math.random(),t.player.z,70,70,t.player.team);e.anthill=v.teamData[t.player.team].anthill,v.switchPlayer(t,e)}else if("spider"===e[0]){let e=v.getEdgePosition();v.createInsect("spider",e.x,e.y,0,120,120,-1)}else if("centipede"===e[0]){let e=Math.round(80+100*Math.random()),t=v.getEdgePosition();v.createInsect("bug",t.x,t.y,0,e,e,-1,{bugType:"centipede",centipedeType:"head"})}else if("bug"===e[0]){let e=v.getEdgePosition();Math.random()<=.5?v.createInsect("bug",e.x,e.y,0,100,100,-1):v.createInsect("beetle",e.x,e.y,0,145,145,-1)}}catch(e){t.emit("growl","Failed to use spawn command.")}else t.emit("growl","Invalid spawn parameters.")}}else if(a.startsWith("/reviveteam")){let e=a.replace("/reviveteam","").trim().split(" ");if(e&&e.length>=1)try{let a=parseInt(e[0]);v.teamData[a].dead=!1,v.teamData[a].queen=null,t.emit("growl","Team "+v.getTeamString(a)+" has been revived.")}catch(e){t.emit("growl","Failed to use spawn command.")}}else if(a.startsWith("/timestep")){let e=a.replace("/timestep","").trim().split(" ");if(e&&e.length>=1)try{v.changeTimestep("1"==e[0]),t.emit("growl","Timestep updated: "+e[0])}catch(e){t.emit("growl","Failed to use timestep command.")}}else if(a.startsWith("/forcestart"))"lobby"===L.type&&(v.startRound(),v.sendMessage("growl","Round force started."));else if(a.startsWith("/gamemode")){let e=a.replace("/gamemode","").trim();v.updateGamemode(e),v.sendMessage("growl","Gamemode updated: "+e)}}else t.player&&t.player.netData.alive?(v.sendMessage("chat",{id:t.player.id,name:t.name,message:a}),console.log("GAME CHAT => "+t.name+": "+a)):"lobby"===L.type&&(v.sendMessage("chat",{name:t.name,message:a}),console.log("LOBBY CHAT => "+t.name+": "+a))}),t.emit("tileData",D),v.entities.forEach(e=>{t.emit("createEntity",e.getCreateData())}),t.emit("updateNight",{night:_,force:!0}),v.sendLobbyUpdate(),v.sendMessage("chat",{message:t.name+" has joined the game."})}),v.setPlayerSpectate=(e=>{e.hasSpawned=!0,e.spectating=!0,v.switchPlayer(e,null),e.emit("setPlayer",{spectator:!0}),b.isSingleplayer&&v.teamData[e.team]&&(v.teamData[e.team].isAI=!0)}),v.getTeamString=(e=>0===e?"BLACK":1===e?"RED":2===e?"GREEN":3===e?"BLUE":4===e?"YELLOW":5===e?"ORANGE":6===e?"PINK":7===e?"CYAN":"NONE"),v.banClient=(t=>{console.log("Banned player:",t.name,t.realAddress),v.sendMessage("growl",'Player "'+t.name+'" has been banned.'),e.banList||(e.banList=[]),e.banList.push(t.realAddress),t.disconnect()}),v.setClientTeam=((e,t)=>{if(null!==e.team&&void 0!==e.team&&v.teamData[e.team]){for(let t=0;t<v.teamData[e.team].clients.length;t++){if(v.teamData[e.team].clients[t]===e){v.teamData[e.team].clients.splice(t,1);break}}v.teamData[e.team].clients.length<=0&&(v.teamData[e.team].locked=!1)}e.team=t,null!==e.team&&void 0!==e.team&&v.teamData[e.team]&&v.teamData[e.team].clients.push(e)}),v.joinSmallestTeam=((e,t)=>{if(Object.keys(v.teamData).length){let a=Object.keys(v.teamData).length,n=null,i=1e3;for(let e=0;e<a;e++){let a=v.teamData[e];!a.locked&&!a.dead&&a.clients.length<i&&(t||a.queen&&a.queen.valid&&a.queen.netData.alive)&&(n=a.id,i=a.clients.length)}null!==n&&(v.setClientTeam(e,n),t||(e.emit("setPlayer",{id:v.teamData[e.team].queen.id,canControl:!1}),e.emit("showMenu",null),v.teamData[e.team].spawnQueue.push(e)))}}),v.addClientToSpawnQueue=(e=>{!e.player&&v.teamData[e.team]?(e.hasSpawned=!0,e.emit("setPlayer",{id:v.teamData[e.team].queen.id,canControl:!1}),v.teamData[e.team].spawnQueue.push(e)):b.skipGameLobby}),v.createTeamQueen=((e,t,n)=>{let i=v.getPositionAwayFromEdge(1e3);"local"===a.env.NODE_ENV||"coop"===v.gamemode.type?(i.x=v.MAP_SIZE*v.TILE_SIZE/2+Math.random(),i.y=v.MAP_SIZE*v.TILE_SIZE/2+Math.random()):void 0!==n&&null!==n&&(i.x=v.MAP_SIZE*v.TILE_SIZE/2+2e3*Math.cos(n),i.y=v.MAP_SIZE*v.TILE_SIZE/2+2e3*Math.sin(n));let r=v.createInsect("ant_queen",i.x,i.y,0,70,70,e,{newQueen:!0});r.rotation=Math.random()*(2*Math.PI),t?(t.hasSpawned=!0,v.switchPlayer(t,r)):r.isAI=!0}),v.startRound=(()=>{v.updateRoundState({type:"playing"}),v.resetNight();for(let e=0;e<v.clients.length;e++){let t=v.clients[e];null!==t.team&&void 0!==t.team||v.joinSmallestTeam(t,!0)}let e=Object.keys(v.teamData).length;if(b.isSingleplayer&&!b.isTutorial)for(let t=0;t<e;t++){let e=v.teamData[t];t>0&&(e.isAI=!0)}let t=0;for(let a=0;a<e;a++){let e=v.teamData[a];(e.clients.length>0||e.isAI)&&t++}if(t<=1&&"coop"!==v.gamemode.type){for(let e=0;e<Math.floor(v.clients.length/2);e++){let t=v.clients[e];t&&v.joinSmallestTeam(t,!0)}b.skipGameLobby||v.sendMessage("growl","Teams have been balanced.")}let a=0;for(let t=0;t<e;t++){let e=v.teamData[t];(e.clients.length>0||e.isAI)&&a++}let n=[];for(let e=0;e<a;e++)n.push(2*Math.PI/a*e);n=function(e){let t,a,n=e.length;for(;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e}(n);let i=Math.random()*(2*Math.PI);for(let t=0;t<e;t++){let e=v.teamData[t];if(e&&e.clients&&(e.clients.length||e.isAI)){e.clients.sort((e,t)=>{let a=e.user?e.user.xp:0;return(t.user?t.user.xp:0)-a});let t=e.clients[0];if((!t||!t.user||t.user.xp<=0)&&(t=e.clients[parseInt((e.clients.length-1)*Math.random())]),t||e.isAI){let a=Math.random()*(2*Math.PI);n&&n.length&&(a=n.shift()),v.createTeamQueen(e.id,t,i+a)}}}for(let e=0;e<v.clients.length;e++){let t=v.clients[e];t.lastAction=Date.now(),v.addClientToSpawnQueue(t)}v.roundStartTime=Date.now(),v.sendLobbyUpdate(),v.resetNight()}),v.getRoundState=(()=>L),v.updateRoundState=(e=>{L=e}),v.sendLobbyUpdate=(()=>{let e=v.getLobbyData();for(let t=0;t<v.clients.length;t++){let a=v.clients[t];a.hasSpawned?a.emit("showMenu",null):(e.clientId=a.clientId,a.emit("showMenu",e))}});let q=2;"local"===a.env.NODE_ENV&&(q=1),v.getLobbyData=(()=>{let e={menu:"lobby",privateGame:l.privateGame,startTimer:L.endTime-Date.now(),shareLinkToken:o+"-"+s,teams:[],players:[]},t=Object.keys(v.teamData);for(let a=0;a<t.length;a++){let t=v.teamData[a];e.teams.push({id:t.id,name:v.getTeamString(t.id),players:t.clients.length,maxPlayers:T,locked:t.locked||t.dead})}let a=!0;for(let t=0;t<v.clients.length;t++){let n=v.clients[t];e.players.push({clientId:n.clientId,name:n.name+" ("+v.getTeamString(n.team)+")",team:n.team,ready:n.ready,xp:n.user?n.user.xp:0,canLock:null!==n.team&&void 0!==n.team&&n.team>=2&&v.teamData[n.team]&&v.teamData[n.team].clients&&v.teamData[n.team].clients[0]===n}),n.ready||(a=!1)}return"lobby"===L.type&&v.clients.length>=q&&a&&v.startRound(),e}),v.getClientByName=(e=>{for(let t=0;t<v.clients.length;t++){let a=v.clients[t];if(a.name===e)return a}return null}),v.dismissFollowers=((e,t)=>{if(e.followers){for(let a=0;a<e.followers.length;a++){let n=e.followers[a];n.setFollow(null),t&&n.queen&&n.queen.anthill&&n.pathTo({x:n.queen.anthill.x,y:n.queen.anthill.y,z:1,returningHome:!0},35,!0)}e.followers=[]}}),v.switchPlayer=((e,t)=>{e.player&&(e.player.netData.name=null,e.player.netData.isDev=!1,e.player.netData.settings=null,e.player.isAI=!0,e.player.currentPlayer=null,v.dismissFollowers(e.player)),t&&t.team!==e.team&&v.setClientTeam(e,t.team),e.player=t,e.player&&(e.player.griefCount=0,e.player.netData.isDev=e.user&&e.user.isDev,e.player.netData.settings=e.user&&e.user.settings?e.user.settings:null,e.player.netData.name=e.name,e.player.isAI=!1,e.player.currentPlayer=e,e.emit("setPlayer",{id:e.player.id,canControl:!0}))}),v.killTeam=(e=>{let t=v.teamData[e];if(!t.dead){t.dead=!0;for(let t=0;t<v.entities.length;t++){let a=v.entities[t];"insect"===a.type&&a.team===e&&a.kill()}let a=[],n=Date.now();for(let t=0;t<v.clients.length;t++){let i=v.clients[t];if(i.team===e){let e=50,t=5;if(i.playStartTime){let a=Math.abs(n-i.playStartTime)/1e3;a/=60,(a=Math.abs(a))>20&&(a=20),e+=Math.round(15*a),t+=Math.round(2*a)}(l.privateGame||b.isSingleplayer)&&(e=0,t=0),i.spectating||(i.emit("roundEnd",{message:"YOUR QUEEN WAS KILLED OR STARVED",awards:{xp:e,coins:t},lastXp:i.user?i.user.xp:0,isUser:i.user&&i.user.session}),i.user&&i.user.session&&(e>0||t>0)&&(i.user.xp+=e,a.push({session:i.user.session,xp:e,coins:t})))}}a&&a.length&&r("awardUsers",a)}}),v.endGame=(()=>{if(S)return;let e=Object.keys(v.teamData),t=null;for(let a=0;a<e.length;a++){let e=v.teamData[a];if(e.queen&&e.queen.valid&&e.queen.netData.alive){t=e.id;break}}if(S=!0,null!==t){let e=[],a=v.getTeamString(t)+" TEAM WINS",n=Date.now();for(let i=0;i<v.clients.length;i++){let r=v.clients[i],o=100,s=10;if(r.isWinner=r.team===t,r.isWinner&&(o=350,s=25),r.playStartTime){let e=Math.abs(n-r.playStartTime)/1e3;e/=60,(e=Math.abs(e))>20&&(e=20),r.isWinner?(o+=Math.round(30*e),s+=Math.round(4*e)):(o+=Math.round(15*e),s+=Math.round(2*e))}l.privateGame&&(o=0,s=0),r.emit("roundEnd",{roundActuallyEnded:!0,message:a,awards:{xp:o,coins:s},lastXp:r.user?r.user.xp:0,isUser:r.user&&r.user.session}),r.user&&r.user.session&&(o>0||s>0)&&(r.user.xp+=o,e.push({session:r.user.session,xp:o,coins:s}))}e&&e.length&&r("awardUsers",e)}else for(let e=0;e<v.clients.length;e++){let t=v.clients[e];t.isWinner=!1,t.emit("roundEnd",{roundActuallyEnded:!0,message:"ALL QUEENS ARE DEAD",isUser:t.user&&t.user.session})}setTimeout(()=>{v.resetGame()},12e3)}),v.onClientDisconnected=(e=>{for(let t=0;t<v.clients.length;t++){if(v.clients[t].id===e.id){v.clients.splice(t,1);break}}e.connected=!1,e.player&&e.player.valid&&v.switchPlayer(e,null),v.setClientTeam(e,null),"lobby"===L.type&&(v.sendLobbyUpdate(),v.sendMessage("chat",{message:e.name+" has left the game."})),v.clients.length<=0&&(v.running=!1)}),v.getTile=((e,t)=>e>=0&&t>=0&&e<v.MAP_SIZE&&t<v.MAP_SIZE?D[t][e]:[1,0,0]),v.getTileOrNull=((e,t)=>e>=0&&t>=0&&e<v.MAP_SIZE&&t<v.MAP_SIZE?D[t][e]:null),v.increaseTileUsage=((e,t)=>{let a=v.getTile(e,t);a&&(a[2]+=.002,a[2]>=1&&v.updateTile(e,t,a[0],.5))}),v.updateTile=((e,t,a,n)=>{if(e>=0&&t>=0&&e<v.MAP_SIZE&&t<v.MAP_SIZE){D[t][e][0]=a,v.tileGrids[1].setWalkableAt(e,t,0===D[t][e][0]);let i={x:e,y:t,val:a};null!==n&&void 0!==n&&(v.setTileMoisture(e,t,n),i.m=D[t][e][1]),v.sendMessage("tileUpdate",i)}}),v.checkSpawnQueue=(e=>{if(e&&e.length)if(e[0].connected&&!e[0].player&&v.teamData[e[0].team])for(let t=0;t<v.entities.length;t++){let a=v.entities[t];if(("ant_worker"===a.subtype||"ant_queen"===a.subtype&&a.netData.newQueen)&&parseInt(a.team)===parseInt(e[0].team)&&a.isAI){let t=e.shift();v.switchPlayer(t,a);break}}else e.shift()}),v.spawnFoodPile=(()=>{let e={x:300+Math.random()*(v.MAP_SIZE*v.TILE_SIZE-600),y:300+Math.random()*(v.MAP_SIZE*v.TILE_SIZE-600)},t=!0;for(let a=0;a<v.entities.length;a++){let n=v.entities[a];if("anthill"===n.subtype&&Math.distanceBetween(e,n)<=400){t=!1;break}}if(t){let t=2+Math.round(4*Math.random());for(let a=0;a<t;a++){let t=2*Math.PI*Math.random(),a=15+50*Math.random();v.createObject("food",e.x+Math.cos(t)*a,e.y+Math.sin(t)*a,0,45,45,-1)}}}),v.lastSnapshot=Date.now(),v.tickSnapshot=(()=>{Date.now()-v.lastSnapshot>=x&&(v.lastSnapshot=Date.now(),v.sendSnapshot())}),v.tickTeamAI=(e=>{}),v.entityAISearch=((e,t,a)=>{a||(a=150);let n=e.rotation-Math.PI/2;n+=Math.random()*t-t/2,e.pathTo({x:e.x+Math.cos(n)*a,y:e.y+Math.sin(n)*a,z:e.z},null,null,!1,!0),e.path.length||(Math.random()>.5?n+=Math.PI/2:n-=Math.PI/2,e.pathTo({x:e.x+Math.cos(n)*a,y:e.y+Math.sin(n)*a,z:e.z},null,null,!1,!0),e.path.length||(e.pathTo({x:e.x+Math.cos(n)*a,y:e.y+Math.sin(n)*a,z:e.z},null,null,!1,!0),e.path.length||(n=Math.angleBetween(e,{x:v.MAP_SIZE*v.TILE_SIZE/2,y:v.MAP_SIZE*v.TILE_SIZE/2}),a=200,e.pathTo({x:e.x+Math.cos(n)*a,y:e.y+Math.sin(n)*a,z:e.z},null,null,!1,!1))))}),v.tickTeamAIEntity=(e=>{if(!(v.getModifiedTime()-e.lastAITeamThink>1e3))return;e.lastAITeamThink=v.getModifiedTime();v.teamData[e.team];switch(e.subtype){case"ant_queen":if(e.netData.newQueen)if(0===e.z){if(Math.random()>=.1){let t=Math.floor(e.x/v.TILE_SIZE),a=Math.floor(e.y/v.TILE_SIZE),n=v.getTileOrNull(t,a);n&&1===n[1]&&(!e.dataAI.lastAnthillCreationAttempt||v.getModifiedTime()-e.dataAI.lastAnthillCreationAttempt>1500)?(e.pathTo({x:e.x,y:e.y,z:e.z},null,!0,!0),e.dataAI.lastAnthillCreationAttempt=v.getModifiedTime()):v.entityAISearch(e,Math.PI/4)}}else if(Math.random()>=.8){let t=v.getClosestAnthill(e,null,e);t&&e.pathTo({x:t.x,y:t.y,z:0},null,!0,!0)}break;case"ant_worker":switch(v.getModifiedTime()-e.dataAI.lastRoleCheck>6e4&&((!e.firstAssignment||Math.random()>.5)&&(!e.dataAI.roleEncounters.nurse||e.dataAI.roleEncounters.nurse<2?e.dataAI.role="nurse":!e.dataAI.roleEncounters.digger||e.dataAI.roleEncounters.digger<1?e.dataAI.role="digger":e.dataAI.role="forager"),e.firstAssignment=!0,e.dataAI.greetList={},e.dataAI.roleEncounters={},e.dataAI.lastRoleCheck=v.getModifiedTime()),e.dataAI.role){case"forager":0===e.z?Math.random()>=.25&&v.entityAISearch(e,Math.PI/4):Math.random()>.8&&e.queen&&e.queen.anthill&&e.pathTo({x:e.queen.anthill.x+v.getRandomNumberBetween(-50,50),y:e.queen.anthill.y+v.getRandomNumberBetween(-50,50),z:0},null,!1,!1);break;case"nurse":0===e.z&&Math.random()>.8&&e.queen&&e.queen.anthill&&e.pathTo({x:e.queen.anthill.x+v.getRandomNumberBetween(-50,50),y:e.queen.anthill.y+v.getRandomNumberBetween(-50,50),z:1},null,!1,!1);break;case"digger":if(0===e.z)Math.random()>.2&&e.queen&&e.queen.anthill&&e.pathTo({x:e.queen.anthill.x+v.getRandomNumberBetween(-50,50),y:e.queen.anthill.y+v.getRandomNumberBetween(-50,50),z:1},null,!1,!1);else if(1===e.z)if(Math.random()>.75){let t=[];if(e.searchForTile(e.queen,(e,a)=>{let n=v.getTile(e.x,e.y);if(1===n[0]){let i=Math.distanceBetween(e,a);return t.push({node:e,tile:n,score:1-i}),t.length>=8}return!1},!0),t.sort((e,t)=>t.score-e.score),t.length){let a=t.length;a>4&&(a=4);let n=t[Math.floor(Math.random()*(a-1))].node,i=0,r=0;i=Math.random()>.5?v.TILE_SIZE-.4*v.TILE_SIZE:-v.TILE_SIZE+.4*v.TILE_SIZE,r=Math.random()>.5?v.TILE_SIZE-.4*v.TILE_SIZE:-v.TILE_SIZE+.4*v.TILE_SIZE,e.pathTo({x:n.x*v.TILE_SIZE+v.TILE_SIZE/2+i,y:n.y*v.TILE_SIZE+v.TILE_SIZE/2+r,z:1},35,!0),e.path.length&&(e.digTarget=n,e.setAIState("dig"))}}else Math.random()>=.1&&v.entityAISearch(e,Math.PI/4)}}}),v.getRandomNumberBetween=((e,t)=>Math.floor(Math.random()*(t-e+1)+e));let z=0,j=0;v.tick=(e=>{if("lobby"===L.type)return(L.endTime-Date.now()<=0&&v.clients.length>=2||Date.now()-v.roundStartTime>100&&b.skipGameLobby)&&v.startRound(),void v.tickSnapshot();if(v.tutorial&&(v.tutorial.tick(),v.tutorial.tutorialData&&v.tutorial.tutorialData.pause))return;if(j<=0){j=500;let e=0;for(let t=0;t<v.entities.length;t++){let a=v.entities[t];0===a.z&&"food"===a.subtype&&e++}if(e<8){let e=Object.keys(v.teamData).length,t=0;for(let a=0;a<e;a++){let e=v.teamData[a];e.queen&&e.queen.netData.alive&&t++}let a=Math.round(.5*t);a<1&&(a=1);for(let e=0;e<a;e++)v.spawnFoodPile()}}else j--;if(P-v.getModifiedTime()<=0){if(P=(_=!_)?v.getModifiedTime()+k:v.getModifiedTime()+M,v.sendMessage("updateNight",{night:_}),!C){C=!0;let e=Object.keys(v.teamData).length;for(let t=0;t<e;t++){let e=v.teamData[t];e.queens&&e.queens.length||(e.locked=!0)}}v.onNightChange()}if(z<=0){let e=Object.keys(v.teamData).length;for(let t=0;t<e;t++){let e=v.teamData[t];v.checkSpawnQueue(e.spawnQueue)}for(let e=0;e<v.clients.length;e++){let t=v.clients[e];t.player&&!t.player.valid&&null!==t.team&&(t.player=null,v.teamData[t.team]&&v.teamData[t.team].spawnQueue.push(t)),b.isSingleplayer||b.standaloneGameServer||Date.now()-t.lastAction>36e4&&t.disconnect()}}let t=Object.keys(v.teamData).length;for(let e=0;e<t;e++){v.teamData[e].aliveAntCount=0}let a=0,n=0,i=0;for(let e=0;e<v.entities.length;e++){let t=v.entities[e],r=v.quadtrees[t.z].retrieve({x:t.x,y:t.y,width:200,height:200});for(let e=0;e<r.length;e++){let a=r[e];if(a!==t){let e=Math.distanceBetween(t,a);if(t.z===a.z&&t.isAI&&t.netData.alive&&!t.parent&&t.thinkAI(a,e),t.z===a.z&&t.netData.alive&&t.radius&&a.netData.alive&&a.radius&&(t.collisionLayer===a.collisionLayer||2===t.collisionLayer&&a.static)&&(!t.netData||"centipede"!==t.netData.bugType||"centipede"!==a.netData.bugType)){let n=t.radius+a.radius;if(e<=n){let i=Math.angleBetween(a,t),r=i+Math.PI,o=(n-e)/2;t.static||(t.x+=Math.cos(i)*o,t.y+=Math.sin(i)*o),a.static||(a.x+=Math.cos(r)*o,a.y+=Math.sin(r)*o),t.static||(t.dx+=Math.cos(i)*o,t.dy+=Math.sin(i)*o),a.static||(a.dx+=Math.cos(r)*o,a.dy+=Math.sin(r)*o),t.onCollide&&t.onCollide(a),a.onCollide&&a.onCollide(t)}}}}if(t.valid&&1===t.z)for(let e=-1;e<=1;e++)for(let a=-1;a<=1;a++){let n=parseInt(t.x/v.TILE_SIZE)+e,i=parseInt(t.y/v.TILE_SIZE)+a;if(v.getTile(n,i)[0]){let e=5,a={x:n*v.TILE_SIZE,y:i*v.TILE_SIZE},r={x:a.x+v.TILE_SIZE/2,y:a.y+v.TILE_SIZE/2},o=0,s=0;if(t.y>=a.y-e&&t.y<=a.y+v.TILE_SIZE+e&&(t.x+t.radius>=a.x-e&&t.x<r.x?o+=a.x-e-.1-(t.x+t.radius):t.x-t.radius<=a.x+v.TILE_SIZE+e&&t.x>r.x&&(o+=a.x+v.TILE_SIZE+e+.1-(t.x-t.radius))),t.x>=a.x-e&&t.x<=a.x+v.TILE_SIZE+e&&(t.y+t.radius>=a.y-e&&t.y<r.y?s+=a.y-e-.1-(t.y+t.radius):t.y-t.radius<=a.y+v.TILE_SIZE+e&&t.y>r.y&&(s+=a.y+v.TILE_SIZE+e+.1-(t.y-t.radius))),t.x+=o,t.y+=s,t.dx+=.25*o,t.dy+=.25*s,Math.abs(o)>0||Math.abs(s)>0){let e=Math.angleBetween(t,r)+Math.PI;if(t.dx+=6*Math.cos(e),t.dy+=6*Math.sin(e),t.moveToPos){Math.distanceBetween(t.moveToPos,r)<=v.TILE_SIZE&&(t.moveToPos.action&&t.performAction(),t.moveToPos=null)}}}}"spider"===t.subtype&&t.valid?a++:"bug"===t.subtype&&t.netData&&"centipede"===t.netData.bugType&&"head"===t.netData.centipedeType&&t.valid?i++:"bug"!==t.subtype&&"beetle"!==t.subtype||!t.valid||n++,"ant_worker"===t.subtype&&v.teamData[t.team]&&t.valid&&t.netData.alive&&v.teamData[t.team].aliveAntCount++}if(z<=0){z=100;let e=0;for(let a=0;a<t;a++){let t=v.teamData[a];t.aliveAntCount<=0&&t.queen&&t.queen.netData.alive&&!t.queen.netData.newQueen?t.queen.kill():t.queen&&t.queen.netData.alive&&(e++,t.isAI&&v.tickTeamAI(t))}let r=Math.ceil(.4*e);if(r<2&&(r=2),a<r&&Date.now()-v.roundStartTime>36e4){let e=v.getEdgePosition();v.createInsect("spider",e.x,e.y,0,120,120,-1)}let o=Math.ceil(.3*e);if(o<2&&(o=2),i<o&&Date.now()-v.roundStartTime>72e4){let e=Math.round(80+100*Math.random()),t=v.getEdgePosition();v.createInsect("bug",t.x,t.y,0,e,e,-1,{bugType:"centipede",centipedeType:"head"})}let s=Math.floor(.75*e);if(s<2&&(s=2),n<s){let e=v.getEdgePosition();Math.random()<=.5?v.createInsect("bug",e.x,e.y,0,100,100,-1):v.createInsect("beetle",e.x,e.y,0,145,145,-1)}}else z--;for(let t=0;t<v.entities.length;t++){let a=v.entities[t];a.valid?a.tick&&a.tick(e):(v.entities.splice(t,1),a.onRemove(),v.sendMessage("removeEntity",a.id),t--)}v.quadtrees[0].clear(),v.quadtrees[1].clear();for(let e=0;e<v.entities.length;e++){let t=v.entities[e];t.valid&&(v.quadtrees[t.z].insert(t),"anthill"===t.subtype&&v.quadtrees[t.z+1].insert(t))}v.tickSnapshot()}),v.onNightChange=(()=>{if("coop"===v.gamemode.type&&_){v.gamemode.wave++,v.gamemode.enemyCount=Math.round(1.4*v.gamemode.enemyCount),v.gamemode.enemyTeam||(v.gamemode.enemyTeam=v.createTeam(),v.gamemode.enemyTeam.isAITeam=!0,v.gamemode.enemyTeam.isFakeTeam=!0,v.gamemode.enemyTeam.locked=!0,v.gamemode.enemyTeam.anthill=v.teamData[0].anthill),v.sendMessage("growl","WAVE "+v.gamemode.wave+" ENEMIES: "+v.gamemode.enemyCount);for(let e=0;e<v.gamemode.enemyCount;e++){let e=Math.random(),t=v.getEdgePosition(-50),a=null;(a=e<.6||v.getModifiedTime()-v.roundStartTime<48e4?v.createInsect("ant_worker",t.x+Math.random(),t.y+Math.random(),0,65,65,v.gamemode.enemyTeam.id):e>=.6&&e<.9?v.createInsect("ant_worker",t.x+Math.random(),t.y+Math.random(),0,80,80,v.gamemode.enemyTeam.id,{soldier:!0}):v.createInsect("ant_worker",t.x+Math.random(),t.y+Math.random(),0,110,110,v.gamemode.enemyTeam.id,{soldier:!0}))&&(a.pathTo({x:v.teamData[0].queen.x,y:v.teamData[0].queen.y,z:1},35),a.path&&a.path.length||(a.moveToPos={x:v.teamData[0].queen.x,y:v.teamData[0].queen.y}))}}}),v.updateGamemode=(e=>{v.gamemode={type:e},"coop"===v.gamemode.type&&(v.gamemode.wave=0,v.gamemode.enemyCount=3,T=100,M=12e4,k=48e3,P=Date.now()+M,v.teamData={},A=0,v.createTeam(),v.sendLobbyUpdate())}),v.getEdgePosition=(e=>{let t=Math.random();return e||(e=10),t<=.25?{x:v.MAP_SIZE*v.TILE_SIZE*Math.random(),y:-e}:t>.25&&t<=.5?{x:-e,y:v.MAP_SIZE*v.TILE_SIZE*Math.random()}:t>.5&&t<=.75?{x:v.MAP_SIZE*v.TILE_SIZE*Math.random(),y:v.MAP_SIZE*v.TILE_SIZE+e}:{x:v.MAP_SIZE*v.TILE_SIZE+e,y:v.MAP_SIZE*v.TILE_SIZE*Math.random()}}),v.getPositionAwayFromEdge=(e=>(e||(e=10),{x:Math.random()*(v.MAP_SIZE*v.TILE_SIZE-2*e)+e,y:Math.random()*(v.MAP_SIZE*v.TILE_SIZE-2*e)+e})),v.sendSnapshot=(()=>{let e=i.allocUnsafe(8);if(e.writeDoubleBE(Date.now()),v.entities.forEach(t=>{if(t.sendMoveUpdate){let a=i.allocUnsafe(16);a.writeUInt32BE(t.id,0),a.writeFloatBE(t.x,4),a.writeFloatBE(t.y,8),a.writeFloatBE(t.rotation,12);let n=e.length+a.length;e=i.concat([e,a],n)}}),e.length>8)for(let t=0;t<v.clients.length;t++){v.clients[t].snapSocket.client.conn.write(e)}});v.setTileMoisture=((e,t,a)=>{a>.8?a=1:a<.2&&(a=0),D[t][e][1]=a}),v.createNewAnthill=(e=>{let t=v.createObject("anthill",e.x,e.y,0,200,200,e.team);e.anthill=t,t.queen=e;let n=Math.floor(t.x/v.TILE_SIZE),i=Math.floor(t.y/v.TILE_SIZE);v.getTileOrNull(n,i)&&(v.tileGrids[0].setWalkableAt(n,i-1,!0),v.tileGrids[0].setWalkableAt(n-1,i,!0),v.tileGrids[0].setWalkableAt(n,i,!0),v.tileGrids[0].setWalkableAt(n+1,i,!0),v.tileGrids[0].setWalkableAt(n,i+1,!0));for(let e=0;e<v.MAP_SIZE;e++)for(let a=0;a<v.MAP_SIZE;a++){let n=Math.distanceBetween(t,{x:a*v.TILE_SIZE+v.TILE_SIZE/2,y:e*v.TILE_SIZE+v.TILE_SIZE/2});n<=2.2*v.TILE_SIZE&&(v.tileGrids[1].setWalkableAt(a,e,!0),n<=v.TILE_SIZE?v.updateTile(a,e,0,.5):v.updateTile(a,e,0))}let r=v.createInsect("ant_worker",t.x+(50*Math.random()-25),t.y+60+(50*Math.random()-25),1,65,65,e.team);r.queen=e,e.currentPlayer&&v.switchPlayer(e.currentPlayer,r);let o=v.teamData[e.team].clients.length;if(o<4&&(o=4),"local"===a.env.NODE_ENV){o=12;for(let a=0;a<8;a++){v.createObject("brood",t.x+(50*Math.random()-25),t.y+60+(50*Math.random()-25),1,45,45,e.team).queen=e}(r=v.createInsect("ant_worker",t.x+(50*Math.random()-25),t.y+60+(50*Math.random()-25),1,80,80,e.team,{soldier:!0})).queen=e,(r=v.createInsect("ant_worker",t.x+(50*Math.random()-25),t.y+60+(50*Math.random()-25),1,110,110,e.team,{soldier:!0})).queen=e}for(let a=0;a<o-1;a++){let n=v.createInsect("ant_worker",t.x+(50*Math.random()-25),t.y+60+(50*Math.random()-25),1,65,65,e.team);0===a&&(n.dataAI.role="digger"),n.queen=e}e.netData.newQueen=!1,e.sendRPC("setNewQueen",!1),e.x-=50,e.y-=20,e.z=1}),v.resetNight=(()=>{_=!1,C=!1,P=v.getModifiedTime()+M,v.sendMessage("updateNight",{night:_,force:!0})}),v.resetGame=(()=>{let e=new d.Noise(Math.random()),t=new d.Noise(Math.random());S=!1;for(let e=0;e<v.entities.length;e++){v.entities[e].remove()}v.teamData={},A=0,v.tileGrids=[new h.Grid(v.MAP_SIZE,v.MAP_SIZE),new h.Grid(v.MAP_SIZE,v.MAP_SIZE)],D=[];for(let a=0;a<v.MAP_SIZE;a++){D.push([]);for(let n=0;n<v.MAP_SIZE;n++){let i=(t.simplex2(n/7,a/7)+1)/2;(i=i<.3?0:1)&&Math.random()>.75&&(i=2),D[a][n]=[i,0,0];let r=(e.simplex2(n/6.5,a/6.5)+1)/2;if(v.setTileMoisture(n,a,r),v.tileGrids[1].setWalkableAt(n,a,0===D[a][n][0]),0===D[a][n][0]&&0===D[a][n][1]&&Math.random()>=.6){let e=1+Math.round(2*Math.random());for(let t=0;t<e;t++)v.createObject("food",n*v.TILE_SIZE+10+Math.random()*(v.TILE_SIZE-20),a*v.TILE_SIZE+10+Math.random()*(v.TILE_SIZE-20),1,45,45,-1)}}}let n=[];for(let e=0;e<25;e++){let e={x:Math.random()*v.MAP_SIZE*v.TILE_SIZE,y:Math.random()*v.MAP_SIZE*v.TILE_SIZE},t=400+Math.round(200*Math.random()),a=!0;for(let n=0;n<v.entities.length;n++){let i=v.entities[n];if("rock"===i.subtype||"plant"===i.subtype){if(Math.distanceBetween(e,i)<=t){a=!1;break}}}if(a){let a=v.createObject("plant",e.x,e.y,0,t,t,-1);n.push(a)}}for(let e=0;e<35;e++){let e={x:Math.random()*v.MAP_SIZE*v.TILE_SIZE,y:Math.random()*v.MAP_SIZE*v.TILE_SIZE},t=400+Math.round(200*Math.random()),a=!0;for(let n=0;n<v.entities.length;n++){let i=v.entities[n];if("rock"===i.subtype||"plant"===i.subtype){if(Math.distanceBetween(e,i)<=t){a=!1;break}}}a&&v.createObject("rock",e.x,e.y,0,t,t,-1)}let i=Object.keys(v.teamData).length,r=0;for(let e=0;e<i;e++){let t=v.teamData[e];(t.clients.length>0||t.isAI)&&r++}let o=3*r;if(o<6&&(o=6),!b.isTutorial)for(let e=0;e<o;e++){let e=2*Math.PI*Math.random(),t=50+50*Math.random(),a=n[Math.floor(Math.random()*n.length)];a&&v.createObject("aphid",a.x+Math.cos(e)*t,a.y+Math.sin(e)*t,0,45,45,-1)}if("local"===a.env.NODE_ENV)for(let e=0;e<5;e++){let e=Math.round(80+100*Math.random()),t=v.getEdgePosition();v.createInsect("bug",t.x,t.y,0,e,e,-1,{bugType:"centipede",centipedeType:"head"})}v.updateRoundState({type:"lobby",endTime:Date.now()+y}),v.resetNight();for(let e=0;e<8;e++)v.createTeam();for(let e=0;e<v.clients.length;e++){let t=v.clients[e];t.ready=!1,t.player=null,t.team=null,t.playStartTime=Date.now(),t.hasSpawned=!1,t.emit("tileData",D)}v.sendLobbyUpdate(),v.roundStartTime=Date.now(),v.sendMessage("setAnnouncement",null),v.tutorial&&setTimeout(()=>{v.tutorial.start()},1e3)}),v.sendMessage=((t,a)=>{e.to("server:"+n).emit(t,a)}),v.startGame=(()=>{v.running||v.resetGame()}),v.stopGame=(()=>{v.running=!1}),v.startLoop=(()=>{v.running=!0,u(v.gameLoop),console.log("Server game loop started.")});let B=Date.now();v.gameLoop=(()=>{if(!v.running)return void console.log("Server game loop halted.");let e=Date.now()-B;e<w?setTimeout(v.gameLoop,w-e):(B=Date.now(),v.tick(e),u(v.gameLoop))})}Math.angleBetween=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},Math.distanceBetween=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},Math.magnitude=function(e){return Math.hypot(e.dx,e.dy)},t.exports=b,n.antwarServer={Server:b}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],e("timers").setImmediate)},{"./entities/entity":31,"./entities/insect":32,"./entities/object":33,"./quadtree":34,"./tutorial":37,_process:4,buffer:2,noisejs:8,pathfinding:9,timers:5}],36:[function(e,t,a){const n=e("pathfinding");var i=n.Heap,r=(n.Util,n.Heuristic),o=n.DiagonalMovement;function s(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||r.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.OnlyWhenNoObstacles:this.diagonalMovement=o.IfAtMostOneObstacle:this.diagonalMovement=o.Never),this.diagonalMovement===o.Never?this.heuristic=e.heuristic||r.manhattan:this.heuristic=e.heuristic||r.octile}s.prototype.findTile=function(e,t,a,n){var r,o,s,l,u,d,h,c,p=new i(function(e,t){return e.f-t.f}),f=n.getNodeAt(e,t),g=this.heuristic,m=this.diagonalMovement,y=this.weight,b=Math.abs,v=Math.SQRT2;for(f.g=0,f.f=0,p.push(f),f.opened=!0;!p.empty();){if((r=p.pop()).closed=!0,a(r,f))return r;for(l=0,u=(o=n.getNeighbors(r,m)).length;l<u;++l)(s=o[l]).closed||(d=s.x,h=s.y,c=r.g+(d-r.x==0||h-r.y==0?1:v),(!s.opened||c<s.g)&&(s.g=c,s.h=s.h||y*g(b(d-e),b(h-t)),s.f=s.g+s.h,s.parent=r,s.opened?p.updateItem(s):(p.push(s),s.opened=!0)))}return[]},t.exports=s},{pathfinding:9}],37:[function(e,t,a){t.exports=function(e){this.tutorialData=null,console.log("Tutorial loaded!");let t=-1,a=!1,n=[{text:"Welcome to AntWar.io!\nThis short tutorial will teach you a little bit about how to play the game and start a nest.",pause:!0},{text:"When a new game is started, the player with the highest rank on your team will become a new queen.\n\nYou are currently a queen!",pause:!0},{text:"New queens can create nests, and once a nest is created the queen will start to lay eggs.",pause:!0},{text:"First you need to know how to move!\n\nClick and hold anywhere to move there.",wait:2e3,init:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0]&&(e.getClients()[0].player.moveToPos=null)},objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.moveToPos&&this.continue()}},{text:"Great! Now that you can move, find a good spot to create a nest.",pause:!0},{text:"Right click(or double tap) somewhere create a nest!\n\nPick a good spot for a nest, near dry patches(Light brown specks) on the ground so that food can be stored there.",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.queen&&this.continue()}},{text:"Great! You are now nice and safe underground.",pause:!0},{text:"You will need to expand your nest!\n\nYou will need to uncover dark brown moist spots to put brood and dry cracked light brown spots to put food.",pause:!0},{text:"Right click(or double tap) on dirt to start digging and pick up some dirt.",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.carriedObject&&"dirt"===e.getClients()[0].player.carriedObject.subtype&&this.continue()}},{text:"Now that you have dirt, you need to take it outside. Right click(or double tap) on the light in the middle of the nest to go outside.",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&0===e.getClients()[0].player.z&&this.continue()}},{text:"Right click(or double tap) to drop the dirt outside.",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&!e.getClients()[0].player.carriedObject&&this.continue()}},{text:"Now right click(or double tap) on your hole to go back underground. We have more work to do!",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.z>0&&this.continue()}},{text:"Great! Now we need to get food to feed our queen and brood!",pause:!0},{text:"We can lead our fellow ants outside to help us search and gather more food.",pause:!0},{text:'Click on your ant to open a command menu and select "+5 Follow".\n\nThis will get 5 of your fellow workers to follow you.',wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.followers&&e.getClients()[0].player.followers.length>1&&this.continue()}},{text:"Great, now return outside and your workers will follow you!",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&0===e.getClients()[0].player.z&&this.continue()}},{text:"Now that you are outside you can search for food. Food will look like green pellets, these pellets can be found outside on the ground.\n\nYou can also kill bugs to get food!",pause:!0},{text:"Now find some food! Search around and once you find food right click(or double tap) to pick it up!\n\nYou can also right click(or double tap) on bugs to attack them and your workers will help you.",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.carriedObject&&"food"===e.getClients()[0].player.carriedObject.subtype&&this.continue()}},{text:"Great, you found some food! Now that you found food you need to release your workers and let them get the food as well.\n\n(If you are lost, follow the white arrow back to your nest.)",pause:!0},{text:'Click your ant to open the command menu and then select "Dismiss".',wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.followers&&e.getClients()[0].player.followers.length<=0&&this.continue()}},{text:"Great! Now your workers will grab the food as well and return to the nest. We should go back as well!",pause:!0},{text:"Return to your nest and go underground.",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&1===e.getClients()[0].player.z&&this.continue()}},{text:"Food needs to be on the dry cracked light brown dirt or else it will spoil! Place your food there if you have one uncovered.\n\nIf you don't have any uncovered, dig out some more tiles!",pause:!0},{text:"Food is used to feed brood, yourself, and the queen. You will know something needs to be fed because a hunger icon will appear over it!",pause:!0},{text:"Now we will wait for the queen to get hungry,",wait:1e3,init:()=>{setTimeout(()=>{e.getClients()[0].player.queen&&e.getClients()[0].player.queen.setHungry(!0)},6e3)},objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.queen&&e.getClients()[0].player.queen.netData&&e.getClients()[0].player.queen.netData.hungry&&this.continue()}},{text:"The queen is hungry! A worker must feed her, if she goes too long with out food she will die.",pause:!0},{text:"If there are workers in the nest they will feed the queen as long as there is food nearby.",pause:!0},{text:"You can feed the queen by picking up food and dropping it on her.",pause:!0},{text:"Feed the queen or wait for another worker to feed her.",wait:1e3,objective:()=>{e.getClients()[0]&&e.getClients()[0].player&&e.getClients()[0].player.queen&&e.getClients()[0].player.queen.netData&&!e.getClients()[0].player.queen.netData.hungry&&this.continue()}},{text:"Great the queen is happy! You will need to do the same for brood eventually as well, as new ants will not grow unless the larvae is fed.",pause:!0},{text:"That is the basics of how to get a nest started!",pause:!0},{text:"There are many things that weren't covered here, but with this knowledge you can feed and grow your colony.",pause:!0},{text:"There are no enemy ants on this map so you can continue to play here to get used to the game. (But watch out for spiders!)",pause:!0},{text:"The goal of AntWar.io is to kill all other enemy queens. You can invade their nests with your workers to kill them and steal their brood!",pause:!0},{text:"It is recommended that after this you play singleplayer to fight computer controlled colonies and get used to attacking enemy nests.",pause:!0},{text:"When you are ready you can leave the tutorial by clicking the menu in the top right and selecting disconnect.\n\nGood luck out there!",pause:!0}];this.start=(()=>{this.continue()}),this.continue=(()=>{a||(a=!0,setTimeout(()=>{n[++t]&&n[t].init&&n[t].init(),this.updateTutorial(n[t])},n[t]&&n[t].wait?n[t].wait:0))}),this.tick=(()=>{n&&n[t]&&n[t].objective&&n[t].objective()}),this.updateTutorial=(t=>{a=!1,t&&t.pause&&(t.text+="\n\nDouble Tap Anywhere or Press Spacebar to Continue >>>"),this.tutorialData=t,e.sendMessage("tutorialData",this.tutorialData)})}},{}]},{},[35]);
//# sourceMappingURL=maps/app.min.js.map
